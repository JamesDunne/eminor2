<!DOCTYPE html>

<html>
<head>
<script src="knockout-3.3.0.debug.js"></script>
<script src="yaml.js"></script>
<style>
#drop_zone {
  border: 2px dashed #bbb;
  -moz-border-radius: 5px;
  -webkit-border-radius: 5px;
  border-radius: 5px;
  padding: 25px;
  text-align: center;
  font: 20pt bold 'Vollkorn';
  color: #bbb;
}
</style>
</head>

<body>
	<div id="drop_zone">Drop all_programs-v2.yml YAML file here</div>

	<table>
	<tbody data-bind="foreach: programs">
		<tr>
			<td data-bind="text: $data.gmaj_program"></td>
			<td data-bind="text: $data.name"></td>
			<td data-bind="text: $data.starts"></td>
			<td data-bind="text: $data.initial_scene"></td>
			<td>
				<ul data-bind="foreach: $data.scenes">
					<li>
					<span data-bind="text: $data.channel"></span>&nbsp;
					<span data-bind="text: $data.axe_scene"></span>&nbsp;
					<span data-bind="text: $data.level"></span>&nbsp;
					<span data-bind="text: '[' + $data.fx.join(',') + ']'"></span>
					</li>
				</ul>
			</td>
		</tr>
	</tbody>
	</table>

<script>
	function ViewModel() {
		var self = this;
		self.programs = ko.observableArray([]);
	}

	var vm = new ViewModel();
	ko.applyBindings(vm);

	function handleFileSelect(evt) {
		evt.stopPropagation();
		evt.preventDefault();

		var files = evt.dataTransfer.files; // FileList object.
		if (files.length == 0) return;

		var reader = new FileReader();
		reader.onload = function(e) {
			var doc = YAML.parse(e.target.result);
			console.log(doc);
			vm.programs(doc.programs);
		};
		reader.readAsText(files[0]);
	}

	function handleDragOver(evt) {
		evt.stopPropagation();
		evt.preventDefault();
		evt.dataTransfer.dropEffect = 'copy'; // Explicitly show this is a copy.
	}

	// Setup the dnd listeners.
	var dropZone = document.getElementById('drop_zone');
	dropZone.addEventListener('dragover', handleDragOver, false);
	dropZone.addEventListener('drop', handleFileSelect, false);
</script>
</body>
</html>
