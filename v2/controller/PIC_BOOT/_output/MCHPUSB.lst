MP2COD 3.90.01, COFF to COD File Converter
Copyright (c) 2005 Microchip Technology Inc.
Listing File Generated: Tue May 17 13:11:12 2005


Address  Value    Disassembly              Source                                                                           File
-------  -------  -----------------------  -------------------------------------------------------------------------------  -----
                                           /* $Id: c018i.c,v 1.3 2004/07/30 17:28:43 ConnerJ Exp $ */                       C:\mcc18\src\traditional\startup\c018i.c
                                                                                                                            C:\mcc18\src\traditional\startup\c018i.c
                                           /* Copyright (c)1999 Microchip Technology */                                     C:\mcc18\src\traditional\startup\c018i.c
                                                                                                                            C:\mcc18\src\traditional\startup\c018i.c
                                           /* MPLAB-C18 startup code, including initialized data */                         C:\mcc18\src\traditional\startup\c018i.c
                                                                                                                            C:\mcc18\src\traditional\startup\c018i.c
                                           /* external reference to the user's main routine */                              C:\mcc18\src\traditional\startup\c018i.c
                                           extern void main (void);                                                         C:\mcc18\src\traditional\startup\c018i.c
                                           /* prototype for the startup function */                                         C:\mcc18\src\traditional\startup\c018i.c
                                           void _entry (void);                                                              C:\mcc18\src\traditional\startup\c018i.c
                                           void _startup (void);                                                            C:\mcc18\src\traditional\startup\c018i.c
                                           /* prototype for the initialized data setup */                                   C:\mcc18\src\traditional\startup\c018i.c
                                           void _do_cinit (void);                                                           C:\mcc18\src\traditional\startup\c018i.c
                                                                                                                            C:\mcc18\src\traditional\startup\c018i.c
                                           extern volatile near unsigned long short TBLPTR;                                 C:\mcc18\src\traditional\startup\c018i.c
                                           extern near unsigned FSR0;                                                       C:\mcc18\src\traditional\startup\c018i.c
                                           extern near char FPFLAGS;                                                        C:\mcc18\src\traditional\startup\c018i.c
                                           #define RND 6                                                                    C:\mcc18\src\traditional\startup\c018i.c
                                                                                                                            C:\mcc18\src\traditional\startup\c018i.c
                                           #pragma code _entry_scn=0x000000                                                 C:\mcc18\src\traditional\startup\c018i.c
                                           void                                                                             C:\mcc18\src\traditional\startup\c018i.c
                                           _entry (void)                                                                    C:\mcc18\src\traditional\startup\c018i.c
                                           {                                                                                C:\mcc18\src\traditional\startup\c018i.c
000000   ef75     GOTO      0x6ea          _asm goto _startup _endasm                                                       C:\mcc18\src\traditional\startup\c018i.c
000002   f003                                                                                                               
                                                                                                                            C:\mcc18\src\traditional\startup\c018i.c
000004   0012     RETURN    0x0            }                                                                                C:\mcc18\src\traditional\startup\c018i.c
                                           #pragma code _startup_scn                                                        C:\mcc18\src\traditional\startup\c018i.c
                                           void                                                                             C:\mcc18\src\traditional\startup\c018i.c
                                           _startup (void)                                                                  C:\mcc18\src\traditional\startup\c018i.c
                                           {                                                                                C:\mcc18\src\traditional\startup\c018i.c
                                             _asm                                                                           C:\mcc18\src\traditional\startup\c018i.c
                                               // Initialize the stack pointer                                              C:\mcc18\src\traditional\startup\c018i.c
0006ea   ee13     LFSR      0x1,0x300          lfsr 1, _stack                                                               C:\mcc18\src\traditional\startup\c018i.c
0006ec   f000                                                                                                               
0006ee   ee23     LFSR      0x2,0x300          lfsr 2, _stack                                                               C:\mcc18\src\traditional\startup\c018i.c
0006f0   f000                                                                                                               
                                                                                                                            C:\mcc18\src\traditional\startup\c018i.c
0006f2   6af8     CLRF      0xf8,0x0           clrf TBLPTRU, 0 // 1st silicon doesn't do this on POR                        C:\mcc18\src\traditional\startup\c018i.c
                                                                                                                            C:\mcc18\src\traditional\startup\c018i.c
0006f4   9c05     BCF       0x5,0x6,0x0        bcf FPFLAGS,RND,0 // Initialize rounding flag for floating point libs        C:\mcc18\src\traditional\startup\c018i.c
                                                                                                                            C:\mcc18\src\traditional\startup\c018i.c
                                               _endasm                                                                      C:\mcc18\src\traditional\startup\c018i.c
0006f6   ec0b     CALL      0x616,0x0          _do_cinit ();                                                                C:\mcc18\src\traditional\startup\c018i.c
0006f8   f003                                                                                                               
                                                                                                                            C:\mcc18\src\traditional\startup\c018i.c
                                           loop:                                                                            C:\mcc18\src\traditional\startup\c018i.c
                                                                                                                            C:\mcc18\src\traditional\startup\c018i.c
                                             // Call the user's main routine                                                C:\mcc18\src\traditional\startup\c018i.c
0006fa   ecec     CALL      0x5d8,0x0        main ();                                                                       C:\mcc18\src\traditional\startup\c018i.c
0006fc   f002                                                                                                               
                                                                                                                            C:\mcc18\src\traditional\startup\c018i.c
0006fe   d7fd     BRA       0x6fa            goto loop;                                                                     C:\mcc18\src\traditional\startup\c018i.c
000700   0012     RETURN    0x0            }                               /* end _startup() */                             C:\mcc18\src\traditional\startup\c018i.c
                                                                                                                            C:\mcc18\src\traditional\startup\c018i.c
                                           /* MPLAB-C18 initialized data memory support */                                  C:\mcc18\src\traditional\startup\c018i.c
                                           /* The linker will populate the _cinit table */                                  C:\mcc18\src\traditional\startup\c018i.c
                                           extern far rom struct                                                            C:\mcc18\src\traditional\startup\c018i.c
                                           {                                                                                C:\mcc18\src\traditional\startup\c018i.c
                                             unsigned short num_init;                                                       C:\mcc18\src\traditional\startup\c018i.c
                                             struct _init_entry                                                             C:\mcc18\src\traditional\startup\c018i.c
                                             {                                                                              C:\mcc18\src\traditional\startup\c018i.c
                                               unsigned long from;                                                          C:\mcc18\src\traditional\startup\c018i.c
                                               unsigned long to;                                                            C:\mcc18\src\traditional\startup\c018i.c
                                               unsigned long size;                                                          C:\mcc18\src\traditional\startup\c018i.c
                                             }                                                                              C:\mcc18\src\traditional\startup\c018i.c
                                             entries[];                                                                     C:\mcc18\src\traditional\startup\c018i.c
                                           }                                                                                C:\mcc18\src\traditional\startup\c018i.c
                                           _cinit;                                                                          C:\mcc18\src\traditional\startup\c018i.c
                                                                                                                            C:\mcc18\src\traditional\startup\c018i.c
                                           #pragma code _cinit_scn                                                          C:\mcc18\src\traditional\startup\c018i.c
                                           void                                                                             C:\mcc18\src\traditional\startup\c018i.c
                                           _do_cinit (void)                                                                 C:\mcc18\src\traditional\startup\c018i.c
                                           {                                                                                C:\mcc18\src\traditional\startup\c018i.c
                                             /* we'll make the assumption in the following code that these statics          C:\mcc18\src\traditional\startup\c018i.c
                                              * will be allocated into the same bank.                                       C:\mcc18\src\traditional\startup\c018i.c
                                              */                                                                            C:\mcc18\src\traditional\startup\c018i.c
                                             static short long prom;                                                        C:\mcc18\src\traditional\startup\c018i.c
                                             static unsigned short curr_byte;                                               C:\mcc18\src\traditional\startup\c018i.c
                                             static unsigned short curr_entry;                                              C:\mcc18\src\traditional\startup\c018i.c
                                             static short long data_ptr;                                                    C:\mcc18\src\traditional\startup\c018i.c
                                                                                                                            C:\mcc18\src\traditional\startup\c018i.c
                                             // Initialized data...                                                         C:\mcc18\src\traditional\startup\c018i.c
000616   0e06     MOVLW     0x6              TBLPTR = (short long)&_cinit;                                                  C:\mcc18\src\traditional\startup\c018i.c
000618   6ef6     MOVWF     0xf6,0x0                                                                                        
00061a   0e00     MOVLW     0x0                                                                                             
00061c   6ef7     MOVWF     0xf7,0x0                                                                                        
00061e   0e00     MOVLW     0x0                                                                                             
000620   6ef8     MOVWF     0xf8,0x0                                                                                        
                                             _asm                                                                           C:\mcc18\src\traditional\startup\c018i.c
000622   0100     MOVLB     0x0                movlb data_ptr                                                               C:\mcc18\src\traditional\startup\c018i.c
000624   0009     TBLRDPOSTINC                 tblrdpostinc                                                                 C:\mcc18\src\traditional\startup\c018i.c
000626   50f5     MOVF      0xf5,0x0,0x0       movf TABLAT, 0, 0                                                            C:\mcc18\src\traditional\startup\c018i.c
000628   6f7e     MOVWF     0x7e,0x1           movwf curr_entry, 1                                                          C:\mcc18\src\traditional\startup\c018i.c
00062a   0009     TBLRDPOSTINC                 tblrdpostinc                                                                 C:\mcc18\src\traditional\startup\c018i.c
00062c   50f5     MOVF      0xf5,0x0,0x0       movf TABLAT, 0, 0                                                            C:\mcc18\src\traditional\startup\c018i.c
00062e   6f7f     MOVWF     0x7f,0x1           movwf curr_entry+1, 1                                                        C:\mcc18\src\traditional\startup\c018i.c
                                             _endasm                                                                        C:\mcc18\src\traditional\startup\c018i.c
                                               //while (curr_entry)                                                         C:\mcc18\src\traditional\startup\c018i.c
                                               //{                                                                          C:\mcc18\src\traditional\startup\c018i.c
                                               test:                                                                        C:\mcc18\src\traditional\startup\c018i.c
                                               _asm                                                                         C:\mcc18\src\traditional\startup\c018i.c
000630   e103     BNZ       0x638               bnz 3                                                                       C:\mcc18\src\traditional\startup\c018i.c
000632   677e     TSTFSZ    0x7e,0x1           tstfsz curr_entry, 1                                                         C:\mcc18\src\traditional\startup\c018i.c
000634   d001     BRA       0x638              bra 1                                                                        C:\mcc18\src\traditional\startup\c018i.c
                                               _endasm                                                                      C:\mcc18\src\traditional\startup\c018i.c
000636   d03d     BRA       0x6b2              goto done;                                                                   C:\mcc18\src\traditional\startup\c018i.c
                                                 /* Count down so we only have to look up the data in _cinit                C:\mcc18\src\traditional\startup\c018i.c
                                                  * once.                                                                   C:\mcc18\src\traditional\startup\c018i.c
                                                  *                                                                         C:\mcc18\src\traditional\startup\c018i.c
                                                  * At this point we know that TBLPTR points to the top of the current      C:\mcc18\src\traditional\startup\c018i.c
                                                  * entry in _cinit, so we can just start reading the from, to, and         C:\mcc18\src\traditional\startup\c018i.c
                                                  * size values.                                                            C:\mcc18\src\traditional\startup\c018i.c
                                                  */                                                                        C:\mcc18\src\traditional\startup\c018i.c
                                                 _asm                                                                       C:\mcc18\src\traditional\startup\c018i.c
                                           	/* read the source address */                                                   C:\mcc18\src\traditional\startup\c018i.c
000638   0009     TBLRDPOSTINC             	tblrdpostinc                                                                    C:\mcc18\src\traditional\startup\c018i.c
00063a   50f5     MOVF      0xf5,0x0,0x0   	movf TABLAT, 0, 0                                                               C:\mcc18\src\traditional\startup\c018i.c
00063c   6f79     MOVWF     0x79,0x1       	movwf prom, 1                                                                   C:\mcc18\src\traditional\startup\c018i.c
00063e   0009     TBLRDPOSTINC             	tblrdpostinc                                                                    C:\mcc18\src\traditional\startup\c018i.c
000640   50f5     MOVF      0xf5,0x0,0x0   	movf TABLAT, 0, 0                                                               C:\mcc18\src\traditional\startup\c018i.c
000642   6f7a     MOVWF     0x7a,0x1       	movwf prom+1, 1                                                                 C:\mcc18\src\traditional\startup\c018i.c
000644   0009     TBLRDPOSTINC             	tblrdpostinc                                                                    C:\mcc18\src\traditional\startup\c018i.c
000646   50f5     MOVF      0xf5,0x0,0x0   	movf TABLAT, 0, 0                                                               C:\mcc18\src\traditional\startup\c018i.c
000648   6f7b     MOVWF     0x7b,0x1       	movwf prom+2, 1                                                                 C:\mcc18\src\traditional\startup\c018i.c
                                           	/* skip a byte since it's stored as a 32bit int */                              C:\mcc18\src\traditional\startup\c018i.c
00064a   0009     TBLRDPOSTINC             	tblrdpostinc                                                                    C:\mcc18\src\traditional\startup\c018i.c
                                           	/* read the destination address directly into FSR0 */                           C:\mcc18\src\traditional\startup\c018i.c
00064c   0009     TBLRDPOSTINC             	tblrdpostinc                                                                    C:\mcc18\src\traditional\startup\c018i.c
00064e   50f5     MOVF      0xf5,0x0,0x0   	movf TABLAT, 0, 0                                                               C:\mcc18\src\traditional\startup\c018i.c
000650   6ee9     MOVWF     0xe9,0x0       	movwf FSR0L, 0                                                                  C:\mcc18\src\traditional\startup\c018i.c
000652   0009     TBLRDPOSTINC             	tblrdpostinc                                                                    C:\mcc18\src\traditional\startup\c018i.c
000654   50f5     MOVF      0xf5,0x0,0x0   	movf TABLAT, 0, 0                                                               C:\mcc18\src\traditional\startup\c018i.c
000656   6eea     MOVWF     0xea,0x0       	movwf FSR0H, 0                                                                  C:\mcc18\src\traditional\startup\c018i.c
                                           	/* skip two bytes since it's stored as a 32bit int */                           C:\mcc18\src\traditional\startup\c018i.c
000658   0009     TBLRDPOSTINC             	tblrdpostinc                                                                    C:\mcc18\src\traditional\startup\c018i.c
00065a   0009     TBLRDPOSTINC             	tblrdpostinc                                                                    C:\mcc18\src\traditional\startup\c018i.c
                                           	/* read the destination address directly into FSR0 */                           C:\mcc18\src\traditional\startup\c018i.c
00065c   0009     TBLRDPOSTINC             	tblrdpostinc                                                                    C:\mcc18\src\traditional\startup\c018i.c
00065e   50f5     MOVF      0xf5,0x0,0x0   	movf TABLAT, 0, 0                                                               C:\mcc18\src\traditional\startup\c018i.c
000660   6f7c     MOVWF     0x7c,0x1       	movwf curr_byte, 1                                                              C:\mcc18\src\traditional\startup\c018i.c
000662   0009     TBLRDPOSTINC             	tblrdpostinc                                                                    C:\mcc18\src\traditional\startup\c018i.c
000664   50f5     MOVF      0xf5,0x0,0x0   	movf TABLAT, 0, 0                                                               C:\mcc18\src\traditional\startup\c018i.c
000666   6f7d     MOVWF     0x7d,0x1       	movwf curr_byte+1, 1                                                            C:\mcc18\src\traditional\startup\c018i.c
                                           	/* skip two bytes since it's stored as a 32bit int */                           C:\mcc18\src\traditional\startup\c018i.c
000668   0009     TBLRDPOSTINC             	tblrdpostinc                                                                    C:\mcc18\src\traditional\startup\c018i.c
00066a   0009     TBLRDPOSTINC             	tblrdpostinc                                                                    C:\mcc18\src\traditional\startup\c018i.c
                                                 _endasm                                                                    C:\mcc18\src\traditional\startup\c018i.c
                                                 //prom = data_ptr->from;                                                   C:\mcc18\src\traditional\startup\c018i.c
                                                 //FSR0 = data_ptr->to;                                                     C:\mcc18\src\traditional\startup\c018i.c
                                                 //curr_byte = (unsigned short) data_ptr->size;                             C:\mcc18\src\traditional\startup\c018i.c
                                                 /* the table pointer now points to the next entry. Save it                 C:\mcc18\src\traditional\startup\c018i.c
                                                  * off since we'll be using the table pointer to do the copying            C:\mcc18\src\traditional\startup\c018i.c
                                                  * for the entry.                                                          C:\mcc18\src\traditional\startup\c018i.c
                                                  */                                                                        C:\mcc18\src\traditional\startup\c018i.c
00066c   cff6     MOVFF     0xff6,0x80           data_ptr = TBLPTR;                                                         C:\mcc18\src\traditional\startup\c018i.c
00066e   f080                                                                                                               
000670   cff7     MOVFF     0xff7,0x81                                                                                      
000672   f081                                                                                                               
000674   cff8     MOVFF     0xff8,0x82                                                                                      
000676   f082                                                                                                               
                                                                                                                            C:\mcc18\src\traditional\startup\c018i.c
                                                 /* now assign the source address to the table pointer */                   C:\mcc18\src\traditional\startup\c018i.c
000678   c079     MOVFF     0x79,0xff6           TBLPTR = prom;                                                             C:\mcc18\src\traditional\startup\c018i.c
00067a   fff6                                                                                                               
00067c   c07a     MOVFF     0x7a,0xff7                                                                                      
00067e   fff7                                                                                                               
000680   c07b     MOVFF     0x7b,0xff8                                                                                      
000682   fff8                                                                                                               
                                                                                                                            C:\mcc18\src\traditional\startup\c018i.c
                                                 /* do the copy loop */                                                     C:\mcc18\src\traditional\startup\c018i.c
                                                 _asm                                                                       C:\mcc18\src\traditional\startup\c018i.c
                                                   // determine if we have any more bytes to copy                           C:\mcc18\src\traditional\startup\c018i.c
000684   0100     MOVLB     0x0            	movlb curr_byte                                                                 C:\mcc18\src\traditional\startup\c018i.c
000686   537c     MOVF      0x7c,0x1,0x1   	movf curr_byte, 1, 1                                                            C:\mcc18\src\traditional\startup\c018i.c
                                           copy_loop:                                                                       C:\mcc18\src\traditional\startup\c018i.c
000688   e102     BNZ       0x68e          	bnz 2 // copy_one_byte                                                          C:\mcc18\src\traditional\startup\c018i.c
00068a   537d     MOVF      0x7d,0x1,0x1   	movf curr_byte + 1, 1, 1                                                        C:\mcc18\src\traditional\startup\c018i.c
00068c   e007     BZ        0x69c          	bz 7 // done_copying                                                            C:\mcc18\src\traditional\startup\c018i.c
                                                                                                                            C:\mcc18\src\traditional\startup\c018i.c
                                           copy_one_byte:                                                                   C:\mcc18\src\traditional\startup\c018i.c
00068e   0009     TBLRDPOSTINC             	tblrdpostinc                                                                    C:\mcc18\src\traditional\startup\c018i.c
000690   50f5     MOVF      0xf5,0x0,0x0   	movf TABLAT, 0, 0                                                               C:\mcc18\src\traditional\startup\c018i.c
000692   6eee     MOVWF     0xee,0x0       	movwf POSTINC0, 0                                                               C:\mcc18\src\traditional\startup\c018i.c
                                                                                                                            C:\mcc18\src\traditional\startup\c018i.c
                                           	// decrement byte counter                                                       C:\mcc18\src\traditional\startup\c018i.c
000694   077c     DECF      0x7c,0x1,0x1   	decf curr_byte, 1, 1                                                            C:\mcc18\src\traditional\startup\c018i.c
000696   e2f8     BC        0x688          	bc -8 // copy_loop                                                              C:\mcc18\src\traditional\startup\c018i.c
000698   077d     DECF      0x7d,0x1,0x1           decf curr_byte + 1, 1, 1                                                 C:\mcc18\src\traditional\startup\c018i.c
00069a   d7f9     BRA       0x68e          	bra -7 // copy_one_byte                                                         C:\mcc18\src\traditional\startup\c018i.c
                                                                                                                            C:\mcc18\src\traditional\startup\c018i.c
                                           done_copying:                                                                    C:\mcc18\src\traditional\startup\c018i.c
                                                                                                                            C:\mcc18\src\traditional\startup\c018i.c
                                                 _endasm                                                                    C:\mcc18\src\traditional\startup\c018i.c
                                                 /* restore the table pointer for the next entry */                         C:\mcc18\src\traditional\startup\c018i.c
00069c   c080     MOVFF     0x80,0xff6           TBLPTR = data_ptr;                                                         C:\mcc18\src\traditional\startup\c018i.c
00069e   fff6                                                                                                               
0006a0   c081     MOVFF     0x81,0xff7                                                                                      
0006a2   fff7                                                                                                               
0006a4   c082     MOVFF     0x82,0xff8                                                                                      
0006a6   fff8                                                                                                               
                                                 /* next entry... */                                                        C:\mcc18\src\traditional\startup\c018i.c
0006a8   0100     MOVLB     0x0                  curr_entry--;                                                              C:\mcc18\src\traditional\startup\c018i.c
0006aa   077e     DECF      0x7e,0x1,0x1                                                                                    
0006ac   0e00     MOVLW     0x0                                                                                             
0006ae   5b7f     SUBWFB    0x7f,0x1,0x1                                                                                    
0006b0   d7bf     BRA       0x630                goto test;                                                                 C:\mcc18\src\traditional\startup\c018i.c
                                           done:                                                                            C:\mcc18\src\traditional\startup\c018i.c
                                           ;                                                                                C:\mcc18\src\traditional\startup\c018i.c
0006b2   0012     RETURN    0x0            }                                                                                C:\mcc18\src\traditional\startup\c018i.c
                                           /*********************************************************************           C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            *                Microchip USB Bootloader Version 1.0                           C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            *********************************************************************           C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * FileName:        usbdrv.c                                                     C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * Dependencies:    See INCLUDES section below                                   C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * Processor:       PIC18                                                        C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * Compiler:        C18 2.30.01+                                                 C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * Company:         Microchip Technology, Inc.                                   C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * Software License Agreement                                                    C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * The software supplied herewith by Microchip Technology Incorporated           C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * (the “Company”) for its PICmicro® Microcontroller is intended and             C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * supplied to you, the Company’s customer, for use solely and                   C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * exclusively on Microchip PICmicro Microcontroller products. The               C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * software is owned by the Company and/or its supplier, and is                  C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * protected under applicable copyright laws. All rights are reserved.           C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * Any use in violation of the foregoing restrictions may subject the            C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * user to criminal sanctions under applicable laws, as well as to               C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * civil liability for the breach of the terms and conditions of this            C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * license.                                                                      C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * THIS SOFTWARE IS PROVIDED IN AN “AS IS” CONDITION. NO WARRANTIES,             C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * WHETHER EXPRESS, IMPLIED OR STATUTORY, INCLUDING, BUT NOT LIMITED             C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * TO, IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A                   C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * PARTICULAR PURPOSE APPLY TO THIS SOFTWARE. THE COMPANY SHALL NOT,             C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * IN ANY CIRCUMSTANCES, BE LIABLE FOR SPECIAL, INCIDENTAL OR                    C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * CONSEQUENTIAL DAMAGES, FOR ANY REASON WHATSOEVER.                             C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * Author               Date        Comment                                      C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~           C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * Rawin Rojvanit       11/19/04     Original.                                   C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            ********************************************************************/           C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                           /******************************************************************************  C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * -usbdrv.c-                                                                    C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * This file contains functions that check the hardware interrupts for           C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * USB events. The main function, USBDriverService(), should be called once      C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * every main loop.                                                              C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * This is a mini-version of the actual usbdrv.c from the Microchip USB          C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * Library. Many functions were removed to make the whole bootload application   C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * fit under 2KB, which is the size of the boot block.                           C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            *****************************************************************************/  C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                           /** I N C L U D E S **********************************************************/  C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                           #include <p18cxxx.h>                                                             C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                           #include "system\typedefs.h"                                                     C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                           #include "system\usb\usb.h"                                                      C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                           #include "io_cfg.h"             // Required for USBCheckBusStatus()              C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                           /** V A R I A B L E S ********************************************************/  C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                           #pragma udata                                                                    C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                           /** P R I V A T E  P R O T O T Y P E S ***************************************/  C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                           void USBModuleEnable(void);                                                      C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                           void USBModuleDisable(void);                                                     C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                           void USBSuspend(void);                                                           C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                           void USBWakeFromSuspend(void);                                                   C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                           void USBProtocolResetHandler(void);                                              C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                           void USB_SOF_Handler(void);                                                      C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                           void USBStallHandler(void);                                                      C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                           void USBErrorHandler(void);                                                      C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                           /** D E C L A R A T I O N S **************************************************/  C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                           #pragma code	USBBOOT                                                             C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                           /******************************************************************************  C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * Function:        void USBCheckBusStatus(void)                                 C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * PreCondition:    None                                                         C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * Input:           None                                                         C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * Output:          None                                                         C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * Side Effects:    None                                                         C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * Overview:        This routine enables/disables the USB module by monitoring   C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            *                  the USB power signal.                                        C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * Note:            None                                                         C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            *****************************************************************************/  C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                           void USBCheckBusStatus(void)                                                     C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                           {                                                                                C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
00001e   0e08     MOVLW     0x8                UCON = 0b00001000;              // Enable USBEN only                         C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
000020   6e6d     MOVWF     0x6d,0x0                                                                                        
                                               /*                                                                           C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                * After enabling the USB module, it takes some time for the voltage         C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                * on the D+ or D- line to rise high enough to get out of the SE0 condition. C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                * The USB Reset interrupt should not be unmasked until the SE0 condition is C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                * cleared. This helps preventing the firmware from misinterpreting this     C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                * unique event as a USB bus reset from the USB host.                        C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                */                                                                          C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
000022   ba6d     BTFSC     0x6d,0x5,0x0       while(UCONbits.SE0);            // Blocking loop                             C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
000024   d7fe     BRA       0x22                                                                                            
000026   6a68     CLRF      0x68,0x0           UIR = 0;                        // Clear all USB interrupts                  C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
000028   0e11     MOVLW     0x11               UIE = 0b00010001;               // Unmask RESET & IDLE interrupts only       C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
00002a   6e69     MOVWF     0x69,0x0                                                                                        
00002c   0100     MOVLB     0x0                usb_device_state = POWERED_STATE;                                            C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
00002e   0e02     MOVLW     0x2                                                                                             
000030   6f88     MOVWF     0x88,0x1                                                                                        
000032   0012     RETURN    0x0            }//end USBCheckBusStatus                                                         C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                           /******************************************************************************  C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * Function:        void USBDriverService(void)                                  C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * PreCondition:    None                                                         C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * Input:           None                                                         C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * Output:          None                                                         C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * Side Effects:    None                                                         C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * Overview:        This routine is the heart of this firmware. It manages       C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            *                  all USB interrupts.                                          C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * Note:            Device state transitions through the following stages:       C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            *                  DETACHED -> ATTACHED -> POWERED -> DEFAULT ->                C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            *                  ADDRESS_PENDING -> ADDRESSED -> CONFIGURED -> READY          C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            *****************************************************************************/  C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                           void USBDriverService(void)                                                      C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                           {                                                                                C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                               /*                                                                           C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                * Task A: Service USB Activity Interrupt                                    C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                */                                                                          C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
000034   5068     MOVF      0x68,0x0,0x0       if(UIRbits.ACTVIF && UIEbits.ACTVIE)                                         C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
000036   0b04     ANDLW     0x4                                                                                             
000038   e006     BZ        0x46                                                                                            
00003a   5069     MOVF      0x69,0x0,0x0                                                                                    
00003c   0b04     ANDLW     0x4                                                                                             
00003e   e003     BZ        0x46                                                                                            
                                               {                                                                            C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
000040   926d     BCF       0x6d,0x1,0x0           UCONbits.SUSPND = 0;                                                     C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
000042   9469     BCF       0x69,0x2,0x0           UIEbits.ACTVIE = 0;                                                      C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
000044   9468     BCF       0x68,0x2,0x0           UIRbits.ACTVIF = 0;                                                      C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                               }//end if                                                                    C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                               /*                                                                           C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                * Task B: Service USB Bus Reset Interrupt.                                  C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                * When bus reset is received during suspend, ACTVIF will be set first,      C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                * once the UCONbits.SUSPND is clear, then the URSTIF bit will be asserted.  C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                * This is why URSTIF is checked after ACTVIF.                               C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                *                                                                           C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                * The USB reset flag is masked when the USB state is in                     C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                * DETACHED_STATE or ATTACHED_STATE, and therefore cannot                    C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                * cause a USB reset event during these two states.                          C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                */                                                                          C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
000046   5068     MOVF      0x68,0x0,0x0       if(UIRbits.URSTIF && UIEbits.URSTIE)    USBProtocolResetHandler();           C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
000048   0b01     ANDLW     0x1                                                                                             
00004a   e004     BZ        0x54                                                                                            
00004c   5069     MOVF      0x69,0x0,0x0                                                                                    
00004e   0b01     ANDLW     0x1                                                                                             
000050   e001     BZ        0x54                                                                                            
000052   d827     RCALL     0xa2                                                                                            
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                               /*                                                                           C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                * Task C: Service other USB interrupts                                      C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                */                                                                          C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
000054   5068     MOVF      0x68,0x0,0x0       if(UIRbits.IDLEIF && UIEbits.IDLEIE)                                         C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
000056   0b10     ANDLW     0x10                                                                                            
000058   e009     BZ        0x6c                                                                                            
00005a   5069     MOVF      0x69,0x0,0x0                                                                                    
00005c   0b10     ANDLW     0x10                                                                                            
00005e   e006     BZ        0x6c                                                                                            
                                               {                                                                            C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
000060   8469     BSF       0x69,0x2,0x0           UIEbits.ACTVIE = 1;                     // Enable bus activity interrupt C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
000062   9868     BCF       0x68,0x4,0x0           UIRbits.IDLEIF = 0;                                                      C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
000064   826d     BSF       0x6d,0x1,0x0           UCONbits.SUSPND = 1;                    // Put USB module in power conserve C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                                                           // mode, SIE clock inactive      C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                   /* Now, go into power saving */                                          C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
000066   8aa0     BSF       0xa0,0x5,0x0           PIE2bits.USBIE = 1;                     // Set wakeup source             C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
000068   0003     SLEEP                            Sleep();                                                                 C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
00006a   9aa1     BCF       0xa1,0x5,0x0           PIR2bits.USBIF = 0;                                                      C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                               }//end if                                                                    C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
00006c   5068     MOVF      0x68,0x0,0x0       if(UIRbits.STALLIF && UIEbits.STALLIE)                                       C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
00006e   0b20     ANDLW     0x20                                                                                            
000070   e009     BZ        0x84                                                                                            
000072   5069     MOVF      0x69,0x0,0x0                                                                                    
000074   0b20     ANDLW     0x20                                                                                            
000076   e006     BZ        0x84                                                                                            
                                               {                                                                            C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
000078   a070     BTFSS     0x70,0x0,0x0           if(UEP0bits.EPSTALL == 1)                                                C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
00007a   d003     BRA       0x82                                                                                            
                                                   {                                                                        C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
00007c   eca9     CALL      0x352,0x0                  USBPrepareForNextSetupTrf();        // Firmware Work-Around          C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
00007e   f001                                                                                                               
000080   9070     BCF       0x70,0x0,0x0               UEP0bits.EPSTALL = 0;                                                C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                   }//end if                                                                C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
000082   9a68     BCF       0x68,0x5,0x0           UIRbits.STALLIF = 0;                                                     C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                               }//end if                                                                    C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                               /*                                                                           C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                * Pointless to continue servicing if the host has not sent a bus reset.     C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                * Once bus reset is received, the device transitions into the DEFAULT       C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                * state and is ready for communication.                                     C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                */                                                                          C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
000084   0e03     MOVLW     0x3                if(usb_device_state < DEFAULT_STATE) return;                                 C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
000086   0100     MOVLB     0x0                                                                                             
000088   5d88     SUBWF     0x88,0x0,0x1                                                                                    
00008a   e201     BC        0x8e                                                                                            
00008c   d009     BRA       0xa0                                                                                            
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                               /*                                                                           C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                * Task D: Servicing USB Transaction Complete Interrupt                      C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                */                                                                          C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
00008e   5068     MOVF      0x68,0x0,0x0       if(UIRbits.TRNIF && UIEbits.TRNIE)                                           C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
000090   0b08     ANDLW     0x8                                                                                             
000092   e006     BZ        0xa0                                                                                            
000094   5069     MOVF      0x69,0x0,0x0                                                                                    
000096   0b08     ANDLW     0x8                                                                                             
000098   e003     BZ        0xa0                                                                                            
                                               {                                                                            C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                   /*                                                                       C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                    * USBCtrlEPService only services transactions over EP0.                 C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                    * It ignores all other EP transactions.                                 C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                    */                                                                      C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
00009a   ecca     CALL      0x194,0x0              USBCtrlEPService();                                                      C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
00009c   f000                                                                                                               
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                   /*                                                                       C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                    * Other EP can be serviced later by responsible device class firmware.  C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                    * Each device driver knows when an OUT or IN transaction is ready by    C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                    * checking the buffer ownership bit.                                    C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                    * An OUT EP should always be owned by SIE until the data is ready.      C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                    * An IN EP should always be owned by CPU until the data is ready.       C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                    *                                                                       C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                    * Because of this logic, it is not necessary to save the USTAT value    C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                    * of non-EP0 transactions.                                              C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                    */                                                                      C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
00009e   9668     BCF       0x68,0x3,0x0           UIRbits.TRNIF = 0;                                                       C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                               }//end if(UIRbits.TRNIF && UIEbits.TRNIE)                                    C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
0000a0   0012     RETURN    0x0            }//end USBDriverService                                                          C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                           /******************************************************************************  C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * Function:        void USBProtocolResetHandler(void)                           C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * PreCondition:    A USB bus reset is received from the host.                   C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * Input:           None                                                         C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * Output:          None                                                         C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * Side Effects:    Currently, this routine flushes any pending USB              C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            *                  transactions. It empties out the USTAT FIFO. This action     C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            *                  might not be desirable in some applications.                 C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * Overview:        Once a USB bus reset is received from the host, this         C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            *                  routine should be called. It resets the device address to    C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            *                  zero, disables all non-EP0 endpoints, initializes EP0 to     C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            *                  be ready for default communication, clears all USB           C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            *                  interrupt flags, unmasks applicable USB interrupts, and      C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            *                  reinitializes internal state-machine variables.              C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            * Note:            None                                                         C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                            *****************************************************************************/  C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                           void USBProtocolResetHandler(void)                                               C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                           {                                                                                C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
0000a2   6a68     CLRF      0x68,0x0           UIR = 0;                        // Clears all USB interrupts                 C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
0000a4   0e7b     MOVLW     0x7b               UIE = 0b01111011;               // Enable all interrupts except ACTVIE       C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
0000a6   6e69     MOVWF     0x69,0x0                                                                                        
0000a8   6a6e     CLRF      0x6e,0x0           UADDR = 0x00;                   // Reset to default address                  C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
0000aa   0e16     MOVLW     0x16               UEP0 = EP_CTRL|HSHK_EN;         // Init EP0 as a Ctrl EP, see usbdrv.h       C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
0000ac   6e70     MOVWF     0x70,0x0                                                                                        
0000ae   a668     BTFSS     0x68,0x3,0x0       while(UIRbits.TRNIF == 1)       // Flush any pending transactions            C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
0000b0   d002     BRA       0xb6                                                                                            
0000b4   d7fc     BRA       0xae                                                                                            
0000b2   9668     BCF       0x68,0x3,0x0           UIRbits.TRNIF = 0;                                                       C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
0000b6   986d     BCF       0x6d,0x4,0x0       UCONbits.PKTDIS = 0;            // Make sure packet processing is enabled    C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
0000b8   eca9     CALL      0x352,0x0          USBPrepareForNextSetupTrf();    // Declared in usbctrltrf.c                  C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
0000ba   f001                                                                                                               
0000bc   0100     MOVLB     0x0                usb_active_cfg = 0;             // Clear active configuration                C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
0000be   6b8a     CLRF      0x8a,0x1                                                                                        
0000c0   0100     MOVLB     0x0                usb_device_state = DEFAULT_STATE;                                            C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
0000c2   0e03     MOVLW     0x3                                                                                             
0000c4   6f88     MOVWF     0x88,0x1                                                                                        
0000c6   0012     RETURN    0x0            }//end USBProtocolResetHandler                                                   C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                           /** EOF usbdrv.c *************************************************************/  C:\fw\pedalbtldr\x201\system\usb\usbdrv\usbdrv.c
                                           /*********************************************************************           C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *                Microchip USB C18 Firmware Version 1.0                         C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *********************************************************************           C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * FileName:        usb9.c                                                       C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * Dependencies:    See INCLUDES section below                                   C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * Processor:       PIC18                                                        C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * Compiler:        C18 2.30.01+                                                 C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * Company:         Microchip Technology, Inc.                                   C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * Software License Agreement                                                    C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * The software supplied herewith by Microchip Technology Incorporated           C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * (the “Company”) for its PICmicro® Microcontroller is intended and             C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * supplied to you, the Company’s customer, for use solely and                   C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * exclusively on Microchip PICmicro Microcontroller products. The               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * software is owned by the Company and/or its supplier, and is                  C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * protected under applicable copyright laws. All rights are reserved.           C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * Any use in violation of the foregoing restrictions may subject the            C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * user to criminal sanctions under applicable laws, as well as to               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * civil liability for the breach of the terms and conditions of this            C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * license.                                                                      C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * THIS SOFTWARE IS PROVIDED IN AN “AS IS” CONDITION. NO WARRANTIES,             C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * WHETHER EXPRESS, IMPLIED OR STATUTORY, INCLUDING, BUT NOT LIMITED             C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * TO, IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A                   C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * PARTICULAR PURPOSE APPLY TO THIS SOFTWARE. THE COMPANY SHALL NOT,             C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * IN ANY CIRCUMSTANCES, BE LIABLE FOR SPECIAL, INCIDENTAL OR                    C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * CONSEQUENTIAL DAMAGES, FOR ANY REASON WHATSOEVER.                             C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * Author               Date        Comment                                      C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~           C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * Rawin Rojvanit       11/19/04     Original.                                   C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            ********************************************************************/           C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           /******************************************************************************  C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * -usb9.c-                                                                      C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * This main function in this file, USBCheckStdRequest() is called from the      C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * usbctrltrf.c to check if a standard USB request has been received or not.     C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * This is a mini-version of the actual usb9.c from the Microchip USB library.   C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * Many functions are commented out to make the whole bootload application fit   C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * under 2KB, which is the size of the boot block.                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *****************************************************************************/  C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           /** I N C L U D E S **********************************************************/  C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           #include <p18cxxx.h>                                                             C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           #include "system\typedefs.h"                                                     C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           #include "system\usb\usb.h"                                                      C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           #include "io_cfg.h"                     // Required for self_power status        C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           /** V A R I A B L E S ********************************************************/  C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           #pragma udata                                                                    C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           /** P R I V A T E  P R O T O T Y P E S ***************************************/  C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           void USBStdGetDscHandler(void);                                                  C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           void USBStdSetCfgHandler(void);                                                  C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           void USBStdGetStatusHandler(void);                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           void USBStdFeatureReqHandler(void);                                              C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           /** D E C L A R A T I O N S **************************************************/  C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           #pragma code	USBBOOT                                                             C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           /******************************************************************************  C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * Function:        void USBCheckStdRequest(void)                                C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * PreCondition:    None                                                         C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * Input:           None                                                         C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * Output:          None                                                         C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * Side Effects:    None                                                         C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * Overview:        This routine checks the setup data packet to see if it       C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *                  knows how to handle it                                       C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * Note:            None                                                         C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *****************************************************************************/  C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           void USBCheckStdRequest(void)                                                    C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           {                                                                                C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
0000c8   0104     MOVLB     0x4                if(SetupPkt.RequestType != STANDARD) return;                                 C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
0000ca   5110     MOVF      0x10,0x0,0x1                                                                                    
0000cc   0b60     ANDLW     0x60                                                                                            
0000ce   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
0000d0   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
0000d2   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
0000d4   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
0000d6   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
0000d8   0900     IORLW     0x0                                                                                             
0000da   e001     BZ        0xde                                                                                            
0000dc   0012     RETURN    0x0                                                                                             
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
0000de   5111     MOVF      0x11,0x0,0x1       switch(SetupPkt.bRequest)                                                    C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
0000e0   0a08     XORLW     0x8                                                                                             
0000e2   e039     BZ        0x156                                                                                           
0000e4   0a01     XORLW     0x1                                                                                             
0000e6   e035     BZ        0x152                                                                                           
0000e8   0a0f     XORLW     0xf                                                                                             
0000ea   e00a     BZ        0x100                                                                                           
0000ec   0a03     XORLW     0x3                                                                                             
0000ee   e001     BZ        0xf2                                                                                            
0000f0   0012     RETURN    0x0                                                                                             
                                               {                                                                            C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                   case SET_ADR:                                                            C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
0000f2   0100     MOVLB     0x0                        ctrl_trf_session_owner = MUID_USB9;                                  C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
0000f4   0e01     MOVLW     0x1                                                                                             
0000f6   6f6f     MOVWF     0x6f,0x1                                                                                        
0000f8   0100     MOVLB     0x0                        usb_device_state = ADR_PENDING_STATE;       // Update state only     C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
0000fa   0e04     MOVLW     0x4                                                                                             
0000fc   6f88     MOVWF     0x88,0x1                                                                                        
                                                       /* See USBCtrlTrfInHandler() in usbctrltrf.c for the next step */    C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
0000fe   0012     RETURN    0x0                        break;                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                   case GET_DSC:                                                            C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
000100   0100     MOVLB     0x0                        ctrl_trf_session_owner = MUID_USB9;                                  C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
000102   0e01     MOVLW     0x1                                                                                             
000104   6f6f     MOVWF     0x6f,0x1                                                                                        
000106   0104     MOVLB     0x4                        if(SetupPkt.bDscType == DSC_DEV)                                     C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
000108   0513     DECF      0x13,0x0,0x1                                                                                    
00010a   e107     BNZ       0x11a                                                                                           
                                                       {                                                                    C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
00010c   0100     MOVLB     0x0                            pSrc.bRom = (rom byte*)&device_dsc;                              C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
00010e   0eb4     MOVLW     0xb4                                                                                            
000110   6f70     MOVWF     0x70,0x1                                                                                        
000112   0e06     MOVLW     0x6                                                                                             
000114   6f71     MOVWF     0x71,0x1                                                                                        
000116   0e12     MOVLW     0x12                           wCount._word = sizeof(device_dsc);  // Set data count            C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                       }                                                                    C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
000118   d013     BRA       0x140                      else if(SetupPkt.bDscType == DSC_CFG)                                C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
00011a   0e02     MOVLW     0x2                                                                                             
00011c   5d13     SUBWF     0x13,0x0,0x1                                                                                    
00011e   e107     BNZ       0x12e                                                                                           
                                                       {                                                                    C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
000120   0100     MOVLB     0x0                            pSrc.bRom = (rom byte*)&cfg01;                                   C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
000122   0ec6     MOVLW     0xc6                                                                                            
000124   6f70     MOVWF     0x70,0x1                                                                                        
000126   0e06     MOVLW     0x6                                                                                             
000128   6f71     MOVWF     0x71,0x1                                                                                        
00012a   0e20     MOVLW     0x20                           wCount._word = sizeof(cfg01);       // Set data count            C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                       }                                                                    C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
00012c   d009     BRA       0x140                      else if(SetupPkt.bDscType == DSC_STR)                                C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
00012e   0e03     MOVLW     0x3                                                                                             
000130   5d13     SUBWF     0x13,0x0,0x1                                                                                    
000132   e10a     BNZ       0x148                                                                                           
                                                       {                                                                    C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
000134   0100     MOVLB     0x0                            pSrc.bRom = (rom byte*)&sd000;                                   C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
000136   0ee6     MOVLW     0xe6                                                                                            
000138   6f70     MOVWF     0x70,0x1                                                                                        
00013a   0e06     MOVLW     0x6                                                                                             
00013c   6f71     MOVWF     0x71,0x1                                                                                        
00013e   0e04     MOVLW     0x4                            wCount._word = sizeof(sd000);       // Set data count            C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
000140   0100     MOVLB     0x0                                                                                             
000142   6f74     MOVWF     0x74,0x1                                                                                        
000144   6b75     CLRF      0x75,0x1                                                                                        
                                                       }                                                                    C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
000146   d002     BRA       0x14c                      else                                                                 C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                           /*                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                            * This is required to stall the DEVICE_QUALIFIER request        C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                            */                                                              C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
000148   0100     MOVLB     0x0                            ctrl_trf_session_owner = MUID_NULL;                              C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
00014a   6b6f     CLRF      0x6f,0x1                                                                                        
00014c   0100     MOVLB     0x0                        usb_stat.ctrl_trf_mem = _ROM;               // Set memory type       C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
00014e   8389     BSF       0x89,0x1,0x1                                                                                    
000150   0012     RETURN    0x0                        break;                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                   case SET_CFG:                                                            C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
000152   efb9     GOTO      0x172                      USBStdSetCfgHandler();                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
000154   f000                                                                                                               
                                                       break;                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                   case GET_CFG:                                                            C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
000156   0100     MOVLB     0x0                        ctrl_trf_session_owner = MUID_USB9;                                  C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
000158   0e01     MOVLW     0x1                                                                                             
00015a   6f6f     MOVWF     0x6f,0x1                                                                                        
00015c   0100     MOVLB     0x0                        pSrc.bRam = (byte*)&usb_active_cfg;         // Set Source            C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
00015e   0e8a     MOVLW     0x8a                                                                                            
000160   6f70     MOVWF     0x70,0x1                                                                                        
000162   0e00     MOVLW     0x0                                                                                             
000164   6f71     MOVWF     0x71,0x1                                                                                        
000166   0100     MOVLB     0x0                        usb_stat.ctrl_trf_mem = _RAM;               // Set memory type       C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
000168   9389     BCF       0x89,0x1,0x1                                                                                    
00016a   0100     MOVLB     0x0                        LSB(wCount) = 1;                            // Set data count        C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
00016c   0e01     MOVLW     0x1                                                                                             
00016e   6f74     MOVWF     0x74,0x1                                                                                        
000170   0012     RETURN    0x0                        break;                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                   //case GET_STATUS:                                                       C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                   //    USBStdGetStatusHandler();                                          C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                   //    break;                                                             C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                   //case CLR_FEATURE:                                                      C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                   //case SET_FEATURE:                                                      C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                   //    USBStdFeatureReqHandler();                                         C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                   //    break;                                                             C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                   //case GET_INTF:                                                         C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                   //    ctrl_trf_session_owner = MUID_USB9;                                C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                   //    pSrc.bRam = (byte*)&usb_alt_intf+SetupPkt.bIntfID;  // Set source  C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                   //    usb_stat.ctrl_trf_mem = _RAM;               // Set memory type     C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                   //    LSB(wCount) = 1;                            // Set data count      C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                   //    break;                                                             C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                   //case SET_INTF:                                                         C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                   //    ctrl_trf_session_owner = MUID_USB9;                                C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                   //    usb_alt_intf[SetupPkt.bIntfID] = SetupPkt.bAltID;                  C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                   //    break;                                                             C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                   //case SET_DSC:                                                          C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                   //case SYNCH_FRAME:                                                      C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                   default:                                                                 C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                       break;                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                               }//end switch                                                                C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           }//end USBCheckStdRequest                                                        C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           /******************************************************************************  C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * Function:        void USBStdGetDscHandler(void)                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * PreCondition:    None                                                         C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * Input:           None                                                         C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * Output:          None                                                         C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * Side Effects:    None                                                         C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * Overview:        This routine handles the standard GET_DESCRIPTOR request.    C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *                  It utilizes tables dynamically looks up descriptor size.     C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *                  This routine should never have to be modified if the tables  C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *                  in usbdsc.c are declared correctly.                          C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * Note:            None                                                         C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *****************************************************************************/  C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //void USBStdGetDscHandler(void)                                                 C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //{                                                                              C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //    if(SetupPkt.bmRequestType == 0x80)                                         C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //    {                                                                          C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //        switch(SetupPkt.bDscType)                                              C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //        {                                                                      C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //            case DSC_DEV:                                                      C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //                ctrl_trf_session_owner = MUID_USB9;                            C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //                pSrc.bRom = (rom byte*)&device_dsc;                            C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //                wCount._word = sizeof(device_dsc);          // Set data count  C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //                break;                                                         C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //            case DSC_CFG:                                                      C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //                ctrl_trf_session_owner = MUID_USB9;                            C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //                pSrc.bRom = *(USB_CD_Ptr+SetupPkt.bDscIndex);                  C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //                wCount._word = *(pSrc.wRom+1);              // Set data count  C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //                break;                                                         C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //            case DSC_STR:                                                      C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //                ctrl_trf_session_owner = MUID_USB9;                            C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //                pSrc.bRom = *(USB_SD_Ptr+SetupPkt.bDscIndex);                  C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //                wCount._word = *pSrc.bRom;                  // Set data count  C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //                break;                                                         C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //        }//end switch                                                          C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //                                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //        usb_stat.ctrl_trf_mem = _ROM;                       // Set memory type C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //    }//end if                                                                  C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //}//end USBStdGetDscHandler                                                     C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           /******************************************************************************  C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * Function:        void USBStdSetCfgHandler(void)                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * PreCondition:    None                                                         C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * Input:           None                                                         C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * Output:          None                                                         C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * Side Effects:    None                                                         C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * Overview:        This routine first disables all endpoints by clearing        C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *                  UEP registers. It then configures (initializes) endpoints    C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *                  specified in the modifiable section.                         C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * Note:            None                                                         C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *****************************************************************************/  C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           void USBStdSetCfgHandler(void)                                                   C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           {                                                                                C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
000172   0100     MOVLB     0x0                ctrl_trf_session_owner = MUID_USB9;                                          C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
000174   0e01     MOVLW     0x1                                                                                             
000176   6f6f     MOVWF     0x6f,0x1                                                                                        
                                               //mDisableEP1to15();                          // See usbdrv.h                C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                               //ClearArray((byte*)&usb_alt_intf,MAX_NUM_INT);                              C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
000178   c412     MOVFF     0x412,0x8a         usb_active_cfg = SetupPkt.bCfgValue;                                         C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
00017a   f08a                                                                                                               
00017c   0104     MOVLB     0x4                if(SetupPkt.bCfgValue == 0)                                                  C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
00017e   5112     MOVF      0x12,0x0,0x1                                                                                    
000180   e104     BNZ       0x18a                                                                                           
000182   0100     MOVLB     0x0                    usb_device_state = ADDRESS_STATE;                                        C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
000184   0e05     MOVLW     0x5                                                                                             
000186   6f88     MOVWF     0x88,0x1                                                                                        
000188   0012     RETURN    0x0                else                                                                         C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                               {                                                                            C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
00018a   0100     MOVLB     0x0                    usb_device_state = CONFIGURED_STATE;                                     C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
00018c   0e06     MOVLW     0x6                                                                                             
00018e   6f88     MOVWF     0x88,0x1                                                                                        
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                   /* Modifiable Section */                                                 C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
000190   efb9     GOTO      0x372                  BootInitEP();                                                            C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
000192   f001                                                                                                               
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                   /* End modifiable section */                                             C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                               }//end if(SetupPkt.bcfgValue == 0)                                           C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           }//end USBStdSetCfgHandler                                                       C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           /******************************************************************************  C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * Function:        void USBStdGetStatusHandler(void)                            C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * PreCondition:    None                                                         C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * Input:           None                                                         C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * Output:          None                                                         C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * Side Effects:    None                                                         C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * Overview:        This routine handles the standard GET_STATUS request         C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * Note:            None                                                         C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *****************************************************************************/  C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //void USBStdGetStatusHandler(void)                                              C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //{                                                                              C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //    CtrlTrfData._byte0 = 0;                         // Initialize content      C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //    CtrlTrfData._byte1 = 0;                                                    C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //                                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //    switch(SetupPkt.Recipient)                                                 C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //    {                                                                          C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //        case RCPT_DEV:                                                         C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //            ctrl_trf_session_owner = MUID_USB9;                                C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //            /*                                                                 C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //             * _byte0: bit0: Self-Powered Status [0] Bus-Powered [1] Self-Powered C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //             *         bit1: RemoteWakeup        [0] Disabled    [1] Enabled   C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //             */                                                                C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //            if(self_power == 1)                     // self_power defined in io_cfg.h C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //                CtrlTrfData._byte0|=0b000000001;    // Set bit0                C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //                                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //            if(usb_stat.RemoteWakeup == 1)          // usb_stat defined in usbmmap.c C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //                CtrlTrfData._byte0|=0b00000010;     // Set bit1                C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //            break;                                                             C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //        case RCPT_INTF:                                                        C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //            ctrl_trf_session_owner = MUID_USB9;     // No data to update       C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //            break;                                                             C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //        case RCPT_EP:                                                          C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //            ctrl_trf_session_owner = MUID_USB9;                                C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //            /*                                                                 C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //             * _byte0: bit0: Halt Status [0] Not Halted [1] Halted             C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //             */                                                                C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //            pDst.bRam = (byte*)&ep0Bo+(SetupPkt.EPNum*8)+(SetupPkt.EPDir*4);   C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //            if(*pDst.bRam & _BSTALL)    // Use _BSTALL as a bit mask           C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //                CtrlTrfData._byte0=0x01;// Set bit0                            C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //            break;                                                             C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //    }//end switch                                                              C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //                                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //    if(ctrl_trf_session_owner == MUID_USB9)                                    C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //    {                                                                          C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //        pSrc.bRam = (byte*)&CtrlTrfData;            // Set Source              C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //        usb_stat.ctrl_trf_mem = _RAM;               // Set memory type         C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //        LSB(wCount) = 2;                            // Set data count          C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //    }//end if(...)                                                             C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //}//end USBStdGetStatusHandler                                                  C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           /******************************************************************************  C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * Function:        void USBStdFeatureReqHandler(void)                           C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * PreCondition:    None                                                         C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * Input:           None                                                         C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * Output:          None                                                         C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * Side Effects:    None                                                         C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * Overview:        This routine handles the standard SET & CLEAR FEATURES       C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *                  requests                                                     C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            * Note:            None                                                         C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                            *****************************************************************************/  C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //void USBStdFeatureReqHandler(void)                                             C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //{                                                                              C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //    if((SetupPkt.bFeature == DEVICE_REMOTE_WAKEUP)&&                           C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //       (SetupPkt.Recipient == RCPT_DEV))                                       C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //    {                                                                          C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //        ctrl_trf_session_owner = MUID_USB9;                                    C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //        if(SetupPkt.bRequest == SET_FEATURE)                                   C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //            usb_stat.RemoteWakeup = 1;                                         C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //        else                                                                   C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //            usb_stat.RemoteWakeup = 0;                                         C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //    }//end if                                                                  C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //                                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //    if((SetupPkt.bFeature == ENDPOINT_HALT)&&                                  C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //       (SetupPkt.Recipient == RCPT_EP)&&                                       C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //       (SetupPkt.EPNum != 0))                                                  C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //    {                                                                          C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //        ctrl_trf_session_owner = MUID_USB9;                                    C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //        /* Must do address calculation here */                                 C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //        pDst.bRam = (byte*)&ep0Bo+(SetupPkt.EPNum*8)+(SetupPkt.EPDir*4);       C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //                                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //        if(SetupPkt.bRequest == SET_FEATURE)                                   C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //            *pDst.bRam = _USIE|_BSTALL;                                        C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //        else                                                                   C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //        {                                                                      C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //            if(SetupPkt.EPDir == 1) // IN                                      C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //                *pDst.bRam = _UCPU;                                            C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //            else                                                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //                *pDst.bRam = _USIE|_DAT0|_DTSEN;                               C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //        }//end if                                                              C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //    }//end if                                                                  C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           //}//end USBStdFeatureReqHandler                                                 C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           /** EOF usb9.c ***************************************************************/  C:\fw\pedalbtldr\x201\system\usb\usb9\usb9.c
                                           /*********************************************************************           C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            *                                                                               C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            *                Microchip USB C18 Firmware Version 1.0                         C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            *                                                                               C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            *********************************************************************           C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * FileName:        usbdsc.c                                                     C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * Dependencies:    See INCLUDES section below                                   C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * Processor:       PIC18                                                        C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * Compiler:        C18 2.30.01+                                                 C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * Company:         Microchip Technology, Inc.                                   C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            *                                                                               C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * Software License Agreement                                                    C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            *                                                                               C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * The software supplied herewith by Microchip Technology Incorporated           C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * (the “Company”) for its PICmicro® Microcontroller is intended and             C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * supplied to you, the Company’s customer, for use solely and                   C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * exclusively on Microchip PICmicro Microcontroller products. The               C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * software is owned by the Company and/or its supplier, and is                  C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * protected under applicable copyright laws. All rights are reserved.           C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * Any use in violation of the foregoing restrictions may subject the            C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * user to criminal sanctions under applicable laws, as well as to               C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * civil liability for the breach of the terms and conditions of this            C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * license.                                                                      C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            *                                                                               C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * THIS SOFTWARE IS PROVIDED IN AN “AS IS” CONDITION. NO WARRANTIES,             C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * WHETHER EXPRESS, IMPLIED OR STATUTORY, INCLUDING, BUT NOT LIMITED             C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * TO, IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A                   C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * PARTICULAR PURPOSE APPLY TO THIS SOFTWARE. THE COMPANY SHALL NOT,             C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * IN ANY CIRCUMSTANCES, BE LIABLE FOR SPECIAL, INCIDENTAL OR                    C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * CONSEQUENTIAL DAMAGES, FOR ANY REASON WHATSOEVER.                             C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            *                                                                               C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            ********************************************************************/           C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                                                                                                            C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                           /*********************************************************************           C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * -usbdsc.c-                                                                    C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * This file contains the USB descriptor information. It is used                 C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * in conjunction with the usbdsc.h file. When a descriptor is added             C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * or removed from the main configuration descriptor, i.e. CFG01,                C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * the user must also change the descriptor structure defined in                 C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * the usbdsc.h file. The structure is used to calculate the                     C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * descriptor size, i.e. sizeof(CFG01).                                          C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            *                                                                               C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * A typical configuration descriptor consists of:                               C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * At least one configuration descriptor (USB_CFG_DSC)                           C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * One or more interface descriptors (USB_INTF_DSC)                              C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * One or more endpoint descriptors (USB_EP_DSC)                                 C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            *                                                                               C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * Naming Convention:                                                            C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * To resolve ambiguity, the naming convention are as followed:                  C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * - USB_CFG_DSC type should be named cdxx, where xx is the                      C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            *   configuration number. This number should match the actual                   C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            *   index value of this configuration.                                          C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * - USB_INTF_DSC type should be named i<yy>a<zz>, where yy is the               C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            *   interface number and zz is the alternate interface number.                  C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * - USB_EP_DSC type should be named ep<##><d>_i<yy>a<zz>, where                 C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            *   ## is the endpoint number and d is the direction of transfer.               C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            *   The interface name should also be listed as a suffix to identify            C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            *   which interface does the endpoint belong to.                                C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            *                                                                               C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * Example:                                                                      C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * If a device has one configuration, two interfaces; interface 0                C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * has two endpoints (in and out), and interface 1 has one endpoint(in).         C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * Then the CFG01 structure in the usbdsc.h should be:                           C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            *                                                                               C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * #define CFG01 rom struct                            \                         C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * {   USB_CFG_DSC             cd01;                   \                         C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            *     USB_INTF_DSC            i00a00;                 \                         C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            *     USB_EP_DSC              ep01o_i00a00;           \                         C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            *     USB_EP_DSC              ep01i_i00a00;           \                         C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            *     USB_INTF_DSC            i01a00;                 \                         C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            *     USB_EP_DSC              ep02i_i01a00;           \                         C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * } cfg01                                                                       C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            *                                                                               C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * Note the hierarchy of the descriptors above, it follows the USB               C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * specification requirement. All endpoints belonging to an interface            C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * should be listed immediately after that interface.                            C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            *                                                                               C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * -------------------------------------------------------------------           C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * Filling in the descriptor values in the usbdsc.c file:                        C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * -------------------------------------------------------------------           C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * Most items should be self-explanatory, however, a few will be                 C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * explained for clarification.                                                  C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            *                                                                               C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * [Configuration Descriptor(USB_CFG_DSC)]                                       C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * The configuration attribute must always have the _DEFAULT                     C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * definition at the minimum. Additional options can be ORed                     C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * to the _DEFAULT attribute. Available options are _SELF and _RWU.              C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * These definitions are defined in the usbdefs_std_dsc.h file. The              C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * _SELF tells the USB host that this device is self-powered. The                C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * _RWU tells the USB host that this device supports Remote Wakeup.              C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            *                                                                               C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * [Endpoint Descriptor(USB_EP_DSC)]                                             C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * Assume the following example:                                                 C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * sizeof(USB_EP_DSC),DSC_EP,_EP01_OUT,_BULK,64,0x00                             C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            *                                                                               C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * The first two parameters are self-explanatory. They specify the               C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * length of this endpoint descriptor (7) and the descriptor type.               C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * The next parameter identifies the endpoint, the definitions are               C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * defined in usbdefs_std_dsc.h and has the following naming                     C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * convention:                                                                   C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * _EP<##>_<dir>                                                                 C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * where ## is the endpoint number and dir is the direction of                   C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * transfer. The dir has the value of either 'OUT' or 'IN'.                      C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * The next parameter identifies the type of the endpoint. Available             C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * options are _BULK, _INT, _ISO, and _CTRL. The _CTRL is not                    C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * typically used because the default control transfer endpoint is               C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * not defined in the USB descriptors. When _ISO option is used,                 C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * addition options can be ORed to _ISO. Example:                                C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * _ISO|_AD|_FE                                                                  C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * This describes the endpoint as an isochronous pipe with adaptive              C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * and feedback attributes. See usbdefs_std_dsc.h and the USB                    C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * specification for details. The next parameter defines the size of             C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * the endpoint. The last parameter in the polling interval.                     C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            *                                                                               C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * -------------------------------------------------------------------           C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * Adding a USB String                                                           C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * -------------------------------------------------------------------           C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * A string descriptor array should have the following format:                   C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            *                                                                               C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * rom struct{byte bLength;byte bDscType;word string[size];}sdxxx={              C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * sizeof(sdxxx),DSC_STR,<text>};                                                C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            *                                                                               C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * The above structure provides a means for the C compiler to                    C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * calculate the length of string descriptor sdxxx, where xxx is the             C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * index number. The first two bytes of the descriptor are descriptor            C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * length and type. The rest <text> are string texts which must be               C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * in the unicode format. The unicode format is achieved by declaring            C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * each character as a word type. The whole text string is declared              C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * as a word array with the number of characters equals to <size>.               C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * <size> has to be manually counted and entered into the array                  C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * declaration. Let's study this through an example:                             C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * if the string is "USB" , then the string descriptor should be:                C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * (Using index 02)                                                              C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * rom struct{byte bLength;byte bDscType;word string[3];}sd002={                 C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * sizeof(sd002),DSC_STR,'U','S','B'};                                           C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            *                                                                               C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * A USB project may have multiple strings and the firmware supports             C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * the management of multiple strings through a look-up table.                   C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * The look-up table is defined as:                                              C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * rom const unsigned char *rom USB_SD_Ptr[]={&sd000,&sd001,&sd002};             C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            *                                                                               C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * The above declaration has 3 strings, sd000, sd001, and sd002.                 C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * Strings can be removed or added. sd000 is a specialized string                C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * descriptor. It defines the language code, usually this is                     C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * US English (0x0409). The index of the string must match the index             C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * position of the USB_SD_Ptr array, &sd000 must be in position                  C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * USB_SD_Ptr[0], &sd001 must be in position USB_SD_Ptr[1] and so on.            C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * The look-up table USB_SD_Ptr is used by the get string handler                C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * function in usb9.c.                                                           C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            *                                                                               C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * -------------------------------------------------------------------           C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            *                                                                               C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * The look-up table scheme also applies to the configuration                    C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * descriptor. A USB device may have multiple configuration                      C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * descriptors, i.e. CFG01, CFG02, etc. To add a configuration                   C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * descriptor, user must implement a structure similar to CFG01.                 C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * The next step is to add the configuration descriptor name, i.e.               C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * cfg01, cfg02,.., to the look-up table USB_CD_Ptr. USB_CD_Ptr[0]               C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * is a dummy place holder since configuration 0 is the un-configured            C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * state according to the definition in the USB specification.                   C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            *                                                                               C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            ********************************************************************/           C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                                                                                                            C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                           /*********************************************************************           C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * Descriptor specific type definitions are defined in:                          C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * system\usb\usbdefs\usbdefs_std_dsc.h                                          C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            *                                                                               C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * Configuration information is defined in:                                      C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            * autofiles\usbcfg.h                                                            C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                            ********************************************************************/           C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                                                                                                            C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                           /** I N C L U D E S *************************************************/           C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                           #include "system\typedefs.h"                                                     C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                           #include "system\usb\usb.h"                                                      C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                                                                                                            C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                           /** C O N S T A N T S ************************************************/          C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                           #pragma romdata                                                                  C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                                                                                                            C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                           /* Device Descriptor */                                                          C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                           rom USB_DEV_DSC device_dsc=                                                      C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                           {                                                                                C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                               sizeof(USB_DEV_DSC),    // Size of this descriptor in bytes                  C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                               DSC_DEV,                // DEVICE descriptor type                            C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                               0x0200,                 // USB Spec Release Number in BCD format             C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                               0x00,                   // Class Code                                        C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                               0x00,                   // Subclass code                                     C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                               0x00,                   // Protocol code                                     C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                               EP0_BUFF_SIZE,          // Max packet size for EP0, see usbcfg.h             C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                           	0x04D8,					//0x04D8,                 // Vendor ID                              C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                               0x000b,                 // Product ID: PICDEM FS USB (Boot Mode)             C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                               0x0000,                 // Device release number in BCD format               C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                           	0x00,                   // Manufacturer string index                            C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                               0x00,                   // Product string index                              C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                               0x00,                   // Device serial number string index                 C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                               0x01                    // Number of possible configurations                 C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                           };                                                                               C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                                                                                                            C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                           /* Configuration 1 Descriptor */                                                 C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                           CFG01=                                                                           C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                           {                                                                                C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                               /* Configuration Descriptor */                                               C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                               sizeof(USB_CFG_DSC),    // Size of this descriptor in bytes                  C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                               DSC_CFG,                // CONFIGURATION descriptor type                     C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                               sizeof(cfg01),          // Total length of data for this cfg                 C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                               1,                      // Number of interfaces in this cfg                  C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                               1,                      // Index value of this configuration                 C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                               0,                      // Configuration string index                        C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                               _DEFAULT,               // Attributes, see usbdefs_std_dsc.h                 C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                               50,                     // Max power consumption (2X mA)                     C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                                                                                                            C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                               /* Interface Descriptor */                                                   C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                               sizeof(USB_INTF_DSC),   // Size of this descriptor in bytes                  C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                               DSC_INTF,               // INTERFACE descriptor type                         C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                               0,                      // Interface Number                                  C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                               0,                      // Alternate Setting Number                          C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                               2,                      // Number of endpoints in this intf                  C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                               0x00,                   // Class code                                        C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                               0x00,                   // Subclass code                                     C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                               0x00,                   // Protocol code                                     C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                               0,                      // Interface string index                            C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                                                                                                            C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                               /* Endpoint Descriptors */                                                   C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                               sizeof(USB_EP_DSC),DSC_EP,_EP01_OUT,_BULK,BOOT_EP_SIZE,0x00,                 C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                               sizeof(USB_EP_DSC),DSC_EP,_EP01_IN,_BULK,BOOT_EP_SIZE,0x00                   C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                           };                                                                               C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                                                                                                            C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                           rom struct{byte bLength;byte bDscType;word string[1];}sd000={                    C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                           sizeof(sd000),DSC_STR,0x0409};                                                   C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                                                                                                            C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                           //Manufacturer string                                                            C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                           //rom struct{byte bLength;byte bDscType;word string[11];}MfrString={             C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                           //sizeof(MfrString),DSC_STR,                                                     C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                           //'T','r','i','p','p',' ','L','i','t','e',' '};                                  C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                                                                                                            C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                           //rom struct{byte bLength;byte bDscType;word string[14];}PrdString={             C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                           //sizeof(PrdString),DSC_STR,                                                     C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                           //'T','r','i','p','p',' ','L','i','t','e',' ','U','P','S'};                      C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                                                                                                            C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                           //rom struct{byte bLength;byte bDscType;word string[14];}SerialString={          C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                           //sizeof(SerialString),DSC_STR,                                                  C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                           //'B','O','O','T'};                                                              C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                                                                                                            C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                           #pragma code	USBBOOT                                                             C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                                                                                                            C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                           /** EOF usbdsc.c ****************************************************/           C:\fw\pedalbtldr\x201\autofiles\usbdsc.c
                                           /*********************************************************************           C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                Microchip USB C18 Firmware Version 1.0                         C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *********************************************************************           C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * FileName:        usbctrltrf.c                                                 C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Dependencies:    See INCLUDES section below                                   C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Processor:       PIC18                                                        C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Compiler:        C18 2.30.01+                                                 C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Company:         Microchip Technology, Inc.                                   C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Software License Agreement                                                    C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * The software supplied herewith by Microchip Technology Incorporated           C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * (the “Company”) for its PICmicro® Microcontroller is intended and             C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * supplied to you, the Company’s customer, for use solely and                   C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * exclusively on Microchip PICmicro Microcontroller products. The               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * software is owned by the Company and/or its supplier, and is                  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * protected under applicable copyright laws. All rights are reserved.           C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Any use in violation of the foregoing restrictions may subject the            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * user to criminal sanctions under applicable laws, as well as to               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * civil liability for the breach of the terms and conditions of this            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * license.                                                                      C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * THIS SOFTWARE IS PROVIDED IN AN “AS IS” CONDITION. NO WARRANTIES,             C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * WHETHER EXPRESS, IMPLIED OR STATUTORY, INCLUDING, BUT NOT LIMITED             C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * TO, IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A                   C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * PARTICULAR PURPOSE APPLY TO THIS SOFTWARE. THE COMPANY SHALL NOT,             C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * IN ANY CIRCUMSTANCES, BE LIABLE FOR SPECIAL, INCIDENTAL OR                    C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * CONSEQUENTIAL DAMAGES, FOR ANY REASON WHATSOEVER.                             C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Author               Date        Comment                                      C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~           C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Rawin Rojvanit       11/19/04    Original.                                    C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            ********************************************************************/           C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           /******************************************************************************  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * -usbctrltrf.c-                                                                C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * This file contains functions which handle the Control Transfer mechanism.     C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * The only function that is of interest to an end user is the                   C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * USBCtrlTrfSetupHandler(), which has a section that calls different            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * USB request handlers. A default call to the USBCheckStdRequest always         C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * exist and cannot be removed. USBCheckStdRequest contains handlers             C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * for the requests specified in chapter 9 of the USB specification.             C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * If a request cannot be serviced by USBCheckStdRequest, then it means the      C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * request is a class specific request. All device class request handlers        C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * in a project should be called from USBCtrlTrfSetupHandler().                  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * If no handlers in the project know how to service a request, then the         C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * ctrl_trf_session_owner variable would still have the value of MUID_NULL.      C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * The MUID_NULL value would cause the USBCtrlEPServiceComplete() to stall       C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * the control endpoint, effectively telling the USB host that the               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * request cannot be serviced.                                                   C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * This is a mini-version of the actual usbctrltrf.c from the Microchip USB      C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Library. Some functions were optimized to handle byte only operation instead  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * of supporting both byte and word operations.                                  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * This helps to decrease the the bootload application size to fit               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * under 2KB, which is the size of the boot block.                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *****************************************************************************/  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           /** I N C L U D E S **********************************************************/  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           #include <p18cxxx.h>                                                             C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           #include "system\typedefs.h"                                                     C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           #include "system\usb\usb.h"                                                      C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           /** V A R I A B L E S ********************************************************/  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           #pragma udata                                                                    C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           byte ctrl_trf_state;                // Control Transfer State                    C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           byte ctrl_trf_session_owner;        // Current transfer session owner            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           POINTER pSrc;                       // Data source pointer                       C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           POINTER pDst;                       // Data destination pointer                  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           WORD wCount;                        // Data counter                              C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           /** P R I V A T E  P R O T O T Y P E S ***************************************/  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           void USBCtrlTrfSetupHandler(void);                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           void USBCtrlTrfOutHandler(void);                                                 C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           void USBCtrlTrfInHandler(void);                                                  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           /** D E C L A R A T I O N S **************************************************/  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           #pragma code	USBBOOT                                                             C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           /******************************************************************************  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Function:        void USBCtrlEPService(void)                                  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * PreCondition:    USTAT is loaded with a valid endpoint address.               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Input:           None                                                         C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Output:          None                                                         C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Side Effects:    None                                                         C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Overview:        USBCtrlEPService checks for three transaction types that     C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  it knows how to service and services them:                   C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  1. EP0 SETUP                                                 C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  2. EP0 OUT                                                   C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  3. EP0 IN                                                    C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  It ignores all other types (i.e. EP1, EP2, etc.)             C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Note:            None                                                         C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *****************************************************************************/  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           void USBCtrlEPService(void)                                                      C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           {                                                                                C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
000194   506c     MOVF      0x6c,0x0,0x0       if(USTAT == EP00_OUT)                                                        C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
000196   e002     BZ        0x19c                                                                                           
000198   0e00     MOVLW     0x0                                                                                             
00019a   d001     BRA       0x19e                                                                                           
00019c   0e01     MOVLW     0x1                                                                                             
00019e   0900     IORLW     0x0                                                                                             
0001a0   e00b     BZ        0x1b8                                                                                           
                                               {                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0001a2   0104     MOVLB     0x4                    if(ep0Bo.Stat.PID == SETUP_TOKEN)           // EP0 SETUP                 C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0001a4   5100     MOVF      0x0,0x0,0x1                                                                                     
0001a6   0b3c     ANDLW     0x3c                                                                                            
0001a8   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
0001aa   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
0001ac   080d     SUBLW     0xd                                                                                             
0001ae   e102     BNZ       0x1b4                                                                                           
0001b0   efe5     GOTO      0x1ca                      USBCtrlTrfSetupHandler();                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0001b2   f000                                                                                                               
                                                   else                                        // EP0 OUT                   C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0001b4   efee     GOTO      0x1dc                      USBCtrlTrfOutHandler();                                              C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0001b6   f000                                                                                                               
                                               }                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0001b8   506c     MOVF      0x6c,0x0,0x0       else if(USTAT == EP00_IN)                       // EP0 IN                    C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0001ba   e002     BZ        0x1c0                                                                                           
0001bc   0e00     MOVLW     0x0                                                                                             
0001be   d001     BRA       0x1c2                                                                                           
0001c0   0e01     MOVLW     0x1                                                                                             
0001c2   0904     IORLW     0x4                                                                                             
0001c4   e001     BZ        0x1c8                                                                                           
0001c6   d819     RCALL     0x1fa                  USBCtrlTrfInHandler();                                                   C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0001c8   0012     RETURN    0x0            }//end USBCtrlEPService                                                          C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           /******************************************************************************  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Function:        void USBCtrlTrfSetupHandler(void)                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * PreCondition:    SetupPkt buffer is loaded with valid USB Setup Data          C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Input:           None                                                         C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Output:          None                                                         C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Side Effects:    None                                                         C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Overview:        This routine is a task dispatcher and has 3 stages.          C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  1. It initializes the control transfer state machine.        C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  2. It calls on each of the module that may know how to       C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                     service the Setup Request from the host.                  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                     Module Example: USB9, HID, CDC, MSD, ...                  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                     As new classes are added, ClassReqHandler table in        C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                     usbdsc.c should be updated to call all available          C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                     class handlers.                                           C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  3. Once each of the modules has had a chance to check if     C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                     it is responsible for servicing the request, stage 3      C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                     then checks direction of the transfer to determine how    C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                     to prepare EP0 for the control transfer.                  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                     Refer to USBCtrlEPServiceComplete() for more details.     C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Note:            Microchip USB Firmware has three different states for        C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  the control transfer state machine:                          C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  1. WAIT_SETUP                                                C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  2. CTRL_TRF_TX                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  3. CTRL_TRF_RX                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  Refer to firmware manual to find out how one state           C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  is transitioned to another.                                  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  A Control Transfer is composed of many USB transactions.     C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  When transferring data over multiple transactions,           C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  it is important to keep track of data source, data           C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  destination, and data count. These three parameters are      C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  stored in pSrc,pDst, and wCount. A flag is used to           C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  note if the data source is from ROM or RAM.                  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *****************************************************************************/  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           void USBCtrlTrfSetupHandler(void)                                                C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           {                                                                                C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                               byte i;                                                                      C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                               /* Stage 1 */                                                                C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0001ca   0100     MOVLB     0x0                ctrl_trf_state = WAIT_SETUP;                                                 C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0001cc   6b6e     CLRF      0x6e,0x1                                                                                        
0001ce   6b6f     CLRF      0x6f,0x1           ctrl_trf_session_owner = MUID_NULL;     // Set owner to NULL                 C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0001d0   6b74     CLRF      0x74,0x1           wCount._word = 0;                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0001d2   6b75     CLRF      0x75,0x1                                                                                        
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                               /* Stage 2 */                                                                C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0001d4   ec64     CALL      0xc8,0x0           USBCheckStdRequest();                   // See system\usb9\usb9.c            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0001d6   f000                                                                                                               
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                               /* Modifiable Section */                                                     C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                               /* Insert other USB Device Class Request Handlers here */                    C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                               /* End Modifiable Section */                                                 C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                               /* Stage 3 */                                                                C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0001d8   ef70     GOTO      0x2e0              USBCtrlEPServiceComplete();                                                  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0001da   f001                                                                                                               
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           }//end USBCtrlTrfSetupHandler                                                    C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           /******************************************************************************  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Function:        void USBCtrlTrfOutHandler(void)                              C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * PreCondition:    None                                                         C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Input:           None                                                         C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Output:          None                                                         C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Side Effects:    None                                                         C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Overview:        This routine handles an OUT transaction according to         C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  which control transfer state is currently active.            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Note:            Note that if the the control transfer was from               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  host to device, the session owner should be notified         C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  at the end of each OUT transaction to service the            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  received data.                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *****************************************************************************/  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           void USBCtrlTrfOutHandler(void)                                                  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           {                                                                                C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0001dc   0e02     MOVLW     0x2                if(ctrl_trf_state == CTRL_TRF_RX)                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0001de   0100     MOVLB     0x0                                                                                             
0001e0   5d6e     SUBWF     0x6e,0x0,0x1                                                                                    
0001e2   e109     BNZ       0x1f6                                                                                           
                                               {                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0001e4   d85c     RCALL     0x29e                  USBCtrlTrfRxService();                                                   C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                   /*                                                                       C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                    * Don't have to worry about overwriting _KEEP bit                       C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                    * because if _KEEP was set, TRNIF would not have been                   C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                    * generated in the first place.                                         C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                    */                                                                      C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0001e6   0104     MOVLB     0x4                    if(ep0Bo.Stat.DTS == 0)                                                  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0001e8   bd00     BTFSC     0x0,0x6,0x1                                                                                     
0001ea   d002     BRA       0x1f0                                                                                           
0001ec   0ec8     MOVLW     0xc8                       ep0Bo.Stat._byte = _USIE|_DAT1|_DTSEN;                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0001ee   d001     BRA       0x1f2                  else                                                                     C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0001f0   0e88     MOVLW     0x88                       ep0Bo.Stat._byte = _USIE|_DAT0|_DTSEN;                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0001f2   6f00     MOVWF     0x0,0x1                                                                                         
                                               }                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0001f4   0012     RETURN    0x0                else    // CTRL_TRF_TX                                                       C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0001f6   efa9     GOTO      0x352                  USBPrepareForNextSetupTrf();                                             C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0001f8   f001                                                                                                               
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           }//end USBCtrlTrfOutHandler                                                      C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           /******************************************************************************  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Function:        void USBCtrlTrfInHandler(void)                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * PreCondition:    None                                                         C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Input:           None                                                         C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Output:          None                                                         C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Side Effects:    None                                                         C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Overview:        This routine handles an IN transaction according to          C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  which control transfer state is currently active.            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Note:            A Set Address Request must not change the acutal address     C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  of the device until the completion of the control            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  transfer. The end of the control transfer for Set Address    C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  Request is an IN transaction. Therefore it is necessary      C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  to service this unique situation when the condition is       C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  right. Macro mUSBCheckAdrPendingState is defined in          C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  usb9.h and its function is to specifically service this      C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  event.                                                       C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *****************************************************************************/  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           void USBCtrlTrfInHandler(void)                                                   C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           {                                                                                C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0001fa   0e04     MOVLW     0x4                mUSBCheckAdrPendingState();         // Must check if in ADR_PENDING_STATE    C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0001fc   0100     MOVLB     0x0                                                                                             
0001fe   5d88     SUBWF     0x88,0x0,0x1                                                                                    
000200   e109     BNZ       0x214                                                                                           
000202   c412     MOVFF     0x412,0xf6e                                                                                     
000204   ff6e                                                                                                               
000206   506e     MOVF      0x6e,0x0,0x0                                                                                    
000208   0800     SUBLW     0x0                                                                                             
00020a   e202     BC        0x210                                                                                           
00020c   0e05     MOVLW     0x5                                                                                             
00020e   d001     BRA       0x212                                                                                           
000210   0e03     MOVLW     0x3                                                                                             
000212   6f88     MOVWF     0x88,0x1                                                                                        
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
000214   0100     MOVLB     0x0                if(ctrl_trf_state == CTRL_TRF_TX)                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
000216   056e     DECF      0x6e,0x0,0x1                                                                                    
000218   e109     BNZ       0x22c                                                                                           
                                               {                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
00021a   d80a     RCALL     0x230                  USBCtrlTrfTxService();                                                   C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
00021c   0104     MOVLB     0x4                    if(ep0Bi.Stat.DTS == 0)                                                  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
00021e   bd04     BTFSC     0x4,0x6,0x1                                                                                     
000220   d002     BRA       0x226                                                                                           
000222   0ec8     MOVLW     0xc8                       ep0Bi.Stat._byte = _USIE|_DAT1|_DTSEN;                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
000224   d001     BRA       0x228                  else                                                                     C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
000226   0e88     MOVLW     0x88                       ep0Bi.Stat._byte = _USIE|_DAT0|_DTSEN;                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
000228   6f04     MOVWF     0x4,0x1                                                                                         
                                               }                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
00022a   0012     RETURN    0x0                else // CTRL_TRF_RX                                                          C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
00022c   efa9     GOTO      0x352                  USBPrepareForNextSetupTrf();                                             C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
00022e   f001                                                                                                               
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           }//end USBCtrlTrfInHandler                                                       C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           /******************************************************************************  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Function:        void USBCtrlTrfTxService(void)                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * PreCondition:    pSrc, wCount, and usb_stat.ctrl_trf_mem are setup properly.  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Input:           None                                                         C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Output:          None                                                         C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Side Effects:    None                                                         C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Overview:        This routine should be called from only two places.          C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  One from USBCtrlEPServiceComplete() and one from             C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  USBCtrlTrfInHandler(). It takes care of managing a           C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  transfer over multiple USB transactions.                     C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Note:            This routine works with isochronous endpoint larger than     C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  256 bytes and is shown here as an example of how to deal     C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  with BC9 and BC8. In reality, a control endpoint can never   C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  be larger than 64 bytes.                                     C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *****************************************************************************/  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           void USBCtrlTrfTxService(void)                                                   C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           {                                                                                C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                               byte byte_to_send;                                                           C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                               /*                                                                           C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                * First, have to figure out how many byte of data to send.                  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                */                                                                          C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
000230   0100     MOVLB     0x0                if(wCount._word < EP0_BUFF_SIZE)                                             C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
000232   0e08     MOVLW     0x8                                                                                             
000234   5d74     SUBWF     0x74,0x0,0x1                                                                                    
000236   0e00     MOVLW     0x0                                                                                             
000238   5975     SUBWFB    0x75,0x0,0x1                                                                                    
00023a   e203     BC        0x242                                                                                           
00023c   c074     MOVFF     0x74,0x77              byte_to_send = wCount._word;                                             C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
00023e   f077                                                                                                               
000240   d002     BRA       0x246              else                                                                         C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
000242   0e08     MOVLW     0x8                    byte_to_send = EP0_BUFF_SIZE;                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
000244   6f77     MOVWF     0x77,0x1                                                                                        
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
000246   c077     MOVFF     0x77,0x405         ep0Bi.Cnt = byte_to_send;                                                    C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
000248   f405                                                                                                               
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                               /*                                                                           C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                * Subtract the number of bytes just about to be sent from the total.        C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                */                                                                          C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
00024a   5177     MOVF      0x77,0x0,0x1       wCount._word -= byte_to_send;                                                C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
00024c   6e00     MOVWF     0x0,0x0                                                                                         
00024e   6a01     CLRF      0x1,0x0                                                                                         
000250   5000     MOVF      0x0,0x0,0x0                                                                                     
000252   5f74     SUBWF     0x74,0x1,0x1                                                                                    
000254   5001     MOVF      0x1,0x0,0x0                                                                                     
000256   5b75     SUBWFB    0x75,0x1,0x1                                                                                    
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
000258   0e18     MOVLW     0x18               pDst.bRam = (byte*)&CtrlTrfData;        // Set destination pointer           C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
00025a   6f72     MOVWF     0x72,0x1                                                                                        
00025c   0e04     MOVLW     0x4                                                                                             
00025e   6f73     MOVWF     0x73,0x1                                                                                        
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
000260   5177     MOVF      0x77,0x0,0x1       while(byte_to_send)                                                          C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
000262   e01c     BZ        0x29c                                                                                           
00029a   d7e2     BRA       0x260                                                                                           
                                               {                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
000264   0100     MOVLB     0x0                    if(usb_stat.ctrl_trf_mem == _ROM)                                        C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
000266   a389     BTFSS     0x89,0x1,0x1                                                                                    
000268   d007     BRA       0x278                                                                                           
                                                   {                                                                        C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
00026a   c070     MOVFF     0x70,0xff6                 *pDst.bRam = *pSrc.bRom;                                             C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
00026c   fff6                                                                                                               
00026e   c071     MOVFF     0x71,0xff7                                                                                      
000270   fff7                                                                                                               
000272   0008     TBLRD                                                                                                     
000274   50f5     MOVF      0xf5,0x0,0x0                                                                                    
                                                       pSrc.bRom++;                                                         C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                   }                                                                        C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
000276   d005     BRA       0x282                  else                                                                     C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                   {                                                                        C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
000278   c070     MOVFF     0x70,0xfe9                 *pDst.bRam = *pSrc.bRam;                                             C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
00027a   ffe9                                                                                                               
00027c   c071     MOVFF     0x71,0xfea                                                                                      
00027e   ffea                                                                                                               
000280   50ef     MOVF      0xef,0x0,0x0                                                                                    
000282   c072     MOVFF     0x72,0xfe9                                                                                      
000284   ffe9                                                                                                               
000286   c073     MOVFF     0x73,0xfea                                                                                      
000288   ffea                                                                                                               
00028a   6eef     MOVWF     0xef,0x0                                                                                        
00028c   0100     MOVLB     0x0                        pSrc.bRam++;                                                         C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
00028e   2b70     INCF      0x70,0x1,0x1                                                                                    
000290   0e00     MOVLW     0x0                                                                                             
000292   2371     ADDWFC    0x71,0x1,0x1                                                                                    
                                                   }//end if else                                                           C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
000294   2b72     INCF      0x72,0x1,0x1           pDst.bRam++;                                                             C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
000296   2373     ADDWFC    0x73,0x1,0x1                                                                                    
000298   0777     DECF      0x77,0x1,0x1           byte_to_send--;                                                          C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                               }//end while                                                                 C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
00029c   0012     RETURN    0x0            }//end USBCtrlTrfTxService                                                       C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           /******************************************************************************  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Function:        void USBCtrlTrfRxService(void)                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * PreCondition:    pDst and wCount are setup properly.                          C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  pSrc is always &CtrlTrfData                                  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  usb_stat.ctrl_trf_mem is always _RAM.                        C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  wCount should be set to 0 at the start of each control       C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  transfer.                                                    C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Input:           None                                                         C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Output:          None                                                         C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Side Effects:    None                                                         C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Overview:        *** This routine is only partially complete. Check for       C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  new version of the firmware.                                 C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Note:            None                                                         C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *****************************************************************************/  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           void USBCtrlTrfRxService(void)                                                   C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           {                                                                                C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                               byte byte_to_read;                                                           C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
00029e   c401     MOVFF     0x401,0x78         byte_to_read = ep0Bo.Cnt;                                                    C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0002a0   f078                                                                                                               
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                               /*                                                                           C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                * Accumulate total number of bytes read                                     C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                */                                                                          C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0002a2   0100     MOVLB     0x0                wCount._word = wCount._word + byte_to_read;                                  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0002a4   5178     MOVF      0x78,0x0,0x1                                                                                    
0002a6   2574     ADDWF     0x74,0x0,0x1                                                                                    
0002a8   6f74     MOVWF     0x74,0x1                                                                                        
0002aa   0e00     MOVLW     0x0                                                                                             
0002ac   2175     ADDWFC    0x75,0x0,0x1                                                                                    
0002ae   6f75     MOVWF     0x75,0x1                                                                                        
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0002b0   0e18     MOVLW     0x18               pSrc.bRam = (byte*)&CtrlTrfData;                                             C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0002b2   6f70     MOVWF     0x70,0x1                                                                                        
0002b4   0e04     MOVLW     0x4                                                                                             
0002b6   6f71     MOVWF     0x71,0x1                                                                                        
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0002b8   5178     MOVF      0x78,0x0,0x1       while(byte_to_read)                                                          C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0002ba   e011     BZ        0x2de                                                                                           
0002dc   d7ed     BRA       0x2b8                                                                                           
                                               {                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0002bc   c070     MOVFF     0x70,0xfe9             *pDst.bRam = *pSrc.bRam;                                                 C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0002be   ffe9                                                                                                               
0002c0   c071     MOVFF     0x71,0xfea                                                                                      
0002c2   ffea                                                                                                               
0002c4   50ef     MOVF      0xef,0x0,0x0                                                                                    
0002c6   c072     MOVFF     0x72,0xfe9                                                                                      
0002c8   ffe9                                                                                                               
0002ca   c073     MOVFF     0x73,0xfea                                                                                      
0002cc   ffea                                                                                                               
0002ce   6eef     MOVWF     0xef,0x0                                                                                        
0002d0   2b72     INCF      0x72,0x1,0x1           pDst.bRam++;                                                             C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0002d2   0e00     MOVLW     0x0                                                                                             
0002d4   2373     ADDWFC    0x73,0x1,0x1                                                                                    
0002d6   2b70     INCF      0x70,0x1,0x1           pSrc.bRam++;                                                             C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0002d8   2371     ADDWFC    0x71,0x1,0x1                                                                                    
0002da   0778     DECF      0x78,0x1,0x1           byte_to_read--;                                                          C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                               }//end while(byte_to_read)                                                   C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0002de   0012     RETURN    0x0            }//end USBCtrlTrfRxService                                                       C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           /******************************************************************************  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Function:        void USBCtrlEPServiceComplete(void)                          C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * PreCondition:    None                                                         C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Input:           None                                                         C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Output:          None                                                         C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Side Effects:    None                                                         C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Overview:        This routine wrap up the ramaining tasks in servicing        C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  a Setup Request. Its main task is to set the endpoint        C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  controls appropriately for a given situation. See code       C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  below.                                                       C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  There are three main scenarios:                              C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  a) There was no handler for the Request, in this case        C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                     a STALL should be sent out.                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  b) The host has requested a read control transfer,           C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                     endpoints are required to be setup in a specific way.     C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  c) The host has requested a write control transfer, or       C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                     a control data stage is not required, endpoints are       C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                     required to be setup in a specific way.                   C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  Packet processing is resumed by clearing PKTDIS bit.         C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Note:            None                                                         C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *****************************************************************************/  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           void USBCtrlEPServiceComplete(void)                                              C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           {                                                                                C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0002e0   0100     MOVLB     0x0                if(ctrl_trf_session_owner == MUID_NULL)                                      C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0002e2   516f     MOVF      0x6f,0x0,0x1                                                                                    
0002e4   e105     BNZ       0x2f0                                                                                           
                                               {                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                   /*                                                                       C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                    * If no one knows how to service this request then stall.               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                    * Must also prepare EP0 to receive the next SETUP transaction.          C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                    */                                                                      C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0002e6   d83d     RCALL     0x362                  ep0Bo.Cnt = EP0_BUFF_SIZE;                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                   ep0Bo.ADR = (byte*)&SetupPkt;                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0002e8   0e84     MOVLW     0x84                   ep0Bo.Stat._byte = _USIE|_BSTALL;                                        C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0002ea   6f00     MOVWF     0x0,0x1                                                                                         
0002ec   0104     MOVLB     0x4                    ep0Bi.Stat._byte = _USIE|_BSTALL;                                        C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                               }                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0002ee   d01d     BRA       0x32a              else    // A module has claimed ownership of the control transfer session.   C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                               {                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0002f0   0104     MOVLB     0x4                    if(SetupPkt.DataDir == DEV_TO_HOST)                                      C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0002f2   af10     BTFSS     0x10,0x7,0x1                                                                                    
0002f4   d01c     BRA       0x32e                                                                                           
                                                   {                                                                        C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0002f6   0100     MOVLB     0x0                        if(SetupPkt.wLength < wCount._word)                                  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
0002f8   5174     MOVF      0x74,0x0,0x1                                                                                    
0002fa   0104     MOVLB     0x4                                                                                             
0002fc   5d16     SUBWF     0x16,0x0,0x1                                                                                    
0002fe   0100     MOVLB     0x0                                                                                             
000300   5175     MOVF      0x75,0x0,0x1                                                                                    
000302   0104     MOVLB     0x4                                                                                             
000304   5917     SUBWFB    0x17,0x0,0x1                                                                                    
000306   e204     BC        0x310                                                                                           
000308   c416     MOVFF     0x416,0x74                     wCount._word = SetupPkt.wLength;                                 C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
00030a   f074                                                                                                               
00030c   c417     MOVFF     0x417,0x75                                                                                      
00030e   f075                                                                                                               
000310   df8f     RCALL     0x230                      USBCtrlTrfTxService();                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
000312   0100     MOVLB     0x0                        ctrl_trf_state = CTRL_TRF_TX;                                        C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
000314   0e01     MOVLW     0x1                                                                                             
000316   6f6e     MOVWF     0x6e,0x1                                                                                        
                                                       /*                                                                   C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                        * Control Read:                                                     C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                        * <SETUP[0]><IN[1]><IN[0]>...<OUT[1]> | <SETUP[0]>                  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                        * 1. Prepare OUT EP to respond to early termination                 C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                        *                                                                   C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                        * NOTE:                                                             C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                        * If something went wrong during the control transfer,              C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                        * the last status stage may not be sent by the host.                C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                        * When this happens, two different things could happen              C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                        * depending on the host.                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                        * a) The host could send out a RESET.                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                        * b) The host could send out a new SETUP transaction                C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                        *    without sending a RESET first.                                 C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                        * To properly handle case (b), the OUT EP must be setup             C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                        * to receive either a zero length OUT transaction, or a             C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                        * new SETUP transaction.                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                        *                                                                   C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                        * Since the SETUP transaction requires the DTS bit to be            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                        * DAT0 while the zero length OUT status requires the DTS            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                        * bit to be DAT1, the DTS bit check by the hardware should          C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                        * be disabled. This way the SIE could accept either of              C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                        * the two transactions.                                             C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                        *                                                                   C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                        * Furthermore, the Cnt byte should be set to prepare for            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                        * the SETUP data (8-byte or more), and the buffer address           C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                        * should be pointed to SetupPkt.                                    C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                        */                                                                  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
000318   d824     RCALL     0x362                      ep0Bo.Cnt = EP0_BUFF_SIZE;                                           C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                       ep0Bo.ADR = (byte*)&SetupPkt;                                        C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
00031a   0e80     MOVLW     0x80                       ep0Bo.Stat._byte = _USIE;           // Note: DTSEN is 0!             C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
00031c   6f00     MOVWF     0x0,0x1                                                                                         
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                       /*                                                                   C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                        * 2. Prepare IN EP to transfer data, Cnt should have                C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                        *    been initialized by responsible request owner.                 C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                        */                                                                  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
00031e   0104     MOVLB     0x4                        ep0Bi.ADR = (byte*)&CtrlTrfData;                                     C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
000320   0e18     MOVLW     0x18                                                                                            
000322   6f06     MOVWF     0x6,0x1                                                                                         
000324   0e04     MOVLW     0x4                                                                                             
000326   6f07     MOVWF     0x7,0x1                                                                                         
000328   0ec8     MOVLW     0xc8                       ep0Bi.Stat._byte = _USIE|_DAT1|_DTSEN;                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
00032a   6f04     MOVWF     0x4,0x1                                                                                         
                                                   }                                                                        C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
00032c   d010     BRA       0x34e                  else    // (SetupPkt.DataDir == HOST_TO_DEV)                             C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                   {                                                                        C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
00032e   0100     MOVLB     0x0                        ctrl_trf_state = CTRL_TRF_RX;                                        C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
000330   0e02     MOVLW     0x2                                                                                             
000332   6f6e     MOVWF     0x6e,0x1                                                                                        
                                                       /*                                                                   C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                        * Control Write:                                                    C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                        * <SETUP[0]><OUT[1]><OUT[0]>...<IN[1]> | <SETUP[0]>                 C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                        *                                                                   C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                        * 1. Prepare IN EP to respond to early termination                  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                        *                                                                   C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                        *    This is the same as a Zero Length Packet Response              C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                        *    for control transfer without a data stage                      C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                        */                                                                  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
000334   0104     MOVLB     0x4                        ep0Bi.Cnt = 0;                                                       C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
000336   6b05     CLRF      0x5,0x1                                                                                         
000338   0ec8     MOVLW     0xc8                       ep0Bi.Stat._byte = _USIE|_DAT1|_DTSEN;                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
00033a   6f04     MOVWF     0x4,0x1                                                                                         
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                       /*                                                                   C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                        * 2. Prepare OUT EP to receive data.                                C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                        */                                                                  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
00033c   0104     MOVLB     0x4                        ep0Bo.Cnt = EP0_BUFF_SIZE;                                           C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
00033e   0e08     MOVLW     0x8                                                                                             
000340   6f01     MOVWF     0x1,0x1                                                                                         
000342   0e18     MOVLW     0x18                       ep0Bo.ADR = (byte*)&CtrlTrfData;                                     C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
000344   6f02     MOVWF     0x2,0x1                                                                                         
000346   0e04     MOVLW     0x4                                                                                             
000348   6f03     MOVWF     0x3,0x1                                                                                         
00034a   0ec8     MOVLW     0xc8                       ep0Bo.Stat._byte = _USIE|_DAT1|_DTSEN;                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
00034c   6f00     MOVWF     0x0,0x1                                                                                         
                                                   }//end if(SetupPkt.DataDir == DEV_TO_HOST)                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                               }//end if(ctrl_trf_session_owner == MUID_NULL)                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                               /*                                                                           C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                * PKTDIS bit is set when a Setup Transaction is received.                   C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                * Clear to resume packet processing.                                        C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                */                                                                          C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
00034e   986d     BCF       0x6d,0x4,0x0       UCONbits.PKTDIS = 0;                                                         C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
000350   0012     RETURN    0x0            }//end USBCtrlEPServiceComplete                                                  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           /******************************************************************************  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Function:        void USBPrepareForNextSetupTrf(void)                         C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * PreCondition:    None                                                         C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Input:           None                                                         C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Output:          None                                                         C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Side Effects:    None                                                         C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Overview:        The routine forces EP0 OUT to be ready for a new Setup       C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  transaction, and forces EP0 IN to be owned by CPU.           C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            * Note:            None                                                         C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                            *****************************************************************************/  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           void USBPrepareForNextSetupTrf(void)                                             C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           {                                                                                C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
000352   0100     MOVLB     0x0                ctrl_trf_state = WAIT_SETUP;            // See usbctrltrf.h                  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
000354   6b6e     CLRF      0x6e,0x1                                                                                        
000356   d805     RCALL     0x362              ep0Bo.Cnt = EP0_BUFF_SIZE;              // Defined in usbcfg.h               C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
000362   0104     MOVLB     0x4                                                                                             
000364   0e08     MOVLW     0x8                                                                                             
000366   6f01     MOVWF     0x1,0x1                                                                                         
000368   0e10     MOVLW     0x10               ep0Bo.ADR = (byte*)&SetupPkt;                                                C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
00036a   6f02     MOVWF     0x2,0x1                                                                                         
00036c   0e04     MOVLW     0x4                                                                                             
00036e   6f03     MOVWF     0x3,0x1                                                                                         
000370   0012     RETURN    0x0                                                                                             
000358   0e88     MOVLW     0x88               ep0Bo.Stat._byte = _USIE|_DAT0|_DTSEN;  // EP0 buff dsc init, see usbmmap.h  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
00035a   6f00     MOVWF     0x0,0x1                                                                                         
00035c   0104     MOVLB     0x4                ep0Bi.Stat._byte = _UCPU;               // EP0 IN buffer initialization      C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
00035e   6b04     CLRF      0x4,0x1                                                                                         
000360   0012     RETURN    0x0            }//end USBPrepareForNextSetupTrf                                                 C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           /** EOF usbctrltrf.c *********************************************************/  C:\fw\pedalbtldr\x201\system\usb\usbctrltrf\usbctrltrf.c
                                           /*********************************************************************           C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            *      Microchip USB C18 Firmware -  USB Bootloader Version 1.00                C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            *********************************************************************           C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            * FileName:        boot.c                                                       C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            * Dependencies:    See INCLUDES section below                                   C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            * Processor:       PIC18                                                        C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            * Compiler:        C18 2.30.01+                                                 C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            * Company:         Microchip Technology, Inc.                                   C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            * Software License Agreement                                                    C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            * The software supplied herewith by Microchip Technology Incorporated           C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            * (the “Company”) for its PICmicro® Microcontroller is intended and             C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            * supplied to you, the Company’s customer, for use solely and                   C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            * exclusively on Microchip PICmicro Microcontroller products. The               C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            * software is owned by the Company and/or its supplier, and is                  C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            * protected under applicable copyright laws. All rights are reserved.           C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            * Any use in violation of the foregoing restrictions may subject the            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            * user to criminal sanctions under applicable laws, as well as to               C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            * civil liability for the breach of the terms and conditions of this            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            * license.                                                                      C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            * THIS SOFTWARE IS PROVIDED IN AN “AS IS” CONDITION. NO WARRANTIES,             C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            * WHETHER EXPRESS, IMPLIED OR STATUTORY, INCLUDING, BUT NOT LIMITED             C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            * TO, IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A                   C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            * PARTICULAR PURPOSE APPLY TO THIS SOFTWARE. THE COMPANY SHALL NOT,             C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            * IN ANY CIRCUMSTANCES, BE LIABLE FOR SPECIAL, INCIDENTAL OR                    C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            * CONSEQUENTIAL DAMAGES, FOR ANY REASON WHATSOEVER.                             C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            * Author               Date        Comment                                      C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~           C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            * Rawin Rojvanit       11/19/04    Original. USB Bootloader                     C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            ********************************************************************/           C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           /******************************************************************************  C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            * -boot.c-                                                                      C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            * This file contains functions necessary to carry out bootloading tasks.        C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            * The only 2 USB specific functions are BootInitEP() and BootService().         C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            * All other functions can be reused with other communication methods.           C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            *****************************************************************************/  C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           /** I N C L U D E S **********************************************************/  C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           #include <p18cxxx.h>                                                             C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           #include "system\typedefs.h"                                                     C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           #include "system\usb\usb.h"                                                      C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           #include "io_cfg.h"                                                              C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           /** V A R I A B L E S ********************************************************/  C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           #pragma udata                                                                    C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           byte counter;                                                                    C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           byte byteTemp;                                                                   C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           byte trf_state;                                                                  C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           word big_counter;                                                                C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           /** P R I V A T E  P R O T O T Y P E S ***************************************/  C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           //void BlinkUSBStatus(void);                                                     C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           /** D E C L A R A T I O N S **************************************************/  C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           #pragma code	USBBOOT                                                             C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           /** C L A S S  S P E C I F I C  R E Q ****************************************/  C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           /** U S E R  A P I ***********************************************************/  C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           /******************************************************************************  C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            * Function:        void BootInitEP(void)                                        C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            * PreCondition:    None                                                         C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            * Input:           None                                                         C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            * Output:          None                                                         C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            * Side Effects:    None                                                         C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            * Overview:        BootInitEP initializes bootloader endpoints, buffer          C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            *                  descriptors, internal state-machine, and variables.          C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            *                  It should be called after the USB host has sent out a        C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            *                  SET_CONFIGURATION request.                                   C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            *                  See USBStdSetCfgHandler() in usb9.c for examples.            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            * Note:            None                                                         C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            *****************************************************************************/  C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           void BootInitEP(void)                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           {                                                                                C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000372   0100     MOVLB     0x0                trf_state = WAIT_FOR_CMD;                                                    C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000374   6b85     CLRF      0x85,0x1                                                                                        
000376   0e1e     MOVLW     0x1e               BOOT_UEP = EP_OUT_IN|HSHK_EN;               // Enable 2 data pipes           C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000378   6e71     MOVWF     0x71,0x0                                                                                        
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                               /*                                                                           C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                * Do not have to init Cnt of IN pipes here.                                 C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                * Reason:  Number of bytes to send to the host                              C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                *          varies from one transaction to                                   C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                *          another. Cnt should equal the exact                              C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                *          number of bytes to transmit for                                  C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                *          a given IN transaction.                                          C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                *          This number of bytes will only                                   C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                *          be known right before the data is                                C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                *          sent.                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                */                                                                          C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
00037a   0104     MOVLB     0x4                BOOT_BD_OUT.Cnt = sizeof(dataPacket);   // Set buffer size                   C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
00037c   0e40     MOVLW     0x40                                                                                            
00037e   6f09     MOVWF     0x9,0x1                                                                                         
000380   0e20     MOVLW     0x20               BOOT_BD_OUT.ADR = (byte*)&dataPacket;   // Set buffer address                C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000382   6f0a     MOVWF     0xa,0x1                                                                                         
000384   0e04     MOVLW     0x4                                                                                             
000386   6f0b     MOVWF     0xb,0x1                                                                                         
000388   0e88     MOVLW     0x88               BOOT_BD_OUT.Stat._byte = _USIE|_DAT0|_DTSEN;// Set status                    C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
00038a   6f08     MOVWF     0x8,0x1                                                                                         
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
00038c   0104     MOVLB     0x4                BOOT_BD_IN.ADR = (byte*)&dataPacket;    // Set buffer address                C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
00038e   0e20     MOVLW     0x20                                                                                            
000390   6f0e     MOVWF     0xe,0x1                                                                                         
000392   0e04     MOVLW     0x4                                                                                             
000394   6f0f     MOVWF     0xf,0x1                                                                                         
000396   0e40     MOVLW     0x40               BOOT_BD_IN.Stat._byte = _UCPU|_DAT1;    // Set buffer status                 C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000398   6f0c     MOVWF     0xc,0x1                                                                                         
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
00039a   0012     RETURN    0x0            }//end BootInitEP                                                                C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           void StartWrite(void)                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           {                                                                                C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                               /*                                                                           C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                * A write command can be prematurely terminated by MCLR or WDT reset        C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                */                                                                          C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
00039c   0e55     MOVLW     0x55               EECON2 = 0x55;                                                               C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
00039e   6ea7     MOVWF     0xa7,0x0                                                                                        
0003a0   0eaa     MOVLW     0xaa               EECON2 = 0xAA;                                                               C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
0003a2   6ea7     MOVWF     0xa7,0x0                                                                                        
0003a4   82a6     BSF       0xa6,0x1,0x0       EECON1_WR = 1;                                                               C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
0003a6   0012     RETURN    0x0            }//end StartWrite                                                                C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           void ReadVersion(void) //TESTED: Passed                                          C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           {                                                                                C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
0003a8   0104     MOVLB     0x4                dataPacket._byte[2] = MINOR_VERSION;                                         C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
0003aa   6b22     CLRF      0x22,0x1                                                                                        
0003ac   0e01     MOVLW     0x1                dataPacket._byte[3] = MAJOR_VERSION;                                         C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
0003ae   6f23     MOVWF     0x23,0x1                                                                                        
0003b0   0012     RETURN    0x0            }//end ReadVersion                                                               C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           void ReadProgMem(void) //TESTED: Passed                                          C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           {                                                                                C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
0003b2   0100     MOVLB     0x0                for (counter = 0; counter < dataPacket.len; counter++)                       C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
0003b4   6b83     CLRF      0x83,0x1                                                                                        
0003b6   d8fd     RCALL     0x5b2                                                                                           
0003b8   e20a     BC        0x3ce                                                                                           
0003ca   2b83     INCF      0x83,0x1,0x1                                                                                    
0003cc   d7f4     BRA       0x3b6                                                                                           
                                               {                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                   //2 separate inst prevents compiler from using RAM stack                 C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
0003ba   d908     RCALL     0x5cc                  byteTemp = *((dataPacket.ADR.pAdr)+counter);                             C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
0003bc   0008     TBLRD                                                                                                     
0003be   cff5     MOVFF     0xff5,0x84                                                                                      
0003c0   f084                                                                                                               
0005cc   c083     MOVFF     0x83,0x0                                                                                        
0005ce   f000                                                                                                               
0005d0   6a01     CLRF      0x1,0x0                                                                                         
0005d2   6a02     CLRF      0x2,0x0                                                                                         
0005d4   efc3     GOTO      0x586                                                                                           
0005d6   f002                                                                                                               
                                           #ifndef READ_PROTECT                                                             C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           	#ifdef ENCRYPTION_ENABLED                                                       C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                   dataPacket.data[counter] = ENCRYPTION_MASK ^ byteTemp;                   C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           	#else                                                                           C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
0003c2   0100     MOVLB     0x0                    dataPacket.data[counter] = byteTemp;                                     C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
0003c4   d8ef     RCALL     0x5a4                                                                                           
0003c6   c084     MOVFF     0x84,0xfef                                                                                      
0003c8   ffef                                                                                                               
                                           	#endif                                                                          C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           #else                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           	dataPacket.data[counter] = 0;                                                   C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           #endif                                                                           C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                               }//end for                                                                   C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
0003ce   6af8     CLRF      0xf8,0x0           TBLPTRU = 0x00;         // forces upper byte back to 0x00                    C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                                       // optional fix is to set large code model           C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
0003d0   0012     RETURN    0x0            }//end ReadProgMem                                                               C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           void WriteProgMem(void) //TESTED: Passed                                         C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           {                                                                                C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                               /*                                                                           C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                * The write holding register for the 18F4550 family is                      C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                * actually 32-byte. The code below only tries to write                      C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                * 16-byte because the GUI program only sends out 16-byte                    C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                * at a time.                                                                C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                * This limitation will be fixed in the future version.                      C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                */                                                                          C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
0003d2   0ef0     MOVLW     0xf0               dataPacket.ADR.low &= 0b11110000;  //Force 16-byte boundary                  C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
0003d4   0104     MOVLB     0x4                                                                                             
0003d6   1722     ANDWF     0x22,0x1,0x1                                                                                    
0003d8   0e84     MOVLW     0x84               EECON1 = 0b10000100;        //Setup writes: EEPGD=1,WREN=1                   C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
0003da   6ea6     MOVWF     0xa6,0x0                                                                                        
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                               //LEN = # of byte to write                                                   C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
0003dc   0100     MOVLB     0x0                for (counter = 0; counter < (dataPacket.len); counter++)                     C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
0003de   6b83     CLRF      0x83,0x1                                                                                        
0003e0   d8e8     RCALL     0x5b2                                                                                           
0003e2   e20a     BC        0x3f8                                                                                           
0003f2   0100     MOVLB     0x0                                                                                             
0003f4   2b83     INCF      0x83,0x1,0x1                                                                                    
0003f6   d7f4     BRA       0x3e0                                                                                           
                                               {                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           #ifdef ENCRYPTION_ENABLED                                                        C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                   *((dataPacket.ADR.pAdr)+counter) = \                                     C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                   ENCRYPTION_MASK ^ dataPacket.data[counter];                              C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           #else                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
0003e4   d8eb     RCALL     0x5bc                  *((dataPacket.ADR.pAdr)+counter) = \                                     C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
0005bc   dff3     RCALL     0x5a4                                                                                           
0005be   cfef     MOVFF     0xfef,0x3                                                                                       
0005c0   f003                                                                                                               
0005c2   d804     RCALL     0x5cc                                                                                           
0005c4   c003     MOVFF     0x3,0xff5                                                                                       
0005c6   fff5                                                                                                               
0005c8   000c     TBLWT                                                                                                     
0005ca   0012     RETURN    0x0                                                                                             
                                                   dataPacket.data[counter];                                                C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           #endif                                                                           C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
0003e6   0e0f     MOVLW     0xf                    if ((counter & 0b00001111) == 0b00001111)                                C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
0003e8   0100     MOVLB     0x0                                                                                             
0003ea   1583     ANDWF     0x83,0x0,0x1                                                                                    
0003ec   080f     SUBLW     0xf                                                                                             
0003ee   e101     BNZ       0x3f2                                                                                           
                                                   {                                                                        C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
0003f0   dfd5     RCALL     0x39c                      StartWrite();                                                        C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                   }//end if                                                                C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                               }//end for                                                                   C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
0003f8   0012     RETURN    0x0            }//end WriteProgMem                                                              C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           void EraseProgMem(void) //TESTED: Passed                                         C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           {                                                                                C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                               //The most significant 16 bits of the address pointer points to the block    C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                               //being erased. Bits5:0 are ignored. (In hardware).                          C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                               //LEN = # of 64-byte block to erase                                          C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
0003fa   0e94     MOVLW     0x94               EECON1 = 0b10010100;     //Setup writes: EEPGD=1,FREE=1,WREN=1               C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
0003fc   6ea6     MOVWF     0xa6,0x0                                                                                        
0003fe   0100     MOVLB     0x0                for(counter=0; counter < dataPacket.len; counter++)                          C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000400   6b83     CLRF      0x83,0x1                                                                                        
000402   d8d7     RCALL     0x5b2                                                                                           
000404   e211     BC        0x428                                                                                           
000422   0100     MOVLB     0x0                                                                                             
000424   2b83     INCF      0x83,0x1,0x1                                                                                    
000426   d7ed     BRA       0x402                                                                                           
                                               {                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000406   5183     MOVF      0x83,0x0,0x1           *(dataPacket.ADR.pAdr+(((int)counter) << 6));  //Load TBLPTR             C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000408   6e00     MOVWF     0x0,0x0                                                                                         
00040a   6a01     CLRF      0x1,0x0                                                                                         
00040c   0e06     MOVLW     0x6                                                                                             
00040e   90d8     BCF       0xd8,0x0,0x0                                                                                    
000410   3600     RLCF      0x0,0x1,0x0                                                                                     
000412   3601     RLCF      0x1,0x1,0x0                                                                                     
000414   04e8     DECF      0xe8,0x0,0x0                                                                                    
000416   e1fb     BNZ       0x40e                                                                                           
000418   6a02     CLRF      0x2,0x0                                                                                         
00041a   be01     BTFSC     0x1,0x7,0x0                                                                                     
00041c   6802     SETF      0x2,0x0                                                                                         
00041e   d8b3     RCALL     0x586                                                                                           
000420   dfbd     RCALL     0x39c                  StartWrite();                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                               }//end for                                                                   C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000428   6af8     CLRF      0xf8,0x0           TBLPTRU = 0;            // forces upper byte back to 0x00                    C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                                       // optional fix is to set large code model           C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                                       // (for USER ID 0x20 0x00 0x00)                      C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
00042a   0012     RETURN    0x0            }//end EraseProgMem                                                              C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           void ReadEE(void) //TESTED: Passed                                               C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           {                                                                                C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
00042c   6aa6     CLRF      0xa6,0x0           EECON1 = 0x00;                                                               C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
00042e   0100     MOVLB     0x0                for(counter=0; counter < dataPacket.len; counter++)                          C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000430   6b83     CLRF      0x83,0x1                                                                                        
000432   d8bf     RCALL     0x5b2                                                                                           
000434   e20b     BC        0x44c                                                                                           
000448   2b83     INCF      0x83,0x1,0x1                                                                                    
00044a   d7f3     BRA       0x432                                                                                           
                                               {                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000436   0104     MOVLB     0x4                    EEADR = (byte)dataPacket.ADR.pAdr + counter;                             C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000438   5122     MOVF      0x22,0x0,0x1                                                                                    
00043a   0100     MOVLB     0x0                                                                                             
00043c   2583     ADDWF     0x83,0x0,0x1                                                                                    
00043e   6ea9     MOVWF     0xa9,0x0                                                                                        
                                                   //EEADRH = (BYTE)(((int)dataPacket.FIELD.ADDR.POINTER + counter) >> 8);  C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000440   80a6     BSF       0xa6,0x0,0x0           EECON1_RD = 1;                                                           C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000442   d8b0     RCALL     0x5a4                  dataPacket.data[counter] = EEDATA;                                       C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000444   cfa8     MOVFF     0xfa8,0xfef                                                                                     
000446   ffef                                                                                                               
                                               }//end for                                                                   C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
00044c   0012     RETURN    0x0            }//end ReadEE                                                                    C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           void WriteEE(void) //TESTED: Passed                                              C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           {                                                                                C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
00044e   0100     MOVLB     0x0                for(counter=0; counter < dataPacket.len; counter++)                          C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000450   6b83     CLRF      0x83,0x1                                                                                        
000452   d8af     RCALL     0x5b2                                                                                           
000454   e210     BC        0x476                                                                                           
000470   0100     MOVLB     0x0                                                                                             
000472   2b83     INCF      0x83,0x1,0x1                                                                                    
000474   d7ee     BRA       0x452                                                                                           
                                               {                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000456   0104     MOVLB     0x4                    EEADR = (byte)dataPacket.ADR.pAdr + counter;                             C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000458   5122     MOVF      0x22,0x0,0x1                                                                                    
00045a   0100     MOVLB     0x0                                                                                             
00045c   2583     ADDWF     0x83,0x0,0x1                                                                                    
00045e   6ea9     MOVWF     0xa9,0x0                                                                                        
                                                   //EEADRH = (BYTE)(((int)dataPacket.FIELD.ADDR.POINTER + counter) >> 8);  C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000460   d8a1     RCALL     0x5a4                  EEDATA = dataPacket.data[counter];                                       C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000462   50ef     MOVF      0xef,0x0,0x0                                                                                    
000464   6ea8     MOVWF     0xa8,0x0                                                                                        
000466   0e04     MOVLW     0x4                    EECON1 = 0b00000100;    //Setup writes: EEPGD=0,WREN=1                   C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000468   6ea6     MOVWF     0xa6,0x0                                                                                        
00046a   df98     RCALL     0x39c                  StartWrite();                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
00046c   b2a6     BTFSC     0xa6,0x1,0x0           while(EECON1_WR);       //Wait till WR bit is clear                      C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
00046e   d7fe     BRA       0x46c                                                                                           
                                               }//end for                                                                   C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000476   0012     RETURN    0x0            }//end WriteEE                                                                   C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           //WriteConfig is different from WriteProgMem b/c it can write a byte             C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           void WriteConfig(void) //TESTED: Passed                                          C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           {                                                                                C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000478   0ec4     MOVLW     0xc4               EECON1 = 0b11000100;        //Setup writes: EEPGD=1,CFGS=1,WREN=1            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
00047a   6ea6     MOVWF     0xa6,0x0                                                                                        
00047c   0100     MOVLB     0x0                for (counter = 0; counter < dataPacket.len; counter++)                       C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
00047e   6b83     CLRF      0x83,0x1                                                                                        
000480   d898     RCALL     0x5b2                                                                                           
000482   e205     BC        0x48e                                                                                           
000488   0100     MOVLB     0x0                                                                                             
00048a   2b83     INCF      0x83,0x1,0x1                                                                                    
00048c   d7f9     BRA       0x480                                                                                           
0005b2   0104     MOVLB     0x4                                                                                             
0005b4   5121     MOVF      0x21,0x0,0x1                                                                                    
0005b6   0100     MOVLB     0x0                                                                                             
0005b8   5d83     SUBWF     0x83,0x0,0x1                                                                                    
0005ba   0012     RETURN    0x0                                                                                             
                                               {                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000484   d89b     RCALL     0x5bc                  *((dataPacket.ADR.pAdr)+counter) = \                                     C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000586   0104     MOVLB     0x4                                                                                             
000588   5122     MOVF      0x22,0x0,0x1                                                                                    
00058a   2400     ADDWF     0x0,0x0,0x0                                                                                     
00058c   6ef3     MOVWF     0xf3,0x0                                                                                        
00058e   5123     MOVF      0x23,0x0,0x1                                                                                    
000590   2001     ADDWFC    0x1,0x0,0x0                                                                                     
000592   6ef4     MOVWF     0xf4,0x0                                                                                        
000594   5124     MOVF      0x24,0x0,0x1                                                                                    
000596   2002     ADDWFC    0x2,0x0,0x0                                                                                     
000598   6ef8     MOVWF     0xf8,0x0                                                                                        
00059a   cff4     MOVFF     0xff4,0xff7                                                                                     
00059c   fff7                                                                                                               
00059e   cff3     MOVFF     0xff3,0xff6                                                                                     
0005a0   fff6                                                                                                               
0005a2   0012     RETURN    0x0                                                                                             
0005a4   5183     MOVF      0x83,0x0,0x1                                                                                    
0005a6   6aea     CLRF      0xea,0x0                                                                                        
0005a8   0f25     ADDLW     0x25                                                                                            
0005aa   6ee9     MOVWF     0xe9,0x0                                                                                        
0005ac   0e04     MOVLW     0x4                                                                                             
0005ae   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
0005b0   0012     RETURN    0x0                                                                                             
                                                   dataPacket.data[counter];                                                C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000486   df8a     RCALL     0x39c                  StartWrite();                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                               }//end for                                                                   C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
00048e   6af8     CLRF      0xf8,0x0           TBLPTRU = 0x00;         // forces upper byte back to 0x00                    C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                                       // optional fix is to set large code model           C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000490   0012     RETURN    0x0            }//end WriteConfig                                                               C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           void BootService(void)                                                           C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           {                                                                                C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           //    BlinkUSBStatus();                                                          C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000492   0e06     MOVLW     0x6                if((usb_device_state < CONFIGURED_STATE)||(UCONbits.SUSPND==1)) return;      C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000494   0100     MOVLB     0x0                                                                                             
000496   5d88     SUBWF     0x88,0x0,0x1                                                                                    
000498   e303     BNC       0x4a0                                                                                           
00049a   506d     MOVF      0x6d,0x0,0x0                                                                                    
00049c   0b02     ANDLW     0x2                                                                                             
00049e   e001     BZ        0x4a2                                                                                           
0004a0   d071     BRA       0x584                                                                                           
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
0004a2   0100     MOVLB     0x0                if(trf_state == SENDING_RESP)                                                C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
0004a4   0585     DECF      0x85,0x0,0x1                                                                                    
0004a6   e111     BNZ       0x4ca                                                                                           
                                               {                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
0004a8   0104     MOVLB     0x4                    if(!mBootTxIsBusy())                                                     C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
0004aa   bf0c     BTFSC     0xc,0x7,0x1                                                                                     
0004ac   d00d     BRA       0x4c8                                                                                           
                                                   {                                                                        C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
0004ae   0104     MOVLB     0x4                        BOOT_BD_OUT.Cnt = sizeof(dataPacket);                                C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
0004b0   0e40     MOVLW     0x40                                                                                            
0004b2   6f09     MOVWF     0x9,0x1                                                                                         
0004b4   0e40     MOVLW     0x40                       mUSBBufferReady(BOOT_BD_OUT);                                        C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
0004b6   0104     MOVLB     0x4                                                                                             
0004b8   1708     ANDWF     0x8,0x1,0x1                                                                                     
0004ba   0104     MOVLB     0x4                                                                                             
0004bc   7d08     BTG       0x8,0x6,0x1                                                                                     
0004be   0e88     MOVLW     0x88                                                                                            
0004c0   0104     MOVLB     0x4                                                                                             
0004c2   1308     IORWF     0x8,0x1,0x1                                                                                     
0004c4   0100     MOVLB     0x0                        trf_state = WAIT_FOR_CMD;                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
0004c6   6b85     CLRF      0x85,0x1                                                                                        
                                                   }//end if                                                                C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
0004c8   d05d     BRA       0x584                  return;                                                                  C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                               }//end if                                                                    C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
0004ca   0104     MOVLB     0x4                if(!mBootRxIsBusy())                                                         C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
0004cc   bf08     BTFSC     0x8,0x7,0x1                                                                                     
0004ce   d05a     BRA       0x584                                                                                           
                                               {                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
0004d0   0100     MOVLB     0x0                    counter = 0;                                                             C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
0004d2   6b83     CLRF      0x83,0x1                                                                                        
0004d4   0104     MOVLB     0x4                    switch(dataPacket.CMD)                                                   C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
0004d6   5120     MOVF      0x20,0x0,0x1                                                                                    
0004d8   0aff     XORLW     0xff                                                                                            
0004da   e034     BZ        0x544                                                                                           
0004dc   0af8     XORLW     0xf8                                                                                            
0004de   e02d     BZ        0x53a                                                                                           
0004e0   0a02     XORLW     0x2                                                                                             
0004e2   e026     BZ        0x530                                                                                           
0004e4   0a01     XORLW     0x1                                                                                             
0004e6   e01f     BZ        0x526                                                                                           
0004e8   0a07     XORLW     0x7                                                                                             
0004ea   e018     BZ        0x51c                                                                                           
0004ec   0a01     XORLW     0x1                                                                                             
0004ee   e011     BZ        0x512                                                                                           
0004f0   0a03     XORLW     0x3                                                                                             
0004f2   e00a     BZ        0x508                                                                                           
0004f4   0a07     XORLW     0x7                                                                                             
0004f6   e008     BZ        0x508                                                                                           
0004f8   0a06     XORLW     0x6                                                                                             
0004fa   e001     BZ        0x4fe                                                                                           
0004fc   d032     BRA       0x562                                                                                           
                                                   {                                                                        C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                       case READ_VERSION:                                                   C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
0004fe   df54     RCALL     0x3a8                          ReadVersion();                                                   C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000500   0100     MOVLB     0x0                            counter=0x04;                                                    C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000502   0e04     MOVLW     0x4                                                                                             
000504   6f83     MOVWF     0x83,0x1                                                                                        
000506   d02e     BRA       0x564                          break;                                                           C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           			                                                                              C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                       case READ_FLASH:                                                     C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                       case READ_CONFIG:                                                    C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000508   df54     RCALL     0x3b2                          ReadProgMem();                                                   C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
00050a   0e05     MOVLW     0x5                            counter+=0x05;                                                   C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
00050c   0100     MOVLB     0x0                                                                                             
00050e   2783     ADDWF     0x83,0x1,0x1                                                                                    
000510   d029     BRA       0x564                          break;                                                           C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           			                                                                              C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                       case WRITE_FLASH:                                                    C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000512   df5f     RCALL     0x3d2                          WriteProgMem();                                                  C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000514   0100     MOVLB     0x0                            counter=0x01;                                                    C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000516   0e01     MOVLW     0x1                                                                                             
000518   6f83     MOVWF     0x83,0x1                                                                                        
00051a   d024     BRA       0x564                          break;                                                           C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                       case ERASE_FLASH:                                                    C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
00051c   df6e     RCALL     0x3fa                          EraseProgMem();                                                  C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
00051e   0100     MOVLB     0x0                            counter=0x01;                                                    C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000520   0e01     MOVLW     0x1                                                                                             
000522   6f83     MOVWF     0x83,0x1                                                                                        
000524   d01f     BRA       0x564                          break;                                                           C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                       case READ_EEDATA:                                                    C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000526   df82     RCALL     0x42c                          ReadEE();                                                        C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000528   0e05     MOVLW     0x5                            counter+=0x05;                                                   C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
00052a   0100     MOVLB     0x0                                                                                             
00052c   2783     ADDWF     0x83,0x1,0x1                                                                                    
00052e   d01a     BRA       0x564                          break;                                                           C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                       case WRITE_EEDATA:                                                   C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000530   df8e     RCALL     0x44e                          WriteEE();                                                       C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000532   0100     MOVLB     0x0                            counter=0x01;                                                    C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000534   0e01     MOVLW     0x1                                                                                             
000536   6f83     MOVWF     0x83,0x1                                                                                        
000538   d015     BRA       0x564                          break;                                                           C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                       case WRITE_CONFIG:                                                   C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
00053a   df9e     RCALL     0x478                          WriteConfig();                                                   C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
00053c   0100     MOVLB     0x0                            counter=0x01;                                                    C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
00053e   0e01     MOVLW     0x1                                                                                             
000540   6f83     MOVWF     0x83,0x1                                                                                        
000542   d010     BRA       0x564                          break;                                                           C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                       case RESET:                                                          C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                           //When resetting, make sure to drop the device off the bus       C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                           //for a period of time. Helps when the device is suspended.      C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000544   966d     BCF       0x6d,0x3,0x0                   UCONbits.USBEN = 0;                                              C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000546   0100     MOVLB     0x0                            big_counter = 0;                                                 C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000548   6b86     CLRF      0x86,0x1                                                                                        
00054a   6b87     CLRF      0x87,0x1                                                                                        
00054c   0100     MOVLB     0x0                            while(--big_counter);                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
00054e   0786     DECF      0x86,0x1,0x1                                                                                    
000550   0e00     MOVLW     0x0                                                                                             
000552   5b87     SUBWFB    0x87,0x1,0x1                                                                                    
000554   0100     MOVLB     0x0                                                                                             
000556   5186     MOVF      0x86,0x0,0x1                                                                                    
000558   1187     IORWF     0x87,0x0,0x1                                                                                    
00055a   e001     BZ        0x55e                                                                                           
00055c   d7f7     BRA       0x54c                                                                                           
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
00055e   00ff     RESET                                    Reset();                                                         C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000560   d001     BRA       0x564                          break;                                                           C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           /*                                                                               C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                       case UPDATE_LED:                                                     C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                           if(dataPacket.led_num == 3)                                      C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                           {                                                                C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                               mLED_3 = dataPacket.led_status;                              C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                               counter = 0x01;                                              C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                           }//end if                                                        C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                           if(dataPacket.led_num == 4)                                      C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                           {                                                                C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                               mLED_4 = dataPacket.led_status;                              C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                               counter = 0x01;                                              C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                           }//end if                                                        C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                           break;                                                           C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           */                                                                               C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                       default:                                                             C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000562   d000     BRA       0x564                          break;                                                           C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                   }//end switch()                                                          C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000564   0100     MOVLB     0x0                    trf_state = SENDING_RESP;                                                C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000566   0e01     MOVLW     0x1                                                                                             
000568   6f85     MOVWF     0x85,0x1                                                                                        
00056a   0100     MOVLB     0x0                    if(counter != 0)                                                         C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
00056c   5183     MOVF      0x83,0x0,0x1                                                                                    
00056e   e00a     BZ        0x584                                                                                           
                                                   {                                                                        C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000570   c083     MOVFF     0x83,0x40d                 BOOT_BD_IN.Cnt = counter;                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000572   f40d                                                                                                               
000574   0e40     MOVLW     0x40                       mUSBBufferReady(BOOT_BD_IN);                                         C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000576   0104     MOVLB     0x4                                                                                             
000578   170c     ANDWF     0xc,0x1,0x1                                                                                     
00057a   0104     MOVLB     0x4                                                                                             
00057c   7d0c     BTG       0xc,0x6,0x1                                                                                     
00057e   0e88     MOVLW     0x88                                                                                            
000580   0104     MOVLB     0x4                                                                                             
000582   130c     IORWF     0xc,0x1,0x1                                                                                     
                                                   }//end if                                                                C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                               }//end if                                                                    C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
000584   0012     RETURN    0x0            }//end BootService                                                               C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           /******************************************************************************  C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            * Function:        void BlinkUSBStatus(void)                                    C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            * PreCondition:    None                                                         C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            * Input:           None                                                         C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            * Output:          None                                                         C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            * Side Effects:    None                                                         C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            * Overview:        BlinkUSBStatus turns on and off LEDs corresponding to        C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            *                  the USB device state.                                        C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            * Note:            mLED macros can be found in io_cfg.h                         C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            *                  usb_device_state is declared in usbmmap.c and is modified    C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            *                  in usbdrv.c, usbctrltrf.c, and usb9.c                        C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                            *****************************************************************************/  C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           /*void BlinkUSBStatus(void)                                                      C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           {                                                                                C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                               static word led_count=0;                                                     C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                               if(led_count == 0)led_count = 20000U;                                        C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                               led_count--;                                                                 C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                               #define mLED_Both_Off()         {mLED_1_Off();mLED_2_Off();}                 C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                               #define mLED_Both_On()          {mLED_1_On();mLED_2_On();}                   C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                               #define mLED_Only_1_On()        {mLED_1_On();mLED_2_Off();}                  C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                               #define mLED_Only_2_On()        {mLED_1_Off();mLED_2_On();}                  C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                               if(UCONbits.SUSPND == 1)                                                     C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                               {                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                   if(led_count==0)                                                         C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                   {                                                                        C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                       mLED_1_Toggle();                                                     C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                       mLED_2 = mLED_1;        // Both blink at the same time               C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                   }//end if                                                                C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                               }                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                               else                                                                         C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                               {                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                   if(usb_device_state == DETACHED_STATE)                                   C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                   {                                                                        C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                       mLED_Both_Off();                                                     C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                   }                                                                        C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                   else if(usb_device_state == ATTACHED_STATE)                              C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                   {                                                                        C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                       mLED_Both_On();                                                      C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                   }                                                                        C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                   else if(usb_device_state == POWERED_STATE)                               C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                   {                                                                        C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                       mLED_Only_1_On();                                                    C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                   }                                                                        C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                   else if(usb_device_state == DEFAULT_STATE)                               C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                   {                                                                        C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                       mLED_Only_2_On();                                                    C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                   }                                                                        C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                   else if(usb_device_state == ADDRESS_STATE)                               C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                   {                                                                        C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                       if(led_count == 0)                                                   C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                       {                                                                    C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                           mLED_1_Toggle();                                                 C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                           mLED_2_Off();                                                    C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                       }//end if                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                   }                                                                        C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                   else if(usb_device_state == CONFIGURED_STATE)                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                   {                                                                        C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                       if(led_count==0)                                                     C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                       {                                                                    C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                           mLED_1_Toggle();                                                 C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                           mLED_2 = !mLED_1;       // Alternate blink                       C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                       }//end if                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                   }//end if(...)                                                           C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                               }//end if(UCONbits.SUSPND...)                                                C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           }//end BlinkUSBStatus                                                            C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           */                                                                               C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           /** EOF boot.c ***************************************************************/  C:\fw\pedalbtldr\x201\system\usb\class\boot\boot.c
                                           /*********************************************************************           C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            *                Microchip USB C18 Firmware Version 1.0                         C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            *********************************************************************           C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * FileName:        usbmmap.c                                                    C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * Dependencies:    See INCLUDES section below                                   C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * Processor:       PIC18                                                        C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * Compiler:        C18 2.30.01+                                                 C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * Company:         Microchip Technology, Inc.                                   C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * Software License Agreement                                                    C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * The software supplied herewith by Microchip Technology Incorporated           C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * (the “Company”) for its PICmicro® Microcontroller is intended and             C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * supplied to you, the Company’s customer, for use solely and                   C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * exclusively on Microchip PICmicro Microcontroller products. The               C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * software is owned by the Company and/or its supplier, and is                  C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * protected under applicable copyright laws. All rights are reserved.           C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * Any use in violation of the foregoing restrictions may subject the            C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * user to criminal sanctions under applicable laws, as well as to               C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * civil liability for the breach of the terms and conditions of this            C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * license.                                                                      C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * THIS SOFTWARE IS PROVIDED IN AN “AS IS” CONDITION. NO WARRANTIES,             C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * WHETHER EXPRESS, IMPLIED OR STATUTORY, INCLUDING, BUT NOT LIMITED             C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * TO, IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A                   C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * PARTICULAR PURPOSE APPLY TO THIS SOFTWARE. THE COMPANY SHALL NOT,             C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * IN ANY CIRCUMSTANCES, BE LIABLE FOR SPECIAL, INCIDENTAL OR                    C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * CONSEQUENTIAL DAMAGES, FOR ANY REASON WHATSOEVER.                             C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * Author               Date        Comment                                      C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~           C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * Rawin Rojvanit       11/19/04    Original.                                    C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            ********************************************************************/           C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           /******************************************************************************  C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * -usbmmap.c-                                                                   C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * USB Memory Map                                                                C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * This file is the USB memory manager; it serves as a compile-time memory       C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * allocator for the USB endpoints. It uses the compile time options passed      C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * from usbcfg.h to instantiate endpoints and endpoint buffer.                   C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * Each endpoint requires to have a set of Buffer Descriptor registers(BDT).     C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * A BDT is 4-byte long and has a specific RAM location for each endpoint.       C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * The BDT for endpoint 0 out is located at address 0x400 to 0x403.              C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * The BDT for endpoint 0 in is located at address 0x404 to 0x407.               C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * The BDT for endpoint 1 out is located at address 0x408 to 0x40B.              C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * and so on... The above allocation assumes the Ping-Pong Buffer Mode 0 is      C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * used. These locations are already hard-wired in the silicon. The point        C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * of doing instantiation, i.e. volatile far BDT ep0Bo;, is to provide the       C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * C compiler a way to address each variable directly. This is very important    C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * because when a register can be accessed directly, it saves execution time     C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * and reduces program size.                                                     C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * Endpoints are defined using the endpoint number and the direction             C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * of transfer. For simplicity, usbmmap.c only uses the endpoint number          C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * in the BDT register allocation scheme. This means if the usbcfg.h states      C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * that the MAX_EP_NUMBER is number 1, then four BDTs will be                    C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * instantiated: one each for endpoint0 in and endpoint0 out, which must         C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * always be instantiated for control transfer by default, and one each sets     C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * for endpoint1 in and endpoint1 out. The naming convention for instantiating   C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * BDT is                                                                        C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * ep<#>B<d>                                                                     C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * where # is the endpoint number, and d is the direction of                     C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * transfer, which could be either <i> or <o>.                                   C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * The USB memory manager uses MAX_EP_NUMBER, as defined in usbcfg.h, to define  C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * the endpoints to be instantiated. This represents the highest endpoint        C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * number to be allocated, not how many endpoints are used. Since the BDTs for   C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * endpoints have hardware-assigned addresses in Bank 4, setting this value too  C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * high may lead to inefficient use of data RAM. For example, if an application  C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * uses only endpoints EP0 and EP4, then the MAX_EP_NUMBER is 4, and not 2.      C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * The in-between endpoint BDTs in this example (EP1, EP2, and EP3) go unused,   C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * and the 24 bytes of memory associated with them are wasted. It does not make  C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * much sense to skip endpoints, but the final decision lies with the user.      C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * The next step is to assign the instantiated BDTs to different                 C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * USB functions. The firmware framework fundamentally assumes that every USB    C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * function should know which endpoint it is using, i.e., the default control    C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * transfer should know that it is using endpoint 0 in and endpoint 0 out.       C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * A HID class can choose which endpoint it wants to use, but once chosen, it    C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * should always know the number of the endpoint.                                C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * The assignment of endpoints to USB functions is managed centrally             C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * in usbcfg.h. This helps prevent the mistake of having more                    C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * than one USB function using the same endpoint. The "Endpoint Allocation"      C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * section in usbcfg.h provides examples for how to map USB endpoints to USB     C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * functions.                                                                    C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * Quite a few things can be mapped in that section. There is no                 C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * one correct way to do the mapping and the user has the choice to              C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * choose a method that is most suitable to the application.                     C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * Typically, however, a user will want to map the following for a given         C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * USB interface function:                                                       C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * 1. The USB interface ID                                                       C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * 2. The endpoint control registers (UEPn)                                      C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * 3. The BDT registers (ep<#>B<d>)                                              C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * 4. The endpoint size                                                          C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * Example: Assume a USB device class "foo", which uses one out endpoint         C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            *          of size 64-byte and one in endpoint of size 64-byte, then:           C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * #define FOO_INTF_ID          0x00                                             C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * #define FOO_UEP              UEP1                                             C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * #define FOO_BD_OUT           ep1Bo                                            C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * #define FOO_BD_IN            ep1Bi                                            C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * #define FOO_EP_SIZE          64                                               C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * The mapping above has chosen class "foo" to use endpoint 1.                   C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * The names are arbitrary and can be anything other than FOO_??????.            C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * For abstraction, the code for class "foo" should use the abstract             C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * definitions of FOO_BD_OUT,FOO_BD_IN, and not ep1Bo or ep1Bi.                  C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * Note that the endpoint size defined in the usbcfg.h file is again             C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * used in the usbmmap.c file. This shows that the relationship between          C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * the two files are tightly related.                                            C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * The endpoint buffer for each USB function must be located in the              C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * dual-port RAM area and has to come after all the BDTs have been               C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * instantiated. An example declaration is:                                      C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * volatile far unsigned char[FOO_EP_SIZE] data;                                 C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * The 'volatile' keyword tells the compiler not to perform any code             C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * optimization on this variable because its content could be modified           C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * by the hardware. The 'far' keyword tells the compiler that this variable      C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * is not located in the Access RAM area (0x000 - 0x05F).                        C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * For the variable to be globally accessible by other files, it should be       C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * declared in the header file usbmmap.h as an extern definition, such as        C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * extern volatile far unsigned char[FOO_EP_SIZE] data;                          C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * Conclusion:                                                                   C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * In a short summary, the dependencies between usbcfg and usbmmap can           C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * be shown as:                                                                  C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * usbcfg[MAX_EP_NUMBER] -> usbmmap                                              C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * usbmmap[ep<#>B<d>] -> usbcfg                                                  C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * usbcfg[EP size] -> usbmmap                                                    C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * usbcfg[abstract ep definitions] -> usb9/hid/cdc/etc class code                C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * usbmmap[endpoint buffer variable] -> usb9/hid/cdc/etc class code              C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * Data mapping provides a means for direct addressing of BDT and endpoint       C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * buffer. This means less usage of pointers, which equates to a faster and      C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * smaller program code.                                                         C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            *****************************************************************************/  C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           /** I N C L U D E S **********************************************************/  C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           #include "system\typedefs.h"                                                     C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           #include "system\usb\usb.h"                                                      C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           /** U S B  G L O B A L  V A R I A B L E S ************************************/  C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           #pragma udata                                                                    C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           byte usb_device_state;          // Device States: DETACHED, ATTACHED, ...        C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           USB_DEVICE_STATUS usb_stat;     // Global USB flags                              C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           byte usb_active_cfg;            // Value of current configuration                C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           byte usb_alt_intf[MAX_NUM_INT]; // Array to keep track of the current alternate  C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                                                           // setting for each interface ID                 C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           /** U S B  F I X E D  L O C A T I O N  V A R I A B L E S *********************/  C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           #pragma udata usbram4=0x400     //See Linker Script,usb4:0x400-0x4FF(256-byte)   C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           /******************************************************************************  C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * Section A: Buffer Descriptor Table                                            C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * - 0x400 - 0x4FF(max)                                                          C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * - MAX_EP_NUMBER is defined in autofiles\usbcfg.h                              C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * - BDT data type is defined in system\usb\usbmmap.h                            C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            *****************************************************************************/  C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           #if(0 <= MAX_EP_NUMBER)                                                          C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           volatile far BDT ep0Bo;         //Endpoint #0 BD Out                             C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           volatile far BDT ep0Bi;         //Endpoint #0 BD In                              C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           #endif                                                                           C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           #if(1 <= MAX_EP_NUMBER)                                                          C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           volatile far BDT ep1Bo;         //Endpoint #1 BD Out                             C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           volatile far BDT ep1Bi;         //Endpoint #1 BD In                              C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           #endif                                                                           C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           #if(2 <= MAX_EP_NUMBER)                                                          C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           volatile far BDT ep2Bo;         //Endpoint #2 BD Out                             C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           volatile far BDT ep2Bi;         //Endpoint #2 BD In                              C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           #endif                                                                           C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           #if(3 <= MAX_EP_NUMBER)                                                          C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           volatile far BDT ep3Bo;         //Endpoint #3 BD Out                             C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           volatile far BDT ep3Bi;         //Endpoint #3 BD In                              C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           #endif                                                                           C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           #if(4 <= MAX_EP_NUMBER)                                                          C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           volatile far BDT ep4Bo;         //Endpoint #4 BD Out                             C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           volatile far BDT ep4Bi;         //Endpoint #4 BD In                              C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           #endif                                                                           C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           #if(5 <= MAX_EP_NUMBER)                                                          C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           volatile far BDT ep5Bo;         //Endpoint #5 BD Out                             C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           volatile far BDT ep5Bi;         //Endpoint #5 BD In                              C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           #endif                                                                           C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           #if(6 <= MAX_EP_NUMBER)                                                          C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           volatile far BDT ep6Bo;         //Endpoint #6 BD Out                             C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           volatile far BDT ep6Bi;         //Endpoint #6 BD In                              C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           #endif                                                                           C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           #if(7 <= MAX_EP_NUMBER)                                                          C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           volatile far BDT ep7Bo;         //Endpoint #7 BD Out                             C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           volatile far BDT ep7Bi;         //Endpoint #7 BD In                              C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           #endif                                                                           C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           #if(8 <= MAX_EP_NUMBER)                                                          C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           volatile far BDT ep8Bo;         //Endpoint #8 BD Out                             C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           volatile far BDT ep8Bi;         //Endpoint #8 BD In                              C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           #endif                                                                           C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           #if(9 <= MAX_EP_NUMBER)                                                          C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           volatile far BDT ep9Bo;         //Endpoint #9 BD Out                             C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           volatile far BDT ep9Bi;         //Endpoint #9 BD In                              C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           #endif                                                                           C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           #if(10 <= MAX_EP_NUMBER)                                                         C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           volatile far BDT ep10Bo;        //Endpoint #10 BD Out                            C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           volatile far BDT ep10Bi;        //Endpoint #10 BD In                             C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           #endif                                                                           C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           #if(11 <= MAX_EP_NUMBER)                                                         C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           volatile far BDT ep11Bo;        //Endpoint #11 BD Out                            C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           volatile far BDT ep11Bi;        //Endpoint #11 BD In                             C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           #endif                                                                           C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           #if(12 <= MAX_EP_NUMBER)                                                         C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           volatile far BDT ep12Bo;        //Endpoint #12 BD Out                            C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           volatile far BDT ep12Bi;        //Endpoint #12 BD In                             C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           #endif                                                                           C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           #if(13 <= MAX_EP_NUMBER)                                                         C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           volatile far BDT ep13Bo;        //Endpoint #13 BD Out                            C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           volatile far BDT ep13Bi;        //Endpoint #13 BD In                             C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           #endif                                                                           C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           #if(14 <= MAX_EP_NUMBER)                                                         C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           volatile far BDT ep14Bo;        //Endpoint #14 BD Out                            C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           volatile far BDT ep14Bi;        //Endpoint #14 BD In                             C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           #endif                                                                           C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           #if(15 <= MAX_EP_NUMBER)                                                         C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           volatile far BDT ep15Bo;        //Endpoint #15 BD Out                            C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           volatile far BDT ep15Bi;        //Endpoint #15 BD In                             C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           #endif                                                                           C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           /******************************************************************************  C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * Section B: EP0 Buffer Space                                                   C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            ******************************************************************************  C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * - Two buffer areas are defined:                                               C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            *   A. CTRL_TRF_SETUP                                                           C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            *      - Size = EP0_BUFF_SIZE as defined in autofiles\usbcfg.h                  C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            *      - Detailed data structure allows direct adddressing of bits and bytes.   C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            *   B. CTRL_TRF_DATA                                                            C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            *      - Size = EP0_BUFF_SIZE as defined in autofiles\usbcfg.h                  C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            *      - Data structure allows direct adddressing of the first 8 bytes.         C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * - Both data types are defined in system\usb\usbdefs\usbdefs_ep0_buff.h        C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            *****************************************************************************/  C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           volatile far CTRL_TRF_SETUP SetupPkt;                                            C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           volatile far CTRL_TRF_DATA CtrlTrfData;                                          C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           /******************************************************************************  C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            * Section C: Buffer                                                             C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            ******************************************************************************  C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            *                                                                               C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                            *****************************************************************************/  C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           volatile far BOOT_DATA_PACKET dataPacket;                                        C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           #pragma udata                                                                    C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                                                                                                            C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           /** EOF usbmmap.c ************************************************************/  C:\fw\pedalbtldr\x201\system\usb\usbmmap.c
                                           /*********************************************************************           C:\fw\pedalbtldr\x201\main.c
                                            *                                                                               C:\fw\pedalbtldr\x201\main.c
                                            *                Microchip USB Bootloader Version 1.0                           C:\fw\pedalbtldr\x201\main.c
                                            *                                                                               C:\fw\pedalbtldr\x201\main.c
                                            *********************************************************************           C:\fw\pedalbtldr\x201\main.c
                                            * FileName:        main.c                                                       C:\fw\pedalbtldr\x201\main.c
                                            * Dependencies:    See INCLUDES section below                                   C:\fw\pedalbtldr\x201\main.c
                                            * Processor:       PIC18                                                        C:\fw\pedalbtldr\x201\main.c
                                            * Compiler:        C18 2.30.01+                                                 C:\fw\pedalbtldr\x201\main.c
                                            * Company:         Microchip Technology, Inc.                                   C:\fw\pedalbtldr\x201\main.c
                                            *                                                                               C:\fw\pedalbtldr\x201\main.c
                                            * Software License Agreement                                                    C:\fw\pedalbtldr\x201\main.c
                                            *                                                                               C:\fw\pedalbtldr\x201\main.c
                                            * The software supplied herewith by Microchip Technology Incorporated           C:\fw\pedalbtldr\x201\main.c
                                            * (the “Company”) for its PICmicro® Microcontroller is intended and             C:\fw\pedalbtldr\x201\main.c
                                            * supplied to you, the Company’s customer, for use solely and                   C:\fw\pedalbtldr\x201\main.c
                                            * exclusively on Microchip PICmicro Microcontroller products. The               C:\fw\pedalbtldr\x201\main.c
                                            * software is owned by the Company and/or its supplier, and is                  C:\fw\pedalbtldr\x201\main.c
                                            * protected under applicable copyright laws. All rights are reserved.           C:\fw\pedalbtldr\x201\main.c
                                            * Any use in violation of the foregoing restrictions may subject the            C:\fw\pedalbtldr\x201\main.c
                                            * user to criminal sanctions under applicable laws, as well as to               C:\fw\pedalbtldr\x201\main.c
                                            * civil liability for the breach of the terms and conditions of this            C:\fw\pedalbtldr\x201\main.c
                                            * license.                                                                      C:\fw\pedalbtldr\x201\main.c
                                            *                                                                               C:\fw\pedalbtldr\x201\main.c
                                            * THIS SOFTWARE IS PROVIDED IN AN “AS IS” CONDITION. NO WARRANTIES,             C:\fw\pedalbtldr\x201\main.c
                                            * WHETHER EXPRESS, IMPLIED OR STATUTORY, INCLUDING, BUT NOT LIMITED             C:\fw\pedalbtldr\x201\main.c
                                            * TO, IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A                   C:\fw\pedalbtldr\x201\main.c
                                            * PARTICULAR PURPOSE APPLY TO THIS SOFTWARE. THE COMPANY SHALL NOT,             C:\fw\pedalbtldr\x201\main.c
                                            * IN ANY CIRCUMSTANCES, BE LIABLE FOR SPECIAL, INCIDENTAL OR                    C:\fw\pedalbtldr\x201\main.c
                                            * CONSEQUENTIAL DAMAGES, FOR ANY REASON WHATSOEVER.                             C:\fw\pedalbtldr\x201\main.c
                                            *                                                                               C:\fw\pedalbtldr\x201\main.c
                                            * Author               Date        Comment                                      C:\fw\pedalbtldr\x201\main.c
                                            *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~           C:\fw\pedalbtldr\x201\main.c
                                            * Rawin Rojvanit       11/19/04     Original.                                   C:\fw\pedalbtldr\x201\main.c
                                            ********************************************************************/           C:\fw\pedalbtldr\x201\main.c
                                                                                                                            C:\fw\pedalbtldr\x201\main.c
                                           /** I N C L U D E S **********************************************************/  C:\fw\pedalbtldr\x201\main.c
                                           #include <p18cxxx.h>                                                             C:\fw\pedalbtldr\x201\main.c
                                           #include "system\typedefs.h"                        // Required                  C:\fw\pedalbtldr\x201\main.c
                                           #include "system\usb\usb.h"                         // Required                  C:\fw\pedalbtldr\x201\main.c
                                           #include "io_cfg.h"                                 // Required                  C:\fw\pedalbtldr\x201\main.c
                                                                                                                            C:\fw\pedalbtldr\x201\main.c
                                           #include "system\usb\usb_compile_time_validation.h" // Optional                  C:\fw\pedalbtldr\x201\main.c
                                                                                                                            C:\fw\pedalbtldr\x201\main.c
                                           /** CONFIGURATION BITS ********************************************************/ C:\fw\pedalbtldr\x201\main.c
                                           #pragma config PLLDIV = 2,		CPUDIV = OSC4_PLL6,		USBDIV = 2                      C:\fw\pedalbtldr\x201\main.c
                                           #pragma config FOSC = HSPLL_HS,	FCMEM = OFF,			IESO = OFF                        C:\fw\pedalbtldr\x201\main.c
                                           #pragma config PWRT = ON,		BOR = ON, 				BORV = 28,		VREGEN = ON                 C:\fw\pedalbtldr\x201\main.c
                                           #pragma config WDT = OFF	//,		WDTPS = 128                                        C:\fw\pedalbtldr\x201\main.c
                                           #pragma config MCLRE = ON,		LPT1OSC = OFF,			PBADEN = OFF,	CCP2MX = ON           C:\fw\pedalbtldr\x201\main.c
                                           #pragma config STVREN = ON,		LVP = OFF,				ICPRT = OFF,	XINST = OFF,	DEBUG = OFF C:\fw\pedalbtldr\x201\main.c
                                           #pragma config CP0 = OFF,		CP1 = OFF,				CP2 = OFF,		CP3 = OFF                   C:\fw\pedalbtldr\x201\main.c
                                           #pragma config CPB = OFF,		CPD = OFF                                             C:\fw\pedalbtldr\x201\main.c
                                           #pragma config WRT0 = OFF,		WRT1 = OFF,				WRT2 = OFF,		WRT3 = OFF               C:\fw\pedalbtldr\x201\main.c
                                           #pragma config WRTC = ON,		WRTB = ON,				WRTD = OFF                              C:\fw\pedalbtldr\x201\main.c
                                           #pragma config EBTR0 = OFF,		EBTR1 = OFF,			EBTR2 = OFF,	EBTR3 = OFF             C:\fw\pedalbtldr\x201\main.c
                                           #pragma config EBTRB = OFF                                                       C:\fw\pedalbtldr\x201\main.c
                                                                                                                            C:\fw\pedalbtldr\x201\main.c
                                           /** V A R I A B L E S ********************************************************/  C:\fw\pedalbtldr\x201\main.c
                                           #pragma udata                                                                    C:\fw\pedalbtldr\x201\main.c
                                                                                                                            C:\fw\pedalbtldr\x201\main.c
                                           /** P R I V A T E  P R O T O T Y P E S ***************************************/  C:\fw\pedalbtldr\x201\main.c
                                           void BOOT_LOAD_MODE (void);                                                      C:\fw\pedalbtldr\x201\main.c
                                                                                                                            C:\fw\pedalbtldr\x201\main.c
                                           /** V E C T O R  R E M A P P I N G *******************************************/  C:\fw\pedalbtldr\x201\main.c
                                                                                                                            C:\fw\pedalbtldr\x201\main.c
                                           #pragma code _HIGH_INTERRUPT_VECTOR = 0x000008                                   C:\fw\pedalbtldr\x201\main.c
                                           void _high_ISR (void)                                                            C:\fw\pedalbtldr\x201\main.c
                                           {                                                                                C:\fw\pedalbtldr\x201\main.c
000008   ef04     GOTO      0xa08              _asm goto RM_HIGH_INTERRUPT_VECTOR  _endasm                                  C:\fw\pedalbtldr\x201\main.c
00000a   f005                                                                                                               
00000c   0012     RETURN    0x0            }                                                                                C:\fw\pedalbtldr\x201\main.c
                                                                                                                            C:\fw\pedalbtldr\x201\main.c
                                           #pragma code _LOW_INTERRUPT_VECTOR = 0x000018                                    C:\fw\pedalbtldr\x201\main.c
                                           void _low_ISR (void)                                                             C:\fw\pedalbtldr\x201\main.c
                                           {                                                                                C:\fw\pedalbtldr\x201\main.c
000018   ef0c     GOTO      0xa18              _asm goto RM_LOW_INTERRUPT_VECTOR  _endasm                                   C:\fw\pedalbtldr\x201\main.c
00001a   f005                                                                                                               
00001c   0012     RETURN    0x0            }                                                                                C:\fw\pedalbtldr\x201\main.c
                                                                                                                            C:\fw\pedalbtldr\x201\main.c
                                           #pragma code	USBBOOT                                                             C:\fw\pedalbtldr\x201\main.c
                                                                                                                            C:\fw\pedalbtldr\x201\main.c
                                           /** D E C L A R A T I O N S **************************************************/  C:\fw\pedalbtldr\x201\main.c
                                           #pragma code	USBBOOT                                                             C:\fw\pedalbtldr\x201\main.c
                                           /******************************************************************************  C:\fw\pedalbtldr\x201\main.c
                                            * Function:        void main(void)                                              C:\fw\pedalbtldr\x201\main.c
                                            *                                                                               C:\fw\pedalbtldr\x201\main.c
                                            * PreCondition:    None                                                         C:\fw\pedalbtldr\x201\main.c
                                            *                                                                               C:\fw\pedalbtldr\x201\main.c
                                            * Input:           None                                                         C:\fw\pedalbtldr\x201\main.c
                                            *                                                                               C:\fw\pedalbtldr\x201\main.c
                                            * Output:          None                                                         C:\fw\pedalbtldr\x201\main.c
                                            *                                                                               C:\fw\pedalbtldr\x201\main.c
                                            * Side Effects:    None                                                         C:\fw\pedalbtldr\x201\main.c
                                            *                                                                               C:\fw\pedalbtldr\x201\main.c
                                            * Overview:        Main program entry point.                                    C:\fw\pedalbtldr\x201\main.c
                                            *                                                                               C:\fw\pedalbtldr\x201\main.c
                                            * Note:            None                                                         C:\fw\pedalbtldr\x201\main.c
                                            *****************************************************************************/  C:\fw\pedalbtldr\x201\main.c
                                           extern	void StartOfLine(void);                                                   C:\fw\pedalbtldr\x201\main.c
                                           extern	void VERIFY_PROGRAM_MEMORY(void);                                         C:\fw\pedalbtldr\x201\main.c
                                                                                                                            C:\fw\pedalbtldr\x201\main.c
                                           void main(void)                                                                  C:\fw\pedalbtldr\x201\main.c
                                           {                                                                                C:\fw\pedalbtldr\x201\main.c
                                           //    byte temp;                                                                 C:\fw\pedalbtldr\x201\main.c
                                           	unsigned char Temp0;                                                            C:\fw\pedalbtldr\x201\main.c
                                           //    temp = ADCON1;                                                             C:\fw\pedalbtldr\x201\main.c
                                           //    ADCON1 |= 0x0F;                                                            C:\fw\pedalbtldr\x201\main.c
                                                                                                                            C:\fw\pedalbtldr\x201\main.c
0005d8   9c94     BCF       0x94,0x6,0x0    	DDRCbits.RC6=0;				// Setup tx pin                                             C:\fw\pedalbtldr\x201\main.c
                                           //	DDRC.RC7=1;					// Setup rx pin                                               C:\fw\pedalbtldr\x201\main.c
0005da   0e90     MOVLW     0x90           	RCSTA=0x90;	//b'10010000';	// Setup rx and tx                                   C:\fw\pedalbtldr\x201\main.c
0005dc   6eab     MOVWF     0xab,0x0                                                                                        
0005de   0e46     MOVLW     0x46           	TXSTA=0x46;	//b'00100110';		                                                    C:\fw\pedalbtldr\x201\main.c
0005e0   6eac     MOVWF     0xac,0x0                                                                                        
0005e2   88ab     BSF       0xab,0x4,0x0   	RCSTAbits.CREN=1;			// Start receiving                                          C:\fw\pedalbtldr\x201\main.c
0005e4   50ae     MOVF      0xae,0x0,0x0   	WREG=RCREG;					// Empty the buffer                                             C:\fw\pedalbtldr\x201\main.c
0005e6   6ee8     MOVWF     0xe8,0x0                                                                                        
0005e8   50ae     MOVF      0xae,0x0,0x0   	WREG=RCREG;                                                                     C:\fw\pedalbtldr\x201\main.c
0005ea   6ee8     MOVWF     0xe8,0x0                                                                                        
                                                                                                                            C:\fw\pedalbtldr\x201\main.c
                                               //TRISBbits.TRISB4 = 1;     // Reset value is already '1'                    C:\fw\pedalbtldr\x201\main.c
                                                                                                                            C:\fw\pedalbtldr\x201\main.c
                                                                                                                            C:\fw\pedalbtldr\x201\main.c
                                                                                                                            C:\fw\pedalbtldr\x201\main.c
                                           //Check Bootload Mode Entry Condition                                            C:\fw\pedalbtldr\x201\main.c
0005ec   a881     BTFSS     0x81,0x4,0x0       if(PORTBbits.RB4 == 1)      // If not pressed, User Mode                     C:\fw\pedalbtldr\x201\main.c
0005ee   d002     BRA       0x5f4                                                                                           
                                               {                                                                            C:\fw\pedalbtldr\x201\main.c
0005f0   efb7     GOTO      0x96e                  _asm goto VERIFY_PROGRAM_MEMORY _endasm                                  C:\fw\pedalbtldr\x201\main.c
0005f2   f004                                                                                                               
                                               }                                                                            C:\fw\pedalbtldr\x201\main.c
                                                                                                                            C:\fw\pedalbtldr\x201\main.c
0005f4   d803     RCALL     0x5fc          	BOOT_LOAD_MODE();                                                               C:\fw\pedalbtldr\x201\main.c
0005f6   efb7     GOTO      0x96e          _asm goto VERIFY_PROGRAM_MEMORY _endasm                                          C:\fw\pedalbtldr\x201\main.c
0005f8   f004                                                                                                               
0005fa   0012     RETURN    0x0            }//end main                                                                      C:\fw\pedalbtldr\x201\main.c
                                                                                                                            C:\fw\pedalbtldr\x201\main.c
                                           void BOOT_LOAD_MODE (void) {                                                     C:\fw\pedalbtldr\x201\main.c
                                               //Bootload Mode                                                              C:\fw\pedalbtldr\x201\main.c
                                               //mInitAllLEDs();                                                            C:\fw\pedalbtldr\x201\main.c
0005fc   0e14     MOVLW     0x14               mInitializeUSBDriver();     // See usbdrv.h                                  C:\fw\pedalbtldr\x201\main.c
0005fe   6e6f     MOVWF     0x6f,0x0                                                                                        
000600   ec0f     CALL      0x1e,0x0           USBCheckBusStatus();        // Modified to always enable USB module          C:\fw\pedalbtldr\x201\main.c
000602   f000                                                                                                               
000612   d7f8     BRA       0x604              while(1){                                                                    C:\fw\pedalbtldr\x201\main.c
000604   0004     CLRWDT                   		_asm clrwdt _endasm                                                            C:\fw\pedalbtldr\x201\main.c
                                                                                                                            C:\fw\pedalbtldr\x201\main.c
000606   9a93     BCF       0x93,0x5,0x0   	    TRISBbits.TRISB5 = 0;     //make that pin an output                         C:\fw\pedalbtldr\x201\main.c
000608   7a8a     BTG       0x8a,0x5,0x0   		LATBbits.LATB5 = !LATBbits.LATB5;                                              C:\fw\pedalbtldr\x201\main.c
                                                                                                                            C:\fw\pedalbtldr\x201\main.c
00060a   ec1a     CALL      0x34,0x0               USBDriverService();     // See usbdrv.c                                  C:\fw\pedalbtldr\x201\main.c
00060c   f000                                                                                                               
00060e   ec49     CALL      0x492,0x0              BootService();          // See boot.c                                    C:\fw\pedalbtldr\x201\main.c
000610   f002                                                                                                               
                                              	}//end while                                                                 C:\fw\pedalbtldr\x201\main.c
000614   0012     RETURN    0x0            }//end function                                                                  C:\fw\pedalbtldr\x201\main.c
                                                                                                                            C:\fw\pedalbtldr\x201\main.c
                                           #pragma code user = RM_RESET_VECTOR                                              C:\fw\pedalbtldr\x201\main.c
                                           /** EOF main.c ***************************************************************/  C:\fw\pedalbtldr\x201\main.c
                                           ; *****************************************************************************  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;        Software License Agreement				                                          C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;		 			 			                                                                      C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; The software supplied herewith by Microchip Technology 	                       C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; Incorporated (the “Company”) for its PICmicro® Microcontroller is              C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; intended and supplied to you, the Company’s customer, for use                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; solely and exclusively on Microchip PICmicro Microcontroller	                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; products. The software is owned by the Company and/or its                      C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; supplier, and is protected under applicable copyright laws. All                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; rights are reserved. Any use in violation of the foregoing 	                   C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; restrictions may subject the user to criminal sanctions under	                 C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; applicable laws, as well as to civil liability for the breach of               C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; the terms and conditions of this license.			                                   C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;								                                                                        C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; THIS SOFTWARE IS PROVIDED IN AN “AS IS” CONDITION. NO WARRANTIES,              C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; WHETHER EXPRESS, IMPLIED OR STATUTORY, INCLUDING, BUT NOT LIMITED              C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; TO, IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A 	                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; PARTICULAR PURPOSE APPLY TO THIS SOFTWARE. THE COMPANY SHALL NOT,              C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; IN ANY CIRCUMSTANCES, BE LIABLE FOR SPECIAL, INCIDENTAL OR 	                   C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; CONSEQUENTIAL DAMAGES, FOR ANY REASON WHATSOEVER.		                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;		 						                                                                       C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;					 			                                                                       C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; Bootloader for PIC18F by Ross Fosler                                           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; 03/01/2002	... First full implementation                                       C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; 03/07/2002	Changed entry method to use last byte of EEDATA.                    C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;				Also removed all possible infinite loops w/ clrwdt.                         C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; 03/07/2002	Added code for direct boot entry. I.E. boot vector.                 C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; 03/09/2002	Changed the general packet format, removed the LEN field.           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; 03/09/2002	Modified the erase command to do multiple row erase.                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; 03/12/2002	Fixed write problem to CONFIG area. Write was offset by a byte.     C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; 03/20/2002	Modified receive & parse engine to vector to autobaud on a checksum  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;				error since a chechsum error could likely be a communications problem.      C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; 03/22/2002 	Removed clrwdt from the startup. This instruction affects the TO and  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;				PD flags. Removing this instruction should have no affect on code           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;				operation since the wdt is cleared on a reset and boot entry is always      C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;				on a reset.                                                                 C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; 03/22/2002	Modified the protocol to incorporate the autobaud as part of the    C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;				first received <STX>. Doing this improves robustness by allowing            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;				re-sync under any condition. Previously it was possible to enter a          C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;				state where only a hard reset would allow re-syncing.                       C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; 03/27/2002	Removed the boot vector and related code. This could lead to customer C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;				issues. There is a very minute probability that errent code execution       C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;				could jump into the boot area and cause artificial boot entry.              C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; 08/29/2003	Modified code to be more easily compiled on other PIC18F devices.   C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; 01/07/2005	Modified code to calculate the checksum of the ROM and compare it to the checksum C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;				stored at the end of ROM as a criteron to stay in the program mode          C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;				This is in addition to the test of the                                      C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; 04/01/2005	Modified code so that it is relocatable                             C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;                                                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; Memory Map                                                                     C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	-----------------                                                              C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	|    0x0000		|	                                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	|    0x0002    	|	Boot vector                                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;  	|    0x0004		|	Unlock & write vector                                         C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	|    			|	                                                                     C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	|				|                                                                         C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	|  Boot Block 	|	(this program)                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; 	|				|                                                                        C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	|    0x0200		|	Re-mapped Reset Vector                                          C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	|    0x0208		|	Re-mapped High Priority Interrupt Vector                        C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	|    0x0218		|	Re-mapped Low Priority Interrupt Vector                         C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	|				|                                                                         C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	|		|		|                                                                        C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	|				|                                                                         C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;  	|  Code Space 	|	User program space                                          C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	|				|                                                                         C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	|		|		|                                                                        C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	|				|                                                                         C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	|   0xXXXXXX    |                                                              C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	-----------------                                                              C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;                                                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;                                                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; Incomming data format:                                                         C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;                                                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	<STX><STX><DATA><CHKSUM><ETX>                                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;		      /    \                                                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	 ________/      \____________________________                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	/	                                         \                                   C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	<COMMAND><DLEN><ADDRL><ADDRH><ADDRU><DATA>...                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;                                                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; Definitions:                                                                   C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;                                                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; 	STX	-	Start of packet indicator                                               C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	ETX	-	End of packet indicator                                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; 	LEN 	-	Length of incomming packet                                             C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; 	DATA	-	General data up to 255 bytes                                           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; 	CHKSUM 	- 	The 8-bit two's compliment sum of LEN & DATA                       C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; 	COMMAND - 	Base command                                                       C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; 	DLEN	-	Length of data associated to the command                               C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; 	ADDR	-	Address up to 24 bits                                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; 	DATA 	-	Data (if any)                                                         C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;                                                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;                                                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; Commands:                                                                      C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;                                                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; 	RD_VER		0x00	Read Version Information                                         C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; 	RD_MEM		0x01	Read Program Memory                                              C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; 	WR_MEM		0x02	Write Program Memory                                             C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; 	ER_MEM		0x03	Erase Program Memory                                             C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; 	RD_EE		0x04	Read EEDATA Memory                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; 	WR_EE		0x05	Write EEDATA Memory                                               C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; 	RD_CONFIG	0x06	Read Config Memory                                             C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; 	WT_CONFIG	0x07	Write Config Memory                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;                                                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; *****************************************************************************  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; *****************************************************************************  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; *****************************************************************************  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; Specify the device.                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	INCLUDE "_CNSTDEF.INC"                                                          C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; *****************************************************************************  C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           ; Specify the device.                                                            C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           ;     #include P18F8720.INC                                                      C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                                ifdef __18F442                                                              C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                                #include P18F442.INC                                                        C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                                endif                                                                       C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                                ifdef __18F4420                                                             C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                                #include P18F4420.INC                                                       C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                                endif                                                                       C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                                ifdef __18F4455                                                             C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                                #include P18F4455.INC                                                       C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                                   LIST                                                                     C:\fw\691213\asm\x201\RS232\P18F4455.INC
                                                                                                                            C:\fw\691213\asm\x201\RS232\P18F4455.INC
                                           ;==========================================================================      C:\fw\691213\asm\x201\RS232\P18F4455.INC
                                           ;  $Id: P18F4455.INC,v 1.6.4.1 2005/02/15 17:35:34 curtiss Exp $                 C:\fw\691213\asm\x201\RS232\P18F4455.INC
                                           ;  MPASM PIC18F4455 processor include                                            C:\fw\691213\asm\x201\RS232\P18F4455.INC
                                           ;                                                                                C:\fw\691213\asm\x201\RS232\P18F4455.INC
                                           ;  (c) Copyright 1999-2005 Microchip Technology, All rights reserved             C:\fw\691213\asm\x201\RS232\P18F4455.INC
                                           ;==========================================================================      C:\fw\691213\asm\x201\RS232\P18F4455.INC
                                                                                                                            C:\fw\691213\asm\x201\RS232\P18F4455.INC
                                                   LIST                                                                     C:\fw\691213\asm\x201\RS232\P18F4455.INC
                                                endif                                                                       C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                                ifdef __18F4550                                                             C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                                #include P18F4550.INC                                                       C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                                endif                                                                       C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           ;------------------------------------------------------------------------------  C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           ;Conditional assembly definitions	Added 4/8/05 691218 x003e AR                   C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           ;Only define one of the three below                                              C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #define	LAB_TEST                                                                 C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           ;#define	PRE_PRODUCTION                                                          C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           ;#define	PRODUCTION                                                              C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           ;#define		PRODUCTION_NO_ENCRYPT                                                  C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                                                                                                            C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #ifdef		LAB_TEST                                                                 C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           	;#define	CHECKSUM_CHECK_EN                                                      C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           	;#define	ENCRYPTION_ENABLED                                                     C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           	;#define	READ_PROTECT                                                           C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #endif                                                                           C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #ifdef		PRE_PRODUCTION                                                           C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           	#define		CHECKSUM_CHECK_EN                                                      C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           	#define		ENCRYPTION_ENABLED                                                     C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           	;#define	READ_PROTECT                                                           C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #endif                                                                           C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #ifdef		PRODUCTION_NO_ENCRYPT                                                    C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           	#define		CHECKSUM_CHECK_EN                                                      C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           	;#define	ENCRYPTION_ENABLED                                                     C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           	#define		READ_PROTECT                                                           C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #endif                                                                           C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #ifdef		PRODUCTION                                                               C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           	#define		CHECKSUM_CHECK_EN                                                      C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           	#define		ENCRYPTION_ENABLED                                                     C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           	#define		READ_PROTECT                                                           C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #endif                                                                           C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                                                                                                            C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #define	ENCRYPTION_MASK		0x19                                                    C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                                                                                                            C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                                                                                                            C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           ;#define	STAND_ALONE                                                             C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                                                                                                            C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           ;#define	_8MHZ_CLOCK                                                             C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #define		_32MHZ_CLOCK		;Uses the chip's PLL                                      C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                                                                                                            C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           ;#define	AUTOBAUD_DETECT                                                         C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           ;#define	BAUD_19200                                                              C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #define		BAUD_9600                                                               C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                                                                                                            C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #ifdef	_8MHZ_CLOCK                                                               C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           	#ifdef	BAUD_19200                                                               C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #define INIT_SPBRG	.25		;19200 Baud for 8MHz                                     C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           	#endif                                                                          C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           	#ifdef	BAUD_9600                                                                C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #define INIT_SPBRG	.51		;9600 Baud for 8MHz                                      C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           	#endif                                                                          C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #endif                                                                           C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #ifdef	_32MHZ_CLOCK                                                              C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           	#ifdef	BAUD_19200                                                               C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #define INIT_SPBRG	.103		;19200 Baud for 32MHz                                   C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           	#endif                                                                          C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           	#ifdef	BAUD_9600                                                                C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #define INIT_SPBRG	.207		;9600 Baud for 32MHz                                    C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           	#endif                                                                          C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #endif                                                                           C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           ;------------------------------------------------------------------------------  C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #ifdef	STAND_ALONE                                                               C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           	#ifdef __18F442                                                                 C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           		#ifdef	_8MHZ_CLOCK                                                             C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           		__CONFIG _CONFIG1H, _HS_OSC_1H                                                 C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           		#endif                                                                         C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           		#ifdef	_32MHZ_CLOCK                                                            C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           		__CONFIG _CONFIG1H, _HSPLL_OSC_1H                                              C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           		#endif                                                                         C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           		__CONFIG _CONFIG2L, _PWRT_ON_2L & _BOR_ON_2L & _BORV_27_2L                     C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           		__CONFIG _CONFIG2H, _WDT_ON_2H & _WDTPS_32_2H                                  C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           		__CONFIG _CONFIG3H, _CCP2MX_ON_3H                                              C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           		__CONFIG _CONFIG4L, _STVR_ON_4L & _LVP_OFF_4L & _DEBUG_OFF_4L                  C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           		__CONFIG _CONFIG5L, _CP0_ON_5L & _CP1_ON_5L & _CP2_ON_5L & _CP3_ON_5L          C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           		__CONFIG _CONFIG5H, _CPB_ON_5H & _CPD_OFF_5H                                   C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           		__CONFIG _CONFIG6L, _WRT0_ON_6L & _WRT1_ON_6L & _WRT2_ON_6L & _WRT3_ON_6L      C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           		__CONFIG _CONFIG6H, _WRTC_ON_6H & _WRTB_ON_6H & _WRTD_OFF_6H                   C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           		__CONFIG _CONFIG7L, _EBTR0_OFF_7L & _EBTR1_OFF_7L                              C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           	#endif                                                                          C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           	                                                                                C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           	#ifdef __18F4420                                                                C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           		#ifdef	_8MHZ_CLOCK                                                             C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           		__CONFIG _CONFIG1H, _OSC_HS_1H & _FCMEN_OFF_1H & _IESO_OFF_1H                  C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           		#endif                                                                         C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           		#ifdef	_32MHZ_CLOCK                                                            C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           		__CONFIG _CONFIG1H, _OSC_HSPLL_1H & _FCMEN_OFF_1H & _IESO_OFF_1H               C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           		#endif                                                                         C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           		__CONFIG _CONFIG2L, _PWRT_ON_2L & _BOREN_ON_2L & _BORV_27_2L                   C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           		__CONFIG _CONFIG2H, _WDT_ON_2H & _WDTPS_128_2H                                 C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           		__CONFIG _CONFIG3H, _MCLRE_ON_3H & _PBADEN_OFF_3H & _CCP2MX_PORTC_3H           C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           		__CONFIG _CONFIG4L, _STVREN_ON_4L & _LVP_OFF_4L & _ENHCPU_OFF_4L & _DEBUG_OFF_4L C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           		__CONFIG _CONFIG5L, _CP0_ON_5L & _CP1_ON_5L                                    C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           		__CONFIG _CONFIG5H, _CPB_ON_5H & _CPD_OFF_5H                                   C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           		__CONFIG _CONFIG6L, _WRT0_OFF_6L & _WRT1_OFF_6L                                C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           		__CONFIG _CONFIG6H, _WRTC_ON_6H & _WRTB_ON_6H & _WRTD_OFF_6H                   C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           		__CONFIG _CONFIG7L, _EBTR0_OFF_7L & _EBTR1_OFF_7L                              C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           		__CONFIG _CONFIG7H, _EBTRB_OFF_7H                                              C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           	#endif                                                                          C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           	#ifdef __18F4550                                                                C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           		__CONFIG _CONFIG1L, _PLLDIV_2_1L & _CPUDIV_OSC2_PLL3_1L & _USBDIV_2_1L         C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           		__CONFIG _CONFIG1H, _FOSC_HSPLL_HS_1H & _FCMEM_OFF_1H & _IESO_OFF_1H           C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           		__CONFIG _CONFIG2L, _PWRT_ON_2L & _BOR_ON_2L & _BORV_28_2L & _VREGEN_ON_2L     C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           		__CONFIG _CONFIG2H, _WDT_ON_2H & _WDTPS_128_2H                                 C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           		__CONFIG _CONFIG3H, _MCLRE_ON_3H & _LPT1OSC_OFF_3H & _PBADEN_OFF_3H & _CCP2MX_ON_3H C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           		__CONFIG _CONFIG4L, _STVREN_ON_4L & _LVP_OFF_4L & _ICPRT_OFF_4L & _XINST_OFF_4L & _DEBUG_OFF_4L C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           		__CONFIG _CONFIG5L, _CP0_ON_5L & _CP1_ON_5L & _CP2_ON_5L & _CP3_ON_5L          C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           		__CONFIG _CONFIG5H, _CPB_ON_5H & _CPD_OFF_5H                                   C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           		__CONFIG _CONFIG6L, _WRT0_ON_6L & _WRT1_ON_6L & _WRT2_ON_6L & _WRT3_ON_6L      C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           		__CONFIG _CONFIG6H, _WRTC_ON_6H & _WRTB_ON_6H & _WRTD_OFF_6H                   C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           		__CONFIG _CONFIG7L, _EBTR0_OFF_7L & _EBTR1_OFF_7L & _EBTR2_OFF_7L & _EBTR3_OFF_7L C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           		__CONFIG _CONFIG7H, _EBTRB_OFF_7H                                              C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           	#endif                                                                          C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #endif                                                                           C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                                                                                                            C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #define POWER_ON_AND_WDT_RESET_VECTOR		0x00                                      C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #define HIGH_PRIORITY_INTERRUPT_VECTOR		0x08                                     C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #define LOW_PRIORITY_INTERRUPT_VECTOR		0x18                                      C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                                                                                                            C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #ifdef __18F442                                                                  C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #define REMAPPED_RESET_VECTOR			0x200                                            C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #define REMAPPED_HIGH_INTRPT_VECTOR		0x208                                       C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #define REMAPPED_LOW_INTRPT_VECTOR		0x218                                        C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #define CODE_START_ADDRESS			0x200                                               C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #define END_OF_ROM				(0x3FFF-8)                                                 C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #endif                                                                           C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                                                                                                            C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #ifdef __18F4455                                                                 C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #define REMAPPED_RESET_VECTOR			0xA00                                            C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #define REMAPPED_HIGH_INTRPT_VECTOR		0xA08                                       C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #define REMAPPED_LOW_INTRPT_VECTOR		0xA18                                        C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #define CODE_START_ADDRESS			0xA00                                               C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #define END_OF_ROM				(0x5FFF-0x20)                                              C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #endif                                                                           C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                                                                                                            C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #ifdef __18F4550                                                                 C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #define REMAPPED_RESET_VECTOR			0xA00                                            C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #define REMAPPED_HIGH_INTRPT_VECTOR		0xA08                                       C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #define REMAPPED_LOW_INTRPT_VECTOR		0xA18                                        C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #define CODE_START_ADDRESS			0xA00                                               C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #define END_OF_ROM				(0x7FFF-0x20)                                              C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           #endif                                                                           C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           ; *****************************************************************************  C:\fw\691213\asm\x201\RS232\_CNSTDEF.INC
                                           ; *****************************************************************************  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; *****************************************************************************  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; *****************************************************************************  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; Modify these symbols to match the device this code is to be compiled for.      C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #define	_RCSTA		RCSTA		; Receive control                                         C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #define	_TXSTA		TXSTA		; Transmit control                                        C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #define	_RCREG		RCREG		; Receive register                                        C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #define	_TXREG		TXREG		; Transmit register                                       C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #define	_SPBRG		SPBRG		; Baudrate control                                        C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #define	_RC_DIR_BIT	TRISC,7		; Receive direction bit                             C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #define	_TX_DIR_BIT	TRISC,6		; Transmit direction bit                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #define	_RC_BIT		PORTC,7		; Receive bit                                          C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #define	_TX_BIT		PORTC,6		; Transmit bit                                         C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; *****************************************************************************  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; *****************************************************************************  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #define	MINOR_VERSION	0x0B	; Version                                             C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #define	MAJOR_VERSION	0x00                                                       C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #define	STX		0x0F	; Start of data stream                                         C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #define	ETX		0x04	; End of data stream                                           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #define	DLE		0x05	; Data link escape                                             C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; *****************************************************************************  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; *****************************************************************************  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           BOOTRAM			udata_ovr                                                              C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           CHKSUM			res	1		; Checksum accumulator                                           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           COUNTER			res	1		; General counter                                               C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ABTIME_H		res	1                                                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ABTIME_L		res	1                                                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           RXDATA			res	1                                                                   C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           TXDATA			res	1                                                                   C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; Frame Format                                                                   C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;                                                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;  <STX><STX>[<COMMAND><DATALEN><ADDRL><ADDRH><ADDRU><...DATA...>]<CHKSUM><ETX>  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           DATA_BUFF		res	1		; Start of receive buffer                                      C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	                                                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;COMMAND		equ	0x08		; Data mapped in receive buffer                              C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           DATA_COUNT		res	1	                                                               C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ADDRESS_L		res	1                                                                 C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ADDRESS_H		res	1                                                                 C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ADDRESS_U		res	1                                                                 C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           PACKET_DATA		res	1                                                               C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ProgMemoryChecksum_L	res	1                                                       C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ProgMemoryChecksum_H	res	1                                                       C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #define COMMAND	DATA_BUFF			; Data mapped in receive buffer                      C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; *****************************************************************************  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; *****************************************************************************  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           pmwtpi macro				                                                                 C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	tblwt	*+                                                                        C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	endm                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; *****************************************************************************  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; *****************************************************************************  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #ifdef	ASM_VERSION                                                               C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           RESET_V			CODE	POWER_ON_AND_WDT_RESET_VECTOR	;Reset vector                       C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	banksel	CHKSUM                                                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	bra	Setup	                                                                      C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	bra	StartWrite                                                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           HIGH_INTERRUPT_V	CODE	HIGH_PRIORITY_INTERRUPT_VECTOR                             C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	bra	_highinterrupt	;Re-mapped high priority Interrupt vector                    C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           LOW_INTERRUPT_V		CODE	LOW_PRIORITY_INTERRUPT_VECTOR                              C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	bra	_lowinterrupt	;Re-mapped low priority Interrupt vector                      C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #endif                                                                           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; *****************************************************************************  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           RS232BOOT	CODE                                                                   C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; *****************************************************************************  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; Setup the appropriate registers.                                               C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           Setup                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000800   0004     CLRWDT                   	clrwdt                                                                          C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #ifdef	ASM_VERSION                                                               C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	clrf	EECON1                                                                     C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	setf	EEADR				; Point to last location                                          C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #IFDEF	EEADRH                                                                    C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	clrf	EEADRH			                                                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #ENDIF                                                                           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	bsf	EECON1, RD			; Read the control code                                        C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	incfsz	EEDATA, W                                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	bra	VERIFY_PROGRAM_MEMORY		; If not 0xFF then normal reset                      C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           BOOT_LOAD_MODE                                                                   C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	bcf	_TX_DIR_BIT			; Setup tx pin                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	bsf	_RC_DIR_BIT			; Setup rx pin                                               C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	movlw	b'10010000'			; Setup rx and tx                                           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	movwf	_RCSTA                                                                    C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	movlw	b'00100110'                                                               C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	movwf	_TXSTA                                                                    C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #endif                                                                           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; *****************************************************************************  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; *****************************************************************************  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           Autobaud                                                                         C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #IFDEF	AUTOBAUD_DETECT                                                           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;                                                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; ___	 __________            ________                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;    \__/          \__________/                                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;       |                     |                                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;       |-------- p ----------|                                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;                                                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	p = The number of instructions between the first and last                      C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;       rising edge of the RS232 control sequence 0x0F. Other                    C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	    possible control sequences are 0x01, 0x03, 0x07, 0x1F,                     C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; 	    0x3F, 0x7F.                                                               C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;                                                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	SPBRG = (p / 32) - 1  	BRGH = 1                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	bcf	_RCSTA, CREN		; Stop receiving                                              C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	movlw	b'00000011'			; x16 Prescale                                              C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	movwf	T0CON                                                                     C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	clrf	TMR0H				; Reset timer                                                     C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	clrf	TMR0L                                                                      C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	                                                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	rcall	WaitForRise                                                               C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	bsf	T0CON, TMR0ON		; Start counting                                             C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	rcall	WaitForRise                                                               C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	bcf	T0CON, TMR0ON		; Stop counting                                              C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	movff	TMR0L, ABTIME_L		; Read the timer                                         C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	                                                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           DivB32	                                                                          C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	rrcf	TMR0H, F			; divide by 2                                                   C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	rrcf	ABTIME_L, F                                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	btfss	STATUS, C			; Rounding                                                    C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	decf	ABTIME_L, F                                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	movff	ABTIME_L, _SPBRG	; Sync                                                   C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #ELSE                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000802   0ecf     MOVLW     0xcf           	movlw	INIT_SPBRG                                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000804   6eaf     MOVWF     0xaf,0x0       	movwf	_SPBRG                                                                    C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #ENDIF                                                                           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000806   88ab     BSF       0xab,0x4,0x0   	bsf	_RCSTA, CREN		; Start receiving                                             C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000808   50ae     MOVF      0xae,0x0,0x0   	movf	_RCREG, W			; Empty the buffer                                             C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00080a   50ae     MOVF      0xae,0x0,0x0   	movf	_RCREG, W                                                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; *****************************************************************************  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; *****************************************************************************  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; Read and parse the data.                                                       C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           StartOfLine                                                                      C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00080c   d8a0     RCALL     0x94e          	rcall	RdRS232				; Get second <STX>                                             C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00080e   0a0f     XORLW     0xf            	xorlw	STX                                                                       C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000810   e1f8     BNZ       0x802          	bnz	Autobaud			; Otherwise go back for another character                        C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000812   ee00     LFSR      0x0,0x66       	lfsr	0, DATA_BUFF		; Point to the buffer                                        C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000814   f066                                                                                                               
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000816   6b60     CLRF      0x60,0x1       	clrf	CHKSUM				; Reset checksum		                                               C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000818   6b61     CLRF      0x61,0x1       	clrf	COUNTER				; Reset buffer count                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           		                                                                               C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           GetNextDat				                                                                   C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00081a   d899     RCALL     0x94e          	rcall	RdRS232				; Get the data                                                 C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00081c   0a0f     XORLW     0xf            	xorlw	STX					; Check for a STX                                                 C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00081e   e0f6     BZ        0x80c          	bz	StartOfLine			; Yes, start over	                                             C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           NoSTX	                                                                           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000820   5164     MOVF      0x64,0x0,0x1   	movf	RXDATA, W                                                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000822   0a04     XORLW     0x4            	xorlw	ETX					; Check for a ETX                                                 C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000824   e00a     BZ        0x83a          	bz	CheckSum			; Yes, examine checksum		                                         C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           NoETX                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000826   5164     MOVF      0x64,0x0,0x1   	movf	RXDATA, W                                                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000828   0a05     XORLW     0x5            	xorlw	DLE					; Check for a DLE                                                 C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00082a   e101     BNZ       0x82e          	bnz	NoDLE                                                                       C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00082c   d890     RCALL     0x94e          	rcall	RdRS232				; Yes, Get the next byte                                       C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	                                                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           NoDLE	                                                                           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00082e   5164     MOVF      0x64,0x0,0x1   	movf	RXDATA, W                                                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000830   2760     ADDWF     0x60,0x1,0x1   	addwf	CHKSUM, F			; Get sum                                                     C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000832   6eee     MOVWF     0xee,0x0       	movwf	POSTINC0			; Store the data                                               C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000834   4f61     DCFSNZ    0x61,0x1,0x1   	dcfsnz	COUNTER, F			; Limit buffer to 256 bytes                                 C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000836   d7e5     BRA       0x802          	bra	Autobaud                                                                    C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000838   d7f0     BRA       0x81a          	bra	GetNextDat                                                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           CheckSum	                                                                        C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00083a   5360     MOVF      0x60,0x1,0x1   	movf	CHKSUM				; Checksum test                                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00083c   e1e2     BNZ       0x802          	bnz	Autobaud                                                                    C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; ***********************************************                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; ***********************************************                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; Pre-setup, common to all commands.                                             C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00083e   5168     MOVF      0x68,0x0,0x1   	movf	ADDRESS_L, W		; Set all possible pointers                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000840   6ef6     MOVWF     0xf6,0x0       	movwf	TBLPTRL                                                                   C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000842   6ea9     MOVWF     0xa9,0x0       	movwf	EEADR                                                                     C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000844   5169     MOVF      0x69,0x0,0x1   	movf	ADDRESS_H, W                                                               C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000846   6ef7     MOVWF     0xf7,0x0       	movwf	TBLPTRH                                                                   C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #IFDEF	EEADRH                                                                    C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	movwf	EEADRH                                                                    C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #ENDIF                                                                           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000848   c06a     MOVFF     0x6a,0xff8     	movff	ADDRESS_U, TBLPTRU                                                        C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00084a   fff8                                                                                                               
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00084c   ee00     LFSR      0x0,0x6b       	lfsr	FSR0, PACKET_DATA                                                          C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00084e   f06b                                                                                                               
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000850   5167     MOVF      0x67,0x0,0x1   	movf	DATA_COUNT, W 		; Setup counter                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000852   6f61     MOVWF     0x61,0x1       	movwf	COUNTER                                                                   C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000854   b4d8     BTFSC     0xd8,0x2,0x0   	btfsc	STATUS, Z                                                                 C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000856   00ff     RESET                    	reset						; Non valid count (Special Command)                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; ***********************************************                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; ***********************************************                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; Test the command field and sub-command.                                        C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           CheckCommand                                                                     C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000858   5166     MOVF      0x66,0x0,0x1   	movf	COMMAND, W			; Test for a valid command			                                 C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00085a   0807     SUBLW     0x7            	sublw	d'7'                                                                      C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00085c   e3d2     BNC       0x802          	bnc	Autobaud                                                                    C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00085e   6afa     CLRF      0xfa,0x0       	clrf	PCLATH				; Setup for a calculated jump                                    C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000860   6afb     CLRF      0xfb,0x0       	clrf	PCLATU                                                                     C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           		                                                                               C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000862   4566     RLNCF     0x66,0x0,0x1   	rlncf	COMMAND, W			; Jump                                                       C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000864   26f9     ADDWF     0xf9,0x1,0x0   	addwf	PCL, F                                                                    C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	                                                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000866   d007     BRA       0x876          	bra	ReadVersion                                                                 C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000868   d00c     BRA       0x882          	bra	ReadProgMem                                                                 C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00086a   d013     BRA       0x892          	bra	WriteProgMem                                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00086c   d022     BRA       0x8b2          	bra	EraseProgMem                                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00086e   d02c     BRA       0x8c8          	bra	ReadEE                                                                      C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000870   d035     BRA       0x8dc          	bra	WriteEE                                                                     C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000872   d007     BRA       0x882          	bra	ReadProgMem			;ReadConfig                                                   C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000874   d03e     BRA       0x8f2          	bra	WriteConfig                                                                 C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; ***********************************************                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; ***********************************************                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; Commands                                                                       C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;                                                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; In:	<STX><STX>[<0x00><0x02>]<0xFF><ETX>                                        C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; OUT:	<STX><STX>[<0x00><0x02><VERL><VERH>]<CHKSUM><ETX>                         C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ReadVersion                                                                      C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000876   0e0b     MOVLW     0xb            	movlw	MINOR_VERSION                                                             C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000878   6f68     MOVWF     0x68,0x1       	movwf	DATA_BUFF + 2                                                             C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00087a   0e00     MOVLW     0x0            	movlw	MAJOR_VERSION                                                             C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00087c   6f69     MOVWF     0x69,0x1       	movwf	DATA_BUFF + 3                                                             C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00087e   0e04     MOVLW     0x4            	movlw	0x04                                                                      C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000880   d043     BRA       0x908          	bra	WritePacket                                                                 C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; In:	<STX><STX>[<0x01><DLEN><ADDRL><ADDRH><ADDRU>]<CHKSUM><ETX>                 C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; OUT:	<STX><STX>[<0x01><DLEN><ADDRL><ADDRH><ADDRU><DATA>...]<CHKSUM><ETX>       C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ReadProgMem                                                                      C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #IFDEF	READ_PROTECT                                                              C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	movlw	Upper END_OF_ROM                                                          C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	movwf	TBLPTRU                                                                   C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	movlw	High END_OF_ROM                                                           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	movwf	TBLPTRH                                                                   C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	movlw	Low END_OF_ROM                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	movwf	TBLPTRL                                                                   C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #ENDIF                                                                           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ReadProgMem_10                                                                   C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000882   0009     TBLRDPOSTINC             	tblrd	*+			; Fill buffer                                                        C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;Diag AR 3/1/05                                                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #IFNDEF	ENCRYPTION_ENABLED                                                       C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000884   cff5     MOVFF     0xff5,0xfee    	movff	TABLAT, POSTINC0                                                          C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000886   ffee                                                                                                               
                                           #ELSE                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	movf	TABLAT, W                                                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	xorlw	ENCRYPTION_MASK                                                           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	movwf	POSTINC0                                                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #ENDIF                                                                           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;End Diag                                                                        C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000888   2f61     DECFSZ    0x61,0x1,0x1   	decfsz	COUNTER, F		                                                             C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00088a   d7fb     BRA       0x882          	bra	ReadProgMem_10		; Not finished then repeat                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00088c   5167     MOVF      0x67,0x0,0x1   	movf	DATA_COUNT, W		; Setup packet length                                       C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00088e   0f05     ADDLW     0x5            	addlw	0x05                                                                      C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           				                                                                             C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000890   d03b     BRA       0x908          	bra	WritePacket                                                                 C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; In:	<STX><STX>[<0x02><DLENBLOCK><ADDRL><ADDRH><ADDRU><DATA>...]<CHKSUM><ETX>   C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; OUT:	<STX><STX>[<0x02>]<CHKSUM><ETX>                                           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           WriteProgMem                                                                     C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000892   0ef8     MOVLW     0xf8           	movlw	b'11111000'			; Force a boundry                                           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000894   16f6     ANDWF     0xf6,0x1,0x0   	andwf	TBLPTRL, F                                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000896   0e08     MOVLW     0x8            	movlw	0x08                                                                      C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;Diag AR 3/1/05                                                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           Lp1                                                                              C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #IFNDEF	ENCRYPTION_ENABLED                                                       C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000898   cfee     MOVFF     0xfee,0xff5    	movff	POSTINC0, TABLAT	; Load the holding registers                             C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00089a   fff5                                                                                                               
                                           #ELSE                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	movf	POSTINC0, W                                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	xorlw	ENCRYPTION_MASK                                                           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	movwf	TABLAT                                                                    C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #ENDIF                                                                           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;End Diag                                                                        C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00089c   000d     TBLWTPOSTINC             	tblwt	*+	;pmwtpi						; Same as tblwt *+                                        C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00089e   2ee8     DECFSZ    0xe8,0x1,0x0   	decfsz	WREG, F                                                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008a0   d7fb     BRA       0x898          	bra	Lp1                                                                         C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008a2   000a     TBLRDPOSTDEC             	tblrd	*-					; Point back into the block                                        C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008a4   0e84     MOVLW     0x84           	movlw	b'10000100'			; Setup writes                                              C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008a6   6ea6     MOVWF     0xa6,0x0       	movwf	EECON1                                                                    C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008a8   d85a     RCALL     0x95e          	rcall	StartWrite			; Write the data                                             C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008aa   0009     TBLRDPOSTINC             	tblrd	*+					; Point to the beginning of the next block                         C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008ac   2f61     DECFSZ    0x61,0x1,0x1   	decfsz	COUNTER, F		                                                             C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008ae   d7f1     BRA       0x892          	bra	WriteProgMem		; Not finished then repeat                                    C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008b0   d02a     BRA       0x906          	bra	SendAcknowledge		; Send acknowledge                                         C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; In:	<STX><STX>[<0x03><DLENROW><ADDRL><ADDRH><ADDRL>]<CHKSUM><ETX>              C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; OUT:	<STX><STX>[<0x03>]<CHKSUM><ETX>                                           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           EraseProgMem                                                                     C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008b2   0e94     MOVLW     0x94           	movlw	b'10010100'			; Setup writes                                              C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008b4   6ea6     MOVWF     0xa6,0x0       	movwf	EECON1                                                                    C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008b6   d853     RCALL     0x95e          	rcall	StartWrite			; Erase the row                                              C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008b8   0e40     MOVLW     0x40           	movlw	0x40				; Point to next row                                               C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008ba   26f6     ADDWF     0xf6,0x1,0x0   	addwf	TBLPTRL, F                                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008bc   6ae8     CLRF      0xe8,0x0       	clrf	WREG                                                                       C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008be   22f7     ADDWFC    0xf7,0x1,0x0   	addwfc	TBLPTRH, F                                                               C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008c0   22f8     ADDWFC    0xf8,0x1,0x0   	addwfc	TBLPTRU, F                                                               C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008c2   2f61     DECFSZ    0x61,0x1,0x1   	decfsz	COUNTER, F                                                               C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008c4   d7f6     BRA       0x8b2          	bra	EraseProgMem	                                                               C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008c6   d01f     BRA       0x906          	bra	SendAcknowledge		; Send acknowledge                                         C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; In:	<STX><STX>[<0x04><DLEN><ADDRL><ADDRH><0x00>]<CHKSUM><ETX>                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; OUT:	<STX><STX>[<0x04><DLEN><ADDRL><ADDRH><0x00><DATA>...]<CHKSUM><ETX>        C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ReadEE                                                                           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008c8   6aa6     CLRF      0xa6,0x0       	clrf	EECON1                                                                     C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008ca   80a6     BSF       0xa6,0x0,0x0   	bsf	EECON1, RD			; Read the data                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008cc   cfa8     MOVFF     0xfa8,0xfee    	movff	EEDATA, POSTINC0                                                          C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008ce   ffee                                                                                                               
                                           	                                                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #IFDEF	EEADRH                                                                    C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	infsnz	EEADR, F			; Adjust EEDATA pointer                                       C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	incf	EEADRH, F                                                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #ELSE                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008d0   2aa9     INCF      0xa9,0x1,0x0   	incf	EEADR, F                                                                   C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #ENDIF                                                                           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008d2   2f61     DECFSZ    0x61,0x1,0x1   	decfsz	COUNTER, F                                                               C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008d4   d7f9     BRA       0x8c8          	bra	ReadEE				; Not finished then repeat                                        C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008d6   5167     MOVF      0x67,0x0,0x1   	movf	DATA_COUNT, W		; Setup packet length                                       C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008d8   0f05     ADDLW     0x5            	addlw	0x05                                                                      C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           				                                                                             C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008da   d016     BRA       0x908          	bra	WritePacket                                                                 C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; In:	<STX><STX>[<0x05><DLEN><ADDRL><ADDRH><0x00><DATA>...]<CHKSUM><ETX>         C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; OUT:	<STX><STX>[<0x05>]<CHKSUM><ETX>                                           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           WriteEE	                                                                         C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008dc   cfee     MOVFF     0xfee,0xfa8    	movff	POSTINC0, EEDATA                                                          C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008de   ffa8                                                                                                               
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008e0   0e04     MOVLW     0x4            	movlw	b'00000100'			; Setup for EEData                                          C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008e2   6ea6     MOVWF     0xa6,0x0       	movwf	EECON1                                                                    C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008e4   d83c     RCALL     0x95e          	rcall	StartWrite		                                                              C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008e6   b2a6     BTFSC     0xa6,0x1,0x0   	btfsc	EECON1, WR			; Write and wait                                             C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008e8   d7fe     BRA       0x8e6          	bra	$ - 2                                                                       C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #IFDEF	EEADRH                                                                    C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	infsnz	EEADR, F			; Adjust EEDATA pointer                                       C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	incf	EEADRH, F                                                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #ELSE                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008ea   2aa9     INCF      0xa9,0x1,0x0   	incf	EEADR, F                                                                   C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #ENDIF                                                                           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008ec   2f61     DECFSZ    0x61,0x1,0x1   	decfsz	COUNTER, F		                                                             C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008ee   d7f6     BRA       0x8dc          	bra	WriteEE				; Not finished then repeat                                       C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008f0   d00a     BRA       0x906          	bra	SendAcknowledge		; Send acknowledge                                         C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; In:	<STX><STX>[<0x06><DLEN><ADDRL><ADDRH><ADDRU>]<CHKSUM><ETX>                 C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; OUT:	<STX><STX>[<0x06><DLEN><ADDRL><ADDRH><ADDRU><DATA>...]<CHKSUM><ETX>       C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;ReadConfig                                                                      C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; In:	<STX><STX>[<0x07><DLEN><ADDRL><ADDRH><ADDRU><DATA>...]<CHKSUM><ETX>        C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; OUT:	<STX><STX>[<0x07>]<CHKSUM><ETX>                                           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           WriteConfig                                                                      C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008f2   0ec4     MOVLW     0xc4           	movlw	b'11000100'                                                               C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008f4   6ea6     MOVWF     0xa6,0x0       	movwf	EECON1                                                                    C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008f6   cfee     MOVFF     0xfee,0xff5    	movff	POSTINC0, TABLAT	; Write to config area                                   C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008f8   fff5                                                                                                               
0008fa   000c     TBLWT                    	tblwt	*                                                                         C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008fc   d830     RCALL     0x95e          	rcall	StartWrite                                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
0008fe   0009     TBLRDPOSTINC             	tblrd	*+                                                                        C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000900   2f61     DECFSZ    0x61,0x1,0x1   	decfsz	COUNTER, F                                                               C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000902   d7f7     BRA       0x8f2          	bra	WriteConfig			; Not finished then repeat                                    C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           		                                                                               C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000904   d000     BRA       0x906          	bra	SendAcknowledge		; Send acknowledge                                         C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; ***********************************************                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; ***********************************************                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; Send the data buffer back.                                                     C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;                                                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; <STX><STX>[<DATA>...]<CHKSUM><ETX>                                             C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           SendAcknowledge                                                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000906   0e01     MOVLW     0x1            	movlw	0x01				; Send acknowledge                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           WritePacket                                                                      C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000908   6f61     MOVWF     0x61,0x1       	movwf	COUNTER                                                                   C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00090a   0e0f     MOVLW     0xf            	movlw	STX					; Send start condition                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00090c   d81b     RCALL     0x944          	rcall	WrRS232                                                                   C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00090e   d81a     RCALL     0x944          	rcall	WrRS232                                                                   C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000910   6b60     CLRF      0x60,0x1       	clrf	CHKSUM				; Reset checksum                                                 C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000912   ee00     LFSR      0x0,0x66       	lfsr	FSR0, DATA_BUFF		; Setup pointer to buffer area	                           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000914   f066                                                                                                               
                                           	                                                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           SendNext						; Send DATA                                                        C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000916   50ee     MOVF      0xee,0x0,0x0   	movf	POSTINC0, W                                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000918   2760     ADDWF     0x60,0x1,0x1   	addwf	CHKSUM                                                                    C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00091a   d808     RCALL     0x92c          	rcall	WrData                                                                    C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00091c   2f61     DECFSZ    0x61,0x1,0x1   	decfsz	COUNTER, F                                                               C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00091e   d7fb     BRA       0x916          	bra		SendNext                                                                   C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000920   6d60     NEGF      0x60,0x1       	negf	CHKSUM				; Send checksum                                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000922   5160     MOVF      0x60,0x0,0x1   	movf	CHKSUM, W                                                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000924   d803     RCALL     0x92c          	rcall	WrData                                                                    C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000926   0e04     MOVLW     0x4            	movlw	ETX					; Send stop condition                                             C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000928   d80d     RCALL     0x944          	rcall	WrRS232                                                                   C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00092a   d76b     BRA       0x802          	bra	Autobaud                                                                    C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; *****************************************************************************  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; *****************************************************************************  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; Write a byte to the serial port.                                               C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           WrData                                                                           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00092c   6f65     MOVWF     0x65,0x1       	movwf	TXDATA				; Save the data                                                 C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00092e   0a0f     XORLW     0xf            	xorlw	STX					; Check for a STX                                                 C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000930   e006     BZ        0x93e          	bz	WrDLE				; No, continue WrNext                                               C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000932   5165     MOVF      0x65,0x0,0x1   	movf	TXDATA, W		                                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000934   0a04     XORLW     0x4            	xorlw	ETX					; Check for a ETX                                                 C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000936   e003     BZ        0x93e          	bz	WrDLE				; No, continue WrNext                                               C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000938   5165     MOVF      0x65,0x0,0x1   	movf	TXDATA, W		                                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00093a   0a05     XORLW     0x5            	xorlw	DLE					; Check for a DLE                                                 C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00093c   e102     BNZ       0x942          	bnz	WrNext				; No, continue WrNext                                             C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           WrDLE                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00093e   0e05     MOVLW     0x5            	movlw	DLE					; Yes, send DLE first                                             C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000940   d801     RCALL     0x944          	rcall	WrRS232                                                                   C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           WrNext                                                                           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000942   5165     MOVF      0x65,0x0,0x1   	movf	TXDATA, W			; Then send STX                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           WrRS232                                                                          C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000944   0004     CLRWDT                   	clrwdt                                                                          C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000946   a89e     BTFSS     0x9e,0x4,0x0   	btfss	PIR1, TXIF			; Write only if TXREG is ready                               C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000948   d7fe     BRA       0x946          	bra		$ - 2                                                                      C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	                                                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00094a   6ead     MOVWF     0xad,0x0       	movwf	_TXREG				; Start sending                                                 C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00094c   0012     RETURN    0x0            	return                                                                          C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; *****************************************************************************  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; *****************************************************************************  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           RdRS232                                                                          C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00094e   0004     CLRWDT                   	clrwdt                                                                          C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000950   b2ab     BTFSC     0xab,0x1,0x0   	btfsc	_RCSTA, OERR		; Reset on overun                                           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000952   00ff     RESET                    	reset                                                                           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000954   aa9e     BTFSS     0x9e,0x5,0x0   	btfss	PIR1, RCIF			; Wait for data from RS232                                   C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000956   d7fe     BRA       0x954          	bra	$ - 2	                                                                      C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000958   50ae     MOVF      0xae,0x0,0x0   	movf	_RCREG, W			; Save the data                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00095a   6f64     MOVWF     0x64,0x1       	movwf	RXDATA                                                                    C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00095c   0012     RETURN    0x0            	return                                                                          C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; *****************************************************************************  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; *****************************************************************************  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; Unlock and start the write or erase sequence.                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           StartWrite                                                                       C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00095e   0004     CLRWDT                   	clrwdt                                                                          C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000960   0e55     MOVLW     0x55           	movlw	0x55				; Unlock                                                          C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000962   6ea7     MOVWF     0xa7,0x0       	movwf	EECON2                                                                    C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000964   0eaa     MOVLW     0xaa           	movlw	0xAA                                                                      C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000966   6ea7     MOVWF     0xa7,0x0       	movwf	EECON2                                                                    C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000968   82a6     BSF       0xa6,0x1,0x0   	bsf	EECON1, WR			; Start the write                                              C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00096a   0000     NOP                      	nop                                                                             C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00096c   0012     RETURN    0x0            	return                                                                          C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; *****************************************************************************  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;VERIFY_PROGRAM_MEMORY                                                           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;------------------------------------------------------------------------------  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	***	Verify Flash Checksum MACRO	***                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	Original Author:	Ali Rizavi, 01/06/05                                          C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	updated 01/06/05                                                               C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;------------------------------------------------------------------------------  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           VERIFY_PROGRAM_MEMORY			;MACRO                                                   C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;Load Table pointer with the start address of program code and clear the         C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;register for calculating checksum                                               C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #ifdef	CHECKSUM_CHECK_EN                                                         C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	movlw	Upper CODE_START_ADDRESS                                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	movwf	TBLPTRU                                                                   C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	movlw	High CODE_START_ADDRESS                                                   C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	movwf	TBLPTRH                                                                   C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	movlw	Low CODE_START_ADDRESS                                                    C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	movwf	TBLPTRL                                                                   C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	clrf	ProgMemoryChecksum_L                                                       C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	clrf	ProgMemoryChecksum_H                                                       C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           READ_PROGRAM_MEMORY                                                              C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;Read program memory and accumulate into a 16bit accumulator                     C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	tblrd+*                                                                         C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	movf	TABLAT, W                                                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	addwf	ProgMemoryChecksum_L, F                                                   C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	clrf	WREG                                                                       C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	addwfc	ProgMemoryChecksum_H, F                                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;Stop before the end of memory.                                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	movlw	Upper END_OF_ROM                                                          C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	cpfseq	TBLPTRU                                                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	bra	READ_PROGRAM_MEMORY                                                         C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	movlw	High END_OF_ROM                                                           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	cpfseq	TBLPTRH                                                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	bra	READ_PROGRAM_MEMORY                                                         C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	movlw	Low END_OF_ROM                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	cpfseq	TBLPTRL                                                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	bra	READ_PROGRAM_MEMORY                                                         C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           COMPARE_PROGRAM_MEMORY_CHECKSUM                                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;Verify against stored checksum.                                                 C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	tblrd+*                                                                         C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	movf	TABLAT, W                                                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	cpfseq	ProgMemoryChecksum_L                                                     C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	bra	PROGRAM_MEMORY_FAIL                                                         C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	tblrd+*                                                                         C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	movf	TABLAT, W                                                                  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	cpfseq	ProgMemoryChecksum_H                                                     C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	bra	PROGRAM_MEMORY_FAIL                                                        C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           PROGRAM_MEMORY_FAIL                                                              C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	goto	BOOT_LOAD_MODE                                                             C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #endif                                                                           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
00096e   ef00     GOTO      0xa00          	goto	REMAPPED_RESET_VECTOR	;_entry                                              C:\fw\691213\asm\x201\RS232\rs232bootload.asm
000970   f005                                                                                                               
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;The following is no longer needed as this verification will redirect the code to the right place. C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;PROGRAM_MEMORY_FAIL                                                             C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;This has to be done for the Microchip flash upgrading application to            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;work.                                                                           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	setf	EEADR		;Point to the last byte                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;;	setf	EEADRH	;Not needed on the 18F442                                         C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	setf	EEDATA		;Bootmode control byte                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	movlw	0x04		;b'00000100	;Setup for EEData                                      C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	movwf	EECON1                                                                   C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	movlw	0x55		;Unlock                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	movwf	EECON2                                                                   C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	movlw	0xAA                                                                     C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	movwf	EECON2                                                                   C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	bsf	EECON1, WR	;Start the write                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	nop                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	btfsc	EECON1, WR	;Wait                                                         C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	bra	$-2                                                                        C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;PROGRAM_MEMORY_FAIL_20                                                          C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;Wait for a reset                                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	CLRWDT                                                                         C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	goto	PROGRAM_MEMORY_FAIL_20                                                    C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	bra	Setup_10                                                                   C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;PROGRAM_MEMORY_PASS                                                             C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	ENDM                                                                           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; *****************************************************************************  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #ifdef	AUTOBAUD_DETECT                                                           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	CODE	0x000A                                                                    C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           WaitForRise                                                                      C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	btfsc	_RC_BIT				; Wait for a falling edge                                      C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	bra	WaitForRise                                                                 C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	clrwdt                                                                          C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           WtSR	                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	btfss	_RC_BIT				; Wait for starting edge                                       C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	bra	WtSR                                                                        C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	return                                                                          C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #endif                                                                           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; *****************************************************************************  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; *****************************************************************************  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #IFDEF	STAND_ALONE                                                               C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           RVReset1	CODE	REMAPPED_RESET_VECTOR                                              C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           _reset                                                                           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           RVIntH1		CODE	REMAPPED_HIGH_INTRPT_VECTOR                                        C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           highISR                                                                          C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           RVIntL1		CODE	REMAPPED_LOW_INTRPT_VECTOR                                         C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           lowISR                                                                           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #ELSE                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ;	extern	_entry;, highISR, lowISR                                                C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	extern	BOOT_LOAD_MODE                                                           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	global	StartOfLine, VERIFY_PROGRAM_MEMORY                                       C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           #ENDIF                                                                           C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           ; *****************************************************************************  C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                                                                                            C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                           	END                                                                             C:\fw\691213\asm\x201\RS232\rs232bootload.asm
                                                   LIST P=18F4455                                                           C:\MCC18\SRC\TRADIT~1\PROC\p18f4455.asm
                                                   LIST                                                                     C:\MCC18\SRC\TRADIT~1\PROC\p18f4455.asm
                                                   END                                                                      C:\MCC18\SRC\TRADIT~1\PROC\p18f4455.asm
                                           ;	RCS Header $Id: cmath18.asm,v 1.4 2004/10/01 19:13:22 GrosbaJ Exp $            C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                                                                                                            C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                           ;       CMATH18 DATA DEFINITION FILE                                             C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                                                                                                            C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                           ;******************************************************************************* C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                           ;   VARIABLE ALLOCATION - Core math library routines                             C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                           ;******************************************************************************* C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                                                                                                            C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                           MATH_DATA      UDATA_ACS                                                         C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                                                                                                            C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                           SIGN		RES 1       ; save location for sign in MSB                                C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                           FPFLAGSbits                                                                      C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                           FPFLAGS		RES 1       ; floating point library exception flags                    C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                                                                                                            C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                                   GLOBAL  SIGN, FPFLAGS, FPFLAGSbits                                       C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                           	                                                                                C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                                   END                                                                      C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
